"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var assert=_interopDefault(require("assert")),events=_interopDefault(require("events")),readline$1=_interopDefault(require("readline")),os=_interopDefault(require("os")),fs$2=_interopDefault(require("fs")),path$6=_interopDefault(require("path"));function createAssignment(e,t,s={}){return{id:e,dueDate:t,attributes:s}}var Assignment=Object.freeze({createAssignment:createAssignment});const ASSIGNMENT_KEY="assignment",OUTPUT_LOG="db.assignment.log";function setupDatabase(e){return ASSIGNMENT_KEY in e||(e[ASSIGNMENT_KEY]=new Map),e}function clearDatabase(e){return ASSIGNMENT_KEY in e&&e[ASSIGNMENT_KEY].clear(),e}function addAssignment(e,t,s,i,r={}){const n=e[ASSIGNMENT_KEY];let a;if(n.has(t)?a=n.get(t):n.set(t,a={}),s in a)return e.throwError(ASSIGNMENT_KEY,`Found duplicate assignment '${s}' for user '${t}'.`),null;{const e=createAssignment(s,new Date(i.getTime()),r);return a[s]=e,e}}function getAssignmentByID(e,t,s){return e[ASSIGNMENT_KEY].get(t)[s]}function getAssignmentsByUser(e,t){return Object.keys(e[ASSIGNMENT_KEY].get(t))}function outputLog(e,t,s="."){const i=e[ASSIGNMENT_KEY],r={};for(const[e,t]of i.entries())r[e]=t;const n=`${`${"# ".repeat(20)}\n# Assignments\n# Size: ${i.size}\n${"# ".repeat(20)}`}\n${JSON.stringify(r,null,4)}`;return t(require("path").resolve(s,OUTPUT_LOG),n)}var AssignmentDatabase$1=Object.freeze({ASSIGNMENT_KEY:ASSIGNMENT_KEY,setupDatabase:setupDatabase,clearDatabase:clearDatabase,addAssignment:addAssignment,getAssignmentByID:getAssignmentByID,getAssignmentsByUser:getAssignmentsByUser,outputLog:outputLog});function stringHash(e=""){let t=0;for(let s=0,i=e.length;s<i;s++)t=Math.imul(31,t)+e.charCodeAt(s)|0;return t}function uuid(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,uuid)}var MathHelper=Object.freeze({stringHash:stringHash,uuid:uuid});function createDatabase(){return{_registry:{},_cache:{},_errors:new Map,throwError(e,t,s={}){let i;i="object"==typeof s&&"id"in s?Array.isArray(s.id)?stringHash(s.id.join(".")):"number"!=typeof s.id?stringHash(JSON.stringify(s.id)):s.id:this._errors.size;let r=1e3;for(;r-- >=0&&this._errors.has(i);)++i;if(r<=0)throw new Error("Invalid error id - too many errors.");const n={id:i,tag:e,message:t,info:"",type:String(i),options:[],more:[],context:{},toString:()=>`${i} [${e}] ${t}`};if("string"==typeof s)n.options.push(s);else if("object"==typeof s){if("options"in s)if(Array.isArray(s.options))for(const e of s.options)n.options.push(e);else n.options.push(option);"more"in s&&(n.more=s.more),"context"in s&&(n.context={...s.context}),"info"in s&&(n.info=String(s.info)),"type"in s&&(n.type=String(s.type))}this._errors.set(i,n)},removeErrorByID(e){if("number"!=typeof e)throw new Error("Error id must be a number.");return!!this._errors.has(e)&&(this._errors.delete(e),!0)},getErrorByID(e){if("number"!=typeof e)throw new Error("Error id must be a number.");return this._errors.get(e)},clearErrors(){this._errors.clear()},getErrors(){return Array.from(this._errors.values())},getCache(){return this._cache}}}var Database=Object.freeze({createDatabase:createDatabase});function createReview(e,t,s,i,r){return{id:e,date:t,comment:s,type:i,params:r}}var Review=Object.freeze({createReview:createReview});const REVIEW_KEY="review",OUTPUT_LOG$1="db.review.log";function setupDatabase$1(e){return REVIEW_KEY in e||(e[REVIEW_KEY]=new Map),e}function clearDatabase$1(e){return REVIEW_KEY in e&&e[REVIEW_KEY].clear(),e}function forEach(e,t){e[REVIEW_KEY].forEach(t)}function addReview(e,t,s,i,r,n){const a=e[REVIEW_KEY];if(a.has(t))return e.throwError(REVIEW_KEY,`Found duplicate id for review '${t}'.`),null;{const e=createReview(t,s,i,r,n);return a.set(String(t),e),e}}function removeReviewByID(e,t){const s=String(t),i=e[REVIEW_KEY];return!!i.has(s)&&(i.delete(s),!0)}function getReviews(e){return e[REVIEW_KEY].keys()}function getReviewCount(e){return e[REVIEW_KEY].size}function getReviewByID(e,t){return e[REVIEW_KEY].get(String(t))}function getReviewTypes(e){const t=e[REVIEW_KEY],s=new Set;for(const e of t.values())s.add(e.type);return s}function outputLog$1(e,t,s="."){const i=e[REVIEW_KEY],r={};for(const[e,t]of i.entries())r[e]=t;const n=`${`${"# ".repeat(20)}\n# Reviews\n# Size: ${i.size}\n${"# ".repeat(20)}`}\n${JSON.stringify(r,null,4)}`;return t(require("path").resolve(s,OUTPUT_LOG$1),n)}var ReviewDatabase=Object.freeze({REVIEW_KEY:REVIEW_KEY,setupDatabase:setupDatabase$1,clearDatabase:clearDatabase$1,forEach:forEach,addReview:addReview,removeReviewByID:removeReviewByID,getReviews:getReviews,getReviewCount:getReviewCount,getReviewByID:getReviewByID,getReviewTypes:getReviewTypes,outputLog:outputLog$1});const ONE_DAYTIME=864e5,DAYS_IN_WEEK=7;function compareDates(e,t){const s=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()).getTime(),i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()).getTime();return Math.ceil((s-i)/ONE_DAYTIME)}function compareDatesWithTime(e,t){return e.getTime()-t.getTime()}function isWithinDates(e,t,s){const i=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),r=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),n=new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate());return compareDatesWithTime(i,r)>=0&&compareDatesWithTime(i,n)<=0}function getDaysUntil(e,t){const s=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return Math.floor(Math.abs(i.getTime()-s.getTime())/ONE_DAYTIME)}function copyDate(e){return new Date(e.getTime())}function getNearestSunday(e,t=!0){const s=e.getUTCDay();return s<3||t&&3===s?getPastSunday(e):getNextSunday(e)}function getPastSunday(e,t=0){const s=copyDate(e);return s.setUTCDate(s.getUTCDate()-s.getUTCDay()+t),s}function getPrevSunday(e,t=0){const s=copyDate(e);return 0===s.getUTCDay()?s.setUTCDate(s.getUTCDate()-DAYS_IN_WEEK+t):s.setUTCDate(s.getUTCDate()-s.getUTCDay()+t),s}function getNextSunday(e,t=0){const s=new Date(e.getTime());return s.setUTCDate(s.getUTCDate()-s.getUTCDay()+DAYS_IN_WEEK+t),s}function getNextEffectiveSunday(e,t=0){return e.getUTCDay()>t?getNextSunday(new Date(e.getTime()+DAYS_IN_WEEK*ONE_DAYTIME)):getNextSunday(e)}function offsetDate(e,t=0){const s=new Date(e.getTime());return t&&s.setUTCDate(s.getUTCDate()+t),s}function parseAmericanDate(e,t=0){let s,i,r,n,a,o,l,u;if((s=e.indexOf("/",0))<0?(s=e.indexOf("-",0),i=e.indexOf("-",s+1)):i=e.indexOf("/",s+1),s<0||i<0)throw new Error("Invalid date format - Expected MM/DD/YYYY");if(r=Number(e.substring(i+1)),n=Number(e.substring(0,s)),a=Number(e.substring(s+1,i)),o=0,l=0,u=0,NaN===r||NaN===n||NaN===a)throw new Error("Invalid date format - Expected MM/DD/YYYY");const c=new Date(t);return c.setUTCFullYear(r),c.setUTCMonth(n-1),c.setUTCDate(a),c}function parse(e){const t=e.indexOf("-",0),s=e.indexOf("-",t+1);let i,r,n,a,o,l,u,c,h;if((i=e.indexOf("-",s+1))<0&&(i=e.indexOf(" ",s+1)),r=e.indexOf(":",i+1),n=e.indexOf(":",r+1),s<0||t<0)throw new Error("Invalid date format - Expected YYYY-MM-DD-hh:mm:ss");if(i<0||r<0||n<0?(i=e.length,u=0,c=0,h=0):(u=Number(e.substring(i+1,r)),c=Number(e.substring(r+1,n)),h=Number(e.substring(n+1))),a=Number(e.substring(0,t)),o=Number(e.substring(t+1,s)),l=Number(e.substring(s+1,i)),NaN===a||NaN===o||NaN===l||NaN===u||NaN===c||NaN===h)throw new Error("Invalid date format - Expected YYYY-MM-DD-hh:mm:ss");const p=new Date(0);return p.setUTCFullYear(a),p.setUTCMonth(o-1),p.setUTCDate(l),p.setUTCHours(u),p.setUTCMinutes(c),p.setUTCSeconds(h),p}function stringify(e,t=!0){const s=e.getUTCFullYear(),i=e.getUTCMonth()+1,r=e.getUTCDate(),n=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds();return String(s).padStart(4,"0")+"-"+String(i).padStart(2,"0")+"-"+String(r).padStart(2,"0")+(t?"-"+String(n).padStart(2,"0")+":"+String(a).padStart(2,"0")+":"+String(o).padStart(2,"0"):"")}var DateUtil=Object.freeze({ONE_DAYTIME:ONE_DAYTIME,DAYS_IN_WEEK:DAYS_IN_WEEK,compareDates:compareDates,compareDatesWithTime:compareDatesWithTime,isWithinDates:isWithinDates,getDaysUntil:getDaysUntil,copyDate:copyDate,getNearestSunday:getNearestSunday,getPastSunday:getPastSunday,getPrevSunday:getPrevSunday,getNextSunday:getNextSunday,getNextEffectiveSunday:getNextEffectiveSunday,offsetDate:offsetDate,parseAmericanDate:parseAmericanDate,parse:parse,stringify:stringify});const ONE_DAYTIME$1=864e5;function calculateNumberOfSlipDays(e){return 3*e.weeks}function createSchedule(e,t,s={}){const i=s.threshold||0,r=ONE_DAYTIME$1*i,n=getNextEffectiveSunday(e,i),a=t.getTime()-r,o=getPastSunday(e),l=new Date(o.getTime());let u=0;for(;l.getTime()<a;)l.setUTCDate(l.getUTCDate()+7),++u;return{startDate:e,endDate:t,weeks:u,startSunday:o,firstSunday:n,lastSunday:l}}var Schedule=Object.freeze({ONE_DAYTIME:ONE_DAYTIME$1,calculateNumberOfSlipDays:calculateNumberOfSlipDays,createSchedule:createSchedule});function createSubmission(e,t,s,i,r={}){return{id:e,owner:t,assignment:s,date:i,attributes:r}}var Submission=Object.freeze({createSubmission:createSubmission});const SUBMISSION_KEY="submission",SUBMISSION_OWNER_KEY="owner",SUBMISSION_LIST_KEY="list",OUTPUT_LOG$2="db.submission.log";function setupDatabase$2(e){SUBMISSION_KEY in e||(e[SUBMISSION_KEY]={});const t=e[SUBMISSION_KEY];return SUBMISSION_OWNER_KEY in t||(t[SUBMISSION_OWNER_KEY]=new Map),SUBMISSION_LIST_KEY in t||(t[SUBMISSION_LIST_KEY]=new Map),e}function clearDatabase$2(e){return SUBMISSION_KEY in e&&(e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY].clear(),e[SUBMISSION_KEY][SUBMISSION_LIST_KEY].clear()),e}function addSubmission(e,t,s,i,r,n={}){const a=e[SUBMISSION_KEY],o=a[SUBMISSION_OWNER_KEY],l=a[SUBMISSION_LIST_KEY];if(l.has(t))return e.throwError(SUBMISSION_KEY,`Found duplicate id for submission '${t}'.`),null;{Array.isArray(s)&&(s=s[0]);const e=createSubmission(t,s,i,r,n);let a=o.get(s);return a||o.set(s,a={}),addSubmissionToAssignment(e,i,a),l.set(t,e),e}}function addSubmissionToAssignment(e,t,s){if(e.assignment=t,t in s){const i=s[t];let r=0;for(;r<i.length&&!(compareDates(e.date,i[r].date)<0);++r);i.splice(r,0,e)}else s[t]=[e];return e}function changeSubmissionAssignment(e,t,s){const i=e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY].get(t.owner),r=i[t.assignment],n=r.indexOf(t);if(!(n>=0))throw new Error(`Cannot find submission for assignment ${t.assignment}.`);return r.splice(n,1),r.length<=0&&delete i[t.assignment],void 0!==s&&addSubmissionToAssignment(t,s,i),t}function getAssignedSubmissionsByOwnerKey(e,t){return e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY].get(t)}function getSubmissionByID(e,t){return e[SUBMISSION_KEY][SUBMISSION_LIST_KEY].get(t)}function getOwners(e){return e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY].keys()}function getSubmissions(e){return e[SUBMISSION_KEY][SUBMISSION_LIST_KEY].keys()}function getSubmissionCount(e){return e[SUBMISSION_KEY][SUBMISSION_LIST_KEY].size}function clearSubmissionsByOwner(e,t){const s=e[SUBMISSION_KEY][SUBMISSION_LIST_KEY],i=getAssignedSubmissionsByOwnerKey(e,t);if(i)for(const e of Object.values(i))for(const t of e)s.delete(t.id);e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY].delete(t)}function removeSubmissionByID(e,t){const s=e[SUBMISSION_KEY][SUBMISSION_LIST_KEY],i=s.get(t);if(!i)throw new Error(`Cannot find submission for id ${t}.`);s.delete(t),changeSubmissionAssignment(e,i)}function outputLog$2(e,t,s="."){const i=e[SUBMISSION_KEY][SUBMISSION_OWNER_KEY],r=e[SUBMISSION_KEY][SUBMISSION_LIST_KEY],n={owner:{},list:{}};for(const[e,t]of i.entries())n.owner[e]=t;for(const[e,t]of r.entries())n.list[e]=t;const a=`${`${"# ".repeat(20)}\n# Submissions\n# Size: ${r.size}\n${"# ".repeat(20)}`}\n${JSON.stringify(n,null,4)}`;return t(require("path").resolve(s,OUTPUT_LOG$2),a)}var SubmissionDatabase=Object.freeze({SUBMISSION_KEY:SUBMISSION_KEY,SUBMISSION_OWNER_KEY:SUBMISSION_OWNER_KEY,SUBMISSION_LIST_KEY:SUBMISSION_LIST_KEY,setupDatabase:setupDatabase$2,clearDatabase:clearDatabase$2,addSubmission:addSubmission,addSubmissionToAssignment:addSubmissionToAssignment,changeSubmissionAssignment:changeSubmissionAssignment,getAssignedSubmissionsByOwnerKey:getAssignedSubmissionsByOwnerKey,getSubmissionByID:getSubmissionByID,getOwners:getOwners,getSubmissions:getSubmissions,getSubmissionCount:getSubmissionCount,clearSubmissionsByOwner:clearSubmissionsByOwner,removeSubmissionByID:removeSubmissionByID,outputLog:outputLog$2});function createUser(e,t,s,i,r,n,a){return{id:e,ownerKey:t,name:s,schedule:createSchedule(i,r,n),attributes:a}}var User=Object.freeze({createUser:createUser});const USER_KEY="user",OUTPUT_LOG$3="db.user.log";function setupDatabase$3(e){return USER_KEY in e||(e[USER_KEY]=new Map),e}function clearDatabase$3(e){return USER_KEY in e&&e[USER_KEY].clear(),e}function addUser(e,t,s,i,r,n,a,o={}){const l=e[USER_KEY];if(l.has(t))return e.throwError(USER_KEY,`Found duplicate id for user '${t}'.`),null;{const e=createUser(t,s,i,r,n,a,o);return l.set(t,e),e}}function getUsers(e){return e[USER_KEY].keys()}function getUserCount(e){return e[USER_KEY].size}function getUserByID(e,t){return e[USER_KEY].get(t)}function getUserByOwnerKey(e,t){const s=e[USER_KEY];for(const e of s.values())if(Array.isArray(e.ownerKey)){if(e.ownerKey.includes(t))return e.id}else if(e.ownerKey==t)return e.id;return null}function getUsersByAttribute(e,t,s){let i=[];const r=e[USER_KEY];for(const e of r.values())if(t in e.attributes){const r=e.attributes[t];Array.isArray(r)?r.includes(s)&&i.push(e.id):r==s&&i.push(e.id)}else null===s&&i.push(e.id);return i}function getOwnerKeysForUserID(e,t){const s=e[USER_KEY].get(t).ownerKey;return Array.isArray(s)?s:[s]}function outputLog$3(e,t,s="."){const i=e[USER_KEY],r={};for(const[e,t]of i.entries())r[e]=t;const n=`${`${"# ".repeat(20)}\n# Users\n# Size: ${i.size}\n${"# ".repeat(20)}`}\n${JSON.stringify(r,null,4)}`;return t(require("path").resolve(s,OUTPUT_LOG$3),n)}var UserDatabase$1=Object.freeze({USER_KEY:USER_KEY,setupDatabase:setupDatabase$3,clearDatabase:clearDatabase$3,addUser:addUser,getUsers:getUsers,getUserCount:getUserCount,getUserByID:getUserByID,getUserByOwnerKey:getUserByOwnerKey,getUsersByAttribute:getUsersByAttribute,getOwnerKeysForUserID:getOwnerKeysForUserID,outputLog:outputLog$3});function computeDatesWithPadding(e,t,s){switch(e){case"week":return[getPastSunday(t),getNextEffectiveSunday(s,3)];default:const i=Number(e);if(Number.isNaN(i))throw new Error(`Unknown padding type '${e}'.`);return[new Date(t.getTime()-ONE_DAYTIME*i),new Date(s.getTime()+ONE_DAYTIME*i)]}}function createVacation(e,t,s,i,r,n){const[a,o]=computeDatesWithPadding(r,s,i);return{id:e,ownerKey:t,userStartDate:s,userEndDate:i,effectiveStartDate:a,effectiveEndDate:o,padding:r,duration:getDaysUntil(s,i),attributes:n}}var Vacation=Object.freeze({createVacation:createVacation});const VACATION_KEY="vacation",OUTPUT_LOG$4="db.vacation.log";function setupDatabase$4(e){return VACATION_KEY in e||(e[VACATION_KEY]=new Map),e}function clearDatabase$4(e){return VACATION_KEY in e&&e[VACATION_KEY].clear(),e}function addVacation(e,t,s,i,r=i,n=0,a={}){const o=e[VACATION_KEY];if(o.has(t))return e.throwError(VACATION_KEY,`Found duplicate id for vacation '${t}'.`),null;{const e=createVacation(t,s,i,r,n,a);return o.set(t,e),e}}function offsetDateByVacations(e,t,s){const i=e[VACATION_KEY],r=getVacationsByOwnerKeys(e,t);r.sort((e,t)=>i.get(e).effectiveStartDate.getTime()-i.get(t).effectiveStartDate.getTime());let n=new Date(s.getTime());for(const e of r){const t=i.get(e);if(isWithinDates(n,t.effectiveStartDate,t.effectiveEndDate)){const e=getDaysUntil(n,t.effectiveStartDate);n.setTime(n.getTime()+e*ONE_DAYTIME)}}return n}function getVacations(e){return e[VACATION_KEY].keys()}function getVacationByID(e,t){return e[VACATION_KEY].get(t)}function getVacationsByOwnerKeys(e,t){const s=e[VACATION_KEY],i=[];for(const e of s.values())t.includes(e.ownerKey)&&i.push(e.id);return i}function getVacationsByAttribute(e,t,s){let i=[];const r=e[VACATION_KEY];for(const e of r.values())if(t in e.attributes){const r=e.attributes[t];Array.isArray(r)?r.includes(s)&&i.push(e.id):r==s&&i.push(e.id)}else null===s&&i.push(e.id);return i}function outputLog$4(e,t,s="."){const i=e[VACATION_KEY],r={};for(const[e,t]of i.entries())r[e]=t;const n=`${`${"# ".repeat(20)}\n# Vacations\n# Size: ${i.size}\n${"# ".repeat(20)}`}\n${JSON.stringify(r,null,4)}`;return t(require("path").resolve(s,OUTPUT_LOG$4),n)}var VacationDatabase=Object.freeze({VACATION_KEY:VACATION_KEY,setupDatabase:setupDatabase$4,clearDatabase:clearDatabase$4,addVacation:addVacation,offsetDateByVacations:offsetDateByVacations,getVacations:getVacations,getVacationByID:getVacationByID,getVacationsByOwnerKeys:getVacationsByOwnerKeys,getVacationsByAttribute:getVacationsByAttribute,outputLog:outputLog$4});function parseName(e){return e}function parseEmail(e,...t){const s=e.split(",").map(e=>{if(e)return e.trim().toLowerCase()});if(t.length>0)for(const e of t){const t=parseEmail(e);if(Array.isArray(t))for(const e of t)s.push(e);else s.push(t)}return 1===s.length?s[0]:s}var FieldParser=Object.freeze({parseName:parseName,parseEmail:parseEmail});function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var symbols=createCommonjsModule(function(e){const t="win32"===process.platform,s="linux"===process.platform,i={bullet:"•",check:"√",cross:"×",ellipsis:"...",heart:"❤",info:"i",line:"─",middot:"·",minus:"－",plus:"＋",question:"?",questionSmall:"﹖",pointer:">",pointerSmall:"»",warning:"‼"},r={ballotCross:"✘",bullet:"•",check:"✔",cross:"✖",ellipsis:"…",heart:"❤",info:"ℹ",line:"─",middot:"·",minus:"－",plus:"＋",question:"?",questionFull:"？",questionSmall:"﹖",pointer:s?"▸":"❯",pointerSmall:s?"‣":"›",warning:"⚠"};e.exports=t?i:r,Reflect.defineProperty(e.exports,"windows",{enumerable:!1,value:i}),Reflect.defineProperty(e.exports,"other",{enumerable:!1,value:r})});const colors={enabled:!0,visible:!0,styles:{},keys:{}};"FORCE_COLOR"in process.env&&(colors.enabled="0"!==process.env.FORCE_COLOR);const ansi=e=>(e.open=`[${e.codes[0]}m`,e.close=`[${e.codes[1]}m`,e.regex=new RegExp(`\\u001b\\[${e.codes[1]}m`,"g"),e),wrap=(e,t,s)=>{let{open:i,close:r,regex:n}=e;return t=i+(t.includes(r)?t.replace(n,r+i):t)+r,s?t.replace(/\r?\n/g,`${r}$&${i}`):t},style=(e,t)=>{if(""===e||null==e)return"";if(!1===colors.enabled)return e;if(!1===colors.visible)return"";let s=""+e,i=s.includes("\n"),r=t.length;for(;r-- >0;)s=wrap(colors.styles[t[r]],s,i);return s},define=(e,t,s)=>{colors.styles[e]=ansi({name:e,codes:t}),(colors.keys[s]||(colors.keys[s]=[])).push(e),Reflect.defineProperty(colors,e,{get(){let t=e=>style(e,t.stack);return Reflect.setPrototypeOf(t,colors),t.stack=this.stack?this.stack.concat(e):[e],t}})};define("reset",[0,0],"modifier"),define("bold",[1,22],"modifier"),define("dim",[2,22],"modifier"),define("italic",[3,23],"modifier"),define("underline",[4,24],"modifier"),define("inverse",[7,27],"modifier"),define("hidden",[8,28],"modifier"),define("strikethrough",[9,29],"modifier"),define("black",[30,39],"color"),define("red",[31,39],"color"),define("green",[32,39],"color"),define("yellow",[33,39],"color"),define("blue",[34,39],"color"),define("magenta",[35,39],"color"),define("cyan",[36,39],"color"),define("white",[37,39],"color"),define("gray",[90,39],"color"),define("grey",[90,39],"color"),define("bgBlack",[40,49],"bg"),define("bgRed",[41,49],"bg"),define("bgGreen",[42,49],"bg"),define("bgYellow",[43,49],"bg"),define("bgBlue",[44,49],"bg"),define("bgMagenta",[45,49],"bg"),define("bgCyan",[46,49],"bg"),define("bgWhite",[47,49],"bg"),define("blackBright",[90,39],"bright"),define("redBright",[91,39],"bright"),define("greenBright",[92,39],"bright"),define("yellowBright",[93,39],"bright"),define("blueBright",[94,39],"bright"),define("magentaBright",[95,39],"bright"),define("cyanBright",[96,39],"bright"),define("whiteBright",[97,39],"bright"),define("bgBlackBright",[100,49],"bgBright"),define("bgRedBright",[101,49],"bgBright"),define("bgGreenBright",[102,49],"bgBright"),define("bgYellowBright",[103,49],"bgBright"),define("bgBlueBright",[104,49],"bgBright"),define("bgMagentaBright",[105,49],"bgBright"),define("bgCyanBright",[106,49],"bgBright"),define("bgWhiteBright",[107,49],"bgBright");const re=colors.ansiRegex=/[\u001b\u009b][[\]#;?()]*(?:(?:(?:[^\W_]*;?[^\W_]*)\u0007)|(?:(?:[0-9]{1,4}(;[0-9]{0,4})*)?[~0-9=<>cf-nqrtyA-PRZ]))/g;colors.hasColor=colors.hasAnsi=e=>(re.lastIndex=0,!!e&&"string"==typeof e&&re.test(e)),colors.unstyle=e=>(re.lastIndex=0,"string"==typeof e?e.replace(re,""):e),colors.none=colors.clear=colors.noop=e=>e,colors.stripColor=colors.unstyle,colors.symbols=symbols,colors.define=define;var ansiColors=colors,utils=createCommonjsModule(function(e,t){const s=Object.prototype.toString;let i=!1,r=[];const n={yellow:"blue",cyan:"red",green:"magenta",black:"white",blue:"yellow",red:"cyan",magenta:"green",white:"black"};t.longest=(e,t)=>e.reduce((e,s)=>Math.max(e,t?s[t].length:s.length),0),t.hasColor=e=>!!e&&ansiColors.hasColor(e);const a=t.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e);t.nativeType=e=>s.call(e).slice(8,-1).toLowerCase().replace(/\s/g,""),t.isAsyncFn=e=>"asyncfunction"===t.nativeType(e),t.isPrimitive=e=>null!=e&&"object"!=typeof e&&"function"!=typeof e,t.resolve=(e,t,...s)=>"function"==typeof t?t.call(e,...s):t,t.scrollDown=(e=[])=>[...e.slice(1),e[0]],t.scrollUp=(e=[])=>[e.pop(),...e],t.reorder=(e=[])=>{let t=e.slice();return t.sort((e,t)=>e.index>t.index?1:e.index<t.index?-1:0),t},t.swap=(e,t,s)=>{let i=e.length,r=s===i?0:s<0?i-1:s,n=e[t];e[t]=e[r],e[r]=n},t.width=(e,t=80)=>{let s=e&&e.columns?e.columns:t;return e&&"function"==typeof e.getWindowSize&&(s=e.getWindowSize()[0]),"win32"===process.platform?s-1:s},t.height=(e,t=20)=>{let s=e&&e.rows?e.rows:t;return e&&"function"==typeof e.getWindowSize&&(s=e.getWindowSize()[1]),s},t.wordWrap=(e,t={})=>{if(!e)return e;"number"==typeof t&&(t={width:t});let{indent:s="",newline:i="\n"+s,width:r=80}=t,n=(i+s).match(/[^\S\n]/g)||[],a=`.{1,${r-=n.length}}([\\s\\u200B]+|$)|[^\\s\\u200B]+?([\\s\\u200B]+|$)`,o=e.trim(),l=new RegExp(a,"g"),u=o.match(l)||[];return u=u.map(e=>e.replace(/\n$/,"")),t.padEnd&&(u=u.map(e=>e.padEnd(r," "))),t.padStart&&(u=u.map(e=>e.padStart(r," "))),s+u.join(i)},t.unmute=e=>{let t=e.stack.find(e=>ansiColors.keys.color.includes(e));return t?ansiColors[t]:e.stack.find(e=>"bg"===e.slice(2))?ansiColors[t.slice(2)]:e=>e},t.pascal=e=>e?e[0].toUpperCase()+e.slice(1):"",t.inverse=e=>{if(!e||!e.stack)return e;let s=e.stack.find(e=>ansiColors.keys.color.includes(e));if(s){let i=ansiColors["bg"+t.pascal(s)];return i?i.black:e}let i=e.stack.find(e=>"bg"===e.slice(0,2));return i?ansiColors[i.slice(2).toLowerCase()]||e:ansiColors.none},t.complement=e=>{if(!e||!e.stack)return e;let s=e.stack.find(e=>ansiColors.keys.color.includes(e)),i=e.stack.find(e=>"bg"===e.slice(0,2));if(s&&!i)return ansiColors[n[s]||s];if(i){let s=i.slice(2).toLowerCase(),r=n[s];return r&&ansiColors["bg"+t.pascal(r)]||e}return ansiColors.none},t.meridiem=e=>{let t=e.getHours(),s=e.getMinutes(),i=t>=12?"pm":"am";return(0===(t%=12)?12:t)+":"+(s<10?"0"+s:s)+" "+i},t.set=(e={},s="",i)=>s.split(".").reduce((e,s,r,n)=>{let a=n.length-1>r?e[s]||{}:i;return!t.isObject(a)&&r<n.length-1&&(a={}),e[s]=a},e),t.get=(e={},t="",s)=>{let i=null==e[t]?t.split(".").reduce((e,t)=>e&&e[t],e):e[t];return null==i?s:i},t.mixin=(e,s)=>{if(!a(e))return s;if(!a(s))return e;for(let i of Object.keys(s)){let r=Object.getOwnPropertyDescriptor(s,i);if(r.hasOwnProperty("value"))if(e.hasOwnProperty(i)&&a(r.value)){let n=Object.getOwnPropertyDescriptor(e,i);a(n.value)?e[i]=t.merge({},e[i],s[i]):Reflect.defineProperty(e,i,r)}else Reflect.defineProperty(e,i,r);else Reflect.defineProperty(e,i,r)}return e},t.merge=(...e)=>{let s={};for(let i of e)t.mixin(s,i);return s},t.mixinEmitter=(e,s)=>{let i=s.constructor.prototype;for(let r of Object.keys(i)){let n=i[r];"function"==typeof n?t.define(e,r,n.bind(s)):t.define(e,r,n)}},t.onExit=e=>{const t=(e,t)=>{i||(i=!0,r.forEach(e=>e()),!0===e&&process.exit(128+t))};0===r.length&&(process.once("SIGTERM",t.bind(null,!0,15)),process.once("SIGINT",t.bind(null,!0,2)),process.once("exit",t)),r.push(e)},t.define=(e,t,s)=>{Reflect.defineProperty(e,t,{value:s})},t.defineExport=(e,t,s)=>{let i;Reflect.defineProperty(e,t,{enumerable:!0,configurable:!0,set(e){i=e},get:()=>i?i():s()})}}),utils_1=utils.longest,utils_2=utils.hasColor,utils_3=utils.isObject,utils_4=utils.nativeType,utils_5=utils.isAsyncFn,utils_6=utils.isPrimitive,utils_7=utils.resolve,utils_8=utils.scrollDown,utils_9=utils.scrollUp,utils_10=utils.reorder,utils_11=utils.swap,utils_12=utils.width,utils_13=utils.height,utils_14=utils.wordWrap,utils_15=utils.unmute,utils_16=utils.pascal,utils_17=utils.inverse,utils_18=utils.complement,utils_19=utils.meridiem,utils_20=utils.set,utils_21=utils.get,utils_22=utils.mixin,utils_23=utils.merge,utils_24=utils.mixinEmitter,utils_25=utils.onExit,utils_26=utils.define,utils_27=utils.defineExport,ctrl={a:"first",b:"backward",c:"cancel",d:"deleteForward",e:"last",f:"forward",g:"reset",i:"tab",k:"cutForward",l:"reset",n:"newItem",m:"cancel",j:"submit",p:"search",r:"remove",s:"save",u:"undo",w:"cutLeft",x:"toggleCursor",v:"paste"},shift={up:"shiftUp",down:"shiftDown",left:"shiftLeft",right:"shiftRight",tab:"prev"},fn={up:"pageUp",down:"pageDown",left:"pageLeft",right:"pageRight",delete:"deleteForward"},option$1={b:"backward",f:"forward",d:"cutRight",left:"cutLeft",up:"altUp",down:"altDown"},keys={pageup:"pageUp",pagedown:"pageDown",home:"home",end:"end",cancel:"cancel",delete:"deleteForward",backspace:"delete",down:"down",enter:"submit",escape:"cancel",left:"left",space:"space",number:"number",return:"submit",right:"right",tab:"next",up:"up"},combos={ctrl:ctrl,shift:shift,fn:fn,option:option$1,keys:keys};const metaKeyCodeRe=/^(?:\x1b)([a-zA-Z0-9])$/,fnKeyRe=/^(?:\x1b+)(O|N|\[|\[\[)(?:(\d+)(?:;(\d+))?([~^$])|(?:1;)?(\d+)?([a-zA-Z]))/,keyName={OP:"f1",OQ:"f2",OR:"f3",OS:"f4","[11~":"f1","[12~":"f2","[13~":"f3","[14~":"f4","[[A":"f1","[[B":"f2","[[C":"f3","[[D":"f4","[[E":"f5","[15~":"f5","[17~":"f6","[18~":"f7","[19~":"f8","[20~":"f9","[21~":"f10","[23~":"f11","[24~":"f12","[A":"up","[B":"down","[C":"right","[D":"left","[E":"clear","[F":"end","[H":"home",OA:"up",OB:"down",OC:"right",OD:"left",OE:"clear",OF:"end",OH:"home","[1~":"home","[2~":"insert","[3~":"delete","[4~":"end","[5~":"pageup","[6~":"pagedown","[[5~":"pageup","[[6~":"pagedown","[7~":"home","[8~":"end","[a":"up","[b":"down","[c":"right","[d":"left","[e":"clear","[2$":"insert","[3$":"delete","[5$":"pageup","[6$":"pagedown","[7$":"home","[8$":"end",Oa:"up",Ob:"down",Oc:"right",Od:"left",Oe:"clear","[2^":"insert","[3^":"delete","[5^":"pageup","[6^":"pagedown","[7^":"home","[8^":"end","[Z":"tab"};function isShiftKey(e){return["[a","[b","[c","[d","[e","[2$","[3$","[5$","[6$","[7$","[8$","[Z"].includes(e)}function isCtrlKey(e){return["Oa","Ob","Oc","Od","Oe","[2^","[3^","[5^","[6^","[7^","[8^"].includes(e)}const keypress=(e="",t={})=>{let s,i={name:t.name,ctrl:!1,meta:!1,shift:!1,option:!1,sequence:e,raw:e,...t};if(Buffer.isBuffer(e)?e[0]>127&&void 0===e[1]?(e[0]-=128,e=""+String(e)):e=String(e):void 0!==e&&"string"!=typeof e?e=String(e):e||(e=i.sequence||""),i.sequence=i.sequence||e||i.name,"\r"===e)i.raw=void 0,i.name="return";else if("\n"===e)i.name="enter";else if("\t"===e)i.name="tab";else if("\b"===e||""===e||""===e||"\b"===e)i.name="backspace",i.meta=""===e.charAt(0);else if(""===e||""===e)i.name="escape",i.meta=2===e.length;else if(" "===e||" "===e)i.name="space",i.meta=2===e.length;else if(e<="")i.name=String.fromCharCode(e.charCodeAt(0)+"a".charCodeAt(0)-1),i.ctrl=!0;else if(1===e.length&&e>="0"&&e<="9")i.name="number";else if(1===e.length&&e>="a"&&e<="z")i.name=e;else if(1===e.length&&e>="A"&&e<="Z")i.name=e.toLowerCase(),i.shift=!0;else if(s=metaKeyCodeRe.exec(e))i.meta=!0,i.shift=/^[A-Z]$/.test(s[1]);else if(s=fnKeyRe.exec(e)){let t=[...e];""===t[0]&&""===t[1]&&(i.option=!0);let r=[s[1],s[2],s[4],s[6]].filter(Boolean).join(""),n=(s[3]||s[5]||1)-1;i.ctrl=!!(4&n),i.meta=!!(10&n),i.shift=!!(1&n),i.code=r,i.name=keyName[r],i.shift=isShiftKey(r)||i.shift,i.ctrl=isCtrlKey(r)||i.ctrl}return i};keypress.listen=(e={},t)=>{let{stdin:s}=e;if(!s||s!==process.stdin&&!s.isTTY)throw new Error("Invalid stream passed");let i=readline$1.createInterface({terminal:!0,input:s});readline$1.emitKeypressEvents(s,i);let r=(e,s)=>t(e,keypress(e,s),i),n=s.isRaw;s.isTTY&&s.setRawMode(!0),s.on("keypress",r),i.resume();return()=>{s.isTTY&&s.setRawMode(n),s.removeListener("keypress",r),i.pause(),i.close()}},keypress.action=(e,t,s)=>{let i={...combos,...s};return t.ctrl?(t.action=i.ctrl[t.name],t):t.option&&i.option?(t.action=i.option[t.name],t):t.shift?(t.action=i.shift[t.name],t):(t.action=i.keys[t.name],t)};var keypress_1=keypress,timer=e=>{e.timers=e.timers||{};let t=e.options.timers;if(t)for(let s of Object.keys(t)){let i=t[s];"number"==typeof i&&(i={interval:i}),create(e,s,i)}};function create(e,t,s={}){let i=e.timers[t]={name:t,start:Date.now(),ms:0,tick:0},r=s.interval||120;i.frames=s.frames||[],i.loading=!0;let n=setInterval(()=>{i.ms=Date.now()-i.start,i.tick++,e.render()},r);return i.stop=()=>{i.loading=!1,clearInterval(n)},Reflect.defineProperty(i,"interval",{value:n}),e.once("close",()=>i.stop()),i.stop}const{define:define$1,width:width}=utils;class State{constructor(e){let t=e.options;define$1(this,"_prompt",e),this.type=e.type,this.name=e.name,this.message="",this.header="",this.footer="",this.error="",this.hint="",this.input="",this.cursor=0,this.index=0,this.lines=0,this.tick=0,this.prompt="",this.buffer="",this.width=width(t.stdout||process.stdout),Object.assign(this,t),this.name=this.name||this.message,this.message=this.message||this.name,this.symbols=e.symbols,this.styles=e.styles,this.required=new Set,this.cancelled=!1,this.submitted=!1}clone(){let e={...this};return e.status=this.status,e.buffer=Buffer.from(e.buffer),delete e.clone,e}set color(e){this._color=e}get color(){let e=this.prompt.styles;if(this.cancelled)return e.cancelled;if(this.submitted)return e.submitted;let t=this._color||e[this.status];return"function"==typeof t?t:e.pending}set loading(e){this._loading=e}get loading(){return"boolean"==typeof this._loading?this._loading:!!this.loadingChoices&&"choices"}get status(){return this.cancelled?"cancelled":this.submitted?"submitted":"pending"}}var state=State;const styles={default:ansiColors.noop,noop:ansiColors.noop,set inverse(e){this._inverse=e},get inverse(){return this._inverse||utils.inverse(this.primary)},set complement(e){this._complement=e},get complement(){return this._complement||utils.complement(this.primary)},primary:ansiColors.cyan,success:ansiColors.green,danger:ansiColors.magenta,strong:ansiColors.bold,warning:ansiColors.yellow,muted:ansiColors.dim,disabled:ansiColors.gray,dark:ansiColors.dim.gray,underline:ansiColors.underline,set info(e){this._info=e},get info(){return this._info||this.primary},set em(e){this._em=e},get em(){return this._em||this.primary.underline},set heading(e){this._heading=e},get heading(){return this._heading||this.muted.underline},set pending(e){this._pending=e},get pending(){return this._pending||this.primary},set submitted(e){this._submitted=e},get submitted(){return this._submitted||this.success},set cancelled(e){this._cancelled=e},get cancelled(){return this._cancelled||this.danger},set typing(e){this._typing=e},get typing(){return this._typing||this.dim},set placeholder(e){this._placeholder=e},get placeholder(){return this._placeholder||this.primary.dim},set highlight(e){this._highlight=e},get highlight(){return this._highlight||this.inverse},merge:(e={})=>{e.styles&&"boolean"==typeof e.styles.enabled&&(ansiColors.enabled=e.styles.enabled),e.styles&&"boolean"==typeof e.styles.visible&&(ansiColors.visible=e.styles.visible);let t=utils.merge({},styles,e.styles);delete t.merge;for(let e of Object.keys(ansiColors))t.hasOwnProperty(e)||Reflect.defineProperty(t,e,{get:()=>ansiColors[e]});for(let e of Object.keys(ansiColors.styles))t.hasOwnProperty(e)||Reflect.defineProperty(t,e,{get:()=>ansiColors[e]});return t}};var styles_1=styles;const isWindows="win32"===process.platform,symbols$1={...ansiColors.symbols,upDownDoubleArrow:"⇕",upDownDoubleArrow2:"⬍",upDownArrow:"↕",asterisk:"*",asterism:"⁂",bulletWhite:"◦",electricArrow:"⌁",ellipsisLarge:"⋯",ellipsisSmall:"…",fullBlock:"█",identicalTo:"≡",indicator:ansiColors.symbols.check,leftAngle:"‹",mark:"※",minus:"−",multiplication:"×",obelus:"÷",percent:"%",pilcrow:"¶",pilcrow2:"❡",pencilUpRight:"✐",pencilDownRight:"✎",pencilRight:"✏",plus:"+",plusMinus:"±",pointRight:"☞",rightAngle:"›",section:"§",hexagon:{off:"⬡",on:"⬢",disabled:"⬢"},ballot:{on:"☑",off:"☐",disabled:"☒"},stars:{on:"★",off:"☆",disabled:"☆"},folder:{on:"▼",off:"▶",disabled:"▶"},prefix:{pending:ansiColors.symbols.question,submitted:ansiColors.symbols.check,cancelled:ansiColors.symbols.cross},separator:{pending:ansiColors.symbols.pointerSmall,submitted:ansiColors.symbols.middot,cancelled:ansiColors.symbols.middot},radio:{off:isWindows?"( )":"◯",on:isWindows?"(*)":"◉",disabled:isWindows?"(|)":"Ⓘ"},numbers:["⓪","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳","㉑","㉒","㉓","㉔","㉕","㉖","㉗","㉘","㉙","㉚","㉛","㉜","㉝","㉞","㉟","㊱","㊲","㊳","㊴","㊵","㊶","㊷","㊸","㊹","㊺","㊻","㊼","㊽","㊾","㊿"]};symbols$1.merge=e=>{let t=utils.merge({},ansiColors.symbols,symbols$1,e.symbols);return delete t.merge,t};var symbols_1=symbols$1,theme=e=>{e.options=utils.merge({},e.options.theme,e.options),e.symbols=symbols_1.merge(e.options),e.styles=styles_1.merge(e.options)},ansi_1=createCommonjsModule(function(e,t){const s="Apple_Terminal"===process.env.TERM_PROGRAM,i=e.exports=t,r="[";let n=!1;const a=i.code={bell:"",beep:"",beginning:"[G",down:"[J",esc:r,getPosition:"[6n",hide:"[?25l",line:"[2K",lineEnd:"[K",lineStart:"[1K",restorePosition:r+(s?"8":"u"),savePosition:r+(s?"7":"s"),screen:"[2J",show:"[?25h",up:"[1J"},o=i.cursor={get hidden(){return n},hide:()=>(n=!0,a.hide),show:()=>(n=!1,a.show),forward:(e=1)=>`[${e}C`,backward:(e=1)=>`[${e}D`,nextLine:(e=1)=>"[E".repeat(e),prevLine:(e=1)=>"[F".repeat(e),up:(e=1)=>e?`[${e}A`:"",down:(e=1)=>e?`[${e}B`:"",right:(e=1)=>e?`[${e}C`:"",left:(e=1)=>e?`[${e}D`:"",to:(e,t)=>t?`[${t+1};${e+1}H`:`[${e+1}G`,move(e=0,t=0){let s="";return s+=e<0?o.left(-e):e>0?o.right(e):"",s+=t<0?o.up(-t):t>0?o.down(t):""},restore(e={}){let{after:t,cursor:s,initial:r,input:n,prompt:a,size:o,value:l}=e;if(r=utils.isPrimitive(r)?String(r):"",n=utils.isPrimitive(n)?String(n):"",l=utils.isPrimitive(l)?String(l):"",o){let e=i.cursor.up(o)+i.cursor.to(a.length),t=n.length-s;return t>0&&(e+=i.cursor.left(t)),e}if(l||t){let e=!n&&r?-r.length:-n.length+s;return t&&(e-=t.length),""===n&&r&&!a.includes(r)&&(e+=r.length),i.cursor.move(e)}}},l=i.erase={screen:a.screen,up:a.up,down:a.down,line:a.line,lineEnd:a.lineEnd,lineStart:a.lineStart,lines(e){let t="";for(let s=0;s<e;s++)t+=i.erase.line+(s<e-1?i.cursor.up(1):"");return e&&(t+=i.code.beginning),t}};i.clear=(e="",t=process.stdout.columns)=>{if(!t)return l.line+o.to(0);let s=e=>[...ansiColors.unstyle(e)].length,i=e.split(/\r?\n/),r=0;for(let e of i)r+=1+Math.floor(Math.max(s(e)-1,0)/t);return(l.line+o.prevLine()).repeat(r-1)+l.line+o.to(0)}});class Prompt extends events{constructor(e={}){super(),this.name=e.name,this.type=e.type,this.options=e,theme(this),timer(this),this.state=new state(this),this.initial=[e.initial,e.default].find(e=>null!=e),this.stdout=e.stdout||process.stdout,this.stdin=e.stdin||process.stdin,this.scale=e.scale||1,this.term=this.options.term||process.env.TERM_PROGRAM,this.margin=margin(this.options.margin),this.setMaxListeners(0),setOptions(this)}async keypress(e,t={}){this.keypressed=!0;let s=keypress_1.action(e,keypress_1(e,t),this.options.actions);this.state.keypress=s,this.emit("keypress",e,s),this.emit("state",this.state.clone());let i=this.options[s.action]||this[s.action]||this.dispatch;if("function"==typeof i)return i.call(this,e,s);this.alert()}alert(){delete this.state.alert,!1===this.options.show?this.emit("alert"):this.stdout.write(ansi_1.code.beep)}cursorHide(){this.stdout.write(ansi_1.cursor.hide()),utils.onExit(()=>this.cursorShow())}cursorShow(){this.stdout.write(ansi_1.cursor.show())}write(e){e&&(this.stdout&&!1!==this.state.show&&this.stdout.write(e),this.state.buffer+=e)}clear(e=0){let t=this.state.buffer;this.state.buffer="",(t||e)&&!1!==this.options.show&&this.stdout.write(ansi_1.cursor.down(e)+ansi_1.clear(t,this.width))}restore(){if(this.state.closed||!1===this.options.show)return;let{prompt:e,after:t,rest:s}=this.sections(),{cursor:i,initial:r="",input:n="",value:a=""}=this,o={after:t,cursor:i,initial:r,input:n,prompt:e,size:this.state.size=s.length,value:a},l=ansi_1.cursor.restore(o);l&&this.stdout.write(l)}sections(){let{buffer:e,input:t,prompt:s}=this.state;s=ansiColors.unstyle(s);let i=ansiColors.unstyle(e),r=i.indexOf(s),n=i.slice(0,r),a=i.slice(r).split("\n"),o=a[0],l=a[a.length-1],u=(s+(t?" "+t:"")).length,c=u<o.length?o.slice(u+1):"";return{header:n,prompt:o,after:c,rest:a.slice(1),last:l}}async submit(){this.state.submitted=!0,this.state.validating=!0,this.options.onSubmit&&await this.options.onSubmit.call(this,this.name,this.value,this);let e=this.state.error||await this.validate(this.value,this.state);if(!0!==e){let t="\n"+this.symbols.pointer+" ";return t+="string"==typeof e?e.trim():"Invalid input",this.state.error="\n"+this.styles.danger(t),this.state.submitted=!1,await this.render(),await this.alert(),this.state.validating=!1,void(this.state.error=void 0)}this.state.validating=!1,await this.render(),await this.close(),this.value=await this.result(this.value),this.emit("submit",this.value)}async cancel(e){this.state.cancelled=this.state.submitted=!0,await this.render(),await this.close(),"function"==typeof this.options.onCancel&&await this.options.onCancel.call(this,this.name,this.value,this),this.emit("cancel",await this.error(e))}async close(){this.state.closed=!0;try{let e=this.sections(),t=Math.ceil(e.prompt.length/this.width);e.rest&&this.write(ansi_1.cursor.down(e.rest.length)),this.write("\n".repeat(t))}catch(e){}this.emit("close")}start(){this.stop||!1===this.options.show||(this.stop=keypress_1.listen(this,this.keypress.bind(this)),this.once("close",this.stop))}async skip(){return this.skipped=!0===this.options.skip,"function"==typeof this.options.skip&&(this.skipped=await this.options.skip.call(this,this.name,this.value)),this.skipped}async initialize(){let{format:e,options:t,result:s}=this;if(this.format=()=>e.call(this,this.value),this.result=()=>s.call(this,this.value),"function"==typeof t.initial&&(this.initial=await t.initial.call(this,this)),"function"==typeof t.onRun&&await t.onRun.call(this,this),"function"==typeof t.onSubmit){let e=t.onSubmit.bind(this),s=this.submit.bind(this);delete this.options.onSubmit,this.submit=async()=>(await e(this.name,this.value,this),s())}await this.start(),await this.render()}render(){throw new Error("expected prompt to have a custom render method")}run(){return new Promise(async(e,t)=>{if(this.once("submit",e),this.once("cancel",t),await this.skip())return this.render=()=>{},this.submit();await this.initialize(),this.emit("run")})}async element(e,t,s){let{options:i,state:r,symbols:n,timers:a}=this,o=a&&a[e];r.timer=o;let l=i[e]||r[e]||n[e],u=t&&null!=t[e]?t[e]:await l;if(""===u)return u;let c=await this.resolve(u,r,t,s);return!c&&t&&t[e]?this.resolve(l,r,t,s):c}async prefix(){let e=await this.element("prefix")||this.symbols,t=this.timers&&this.timers.prefix,s=this.state;if(s.timer=t,utils.isObject(e)&&(e=e[s.status]||e.pending),!utils.hasColor(e)){return(this.styles[s.status]||this.styles.pending)(e)}return e}async message(){let e=await this.element("message");return utils.hasColor(e)?e:this.styles.strong(e)}async separator(){let e=await this.element("separator")||this.symbols,t=this.timers&&this.timers.separator,s=this.state;s.timer=t;let i=e[s.status]||e.pending||s.separator,r=await this.resolve(i,s);return utils.isObject(r)&&(r=r[s.status]||r.pending),utils.hasColor(r)?r:this.styles.muted(r)}async pointer(e,t){let s=await this.element("pointer",e,t);if("string"==typeof s&&utils.hasColor(s))return s;if(s){let e=this.styles,i=this.index===t,r=i?e.primary:e=>e,n=await this.resolve(s[i?"on":"off"]||s,this.state),a=utils.hasColor(n)?n:r(n);return i?a:" ".repeat(n.length)}}async indicator(e,t){let s=await this.element("indicator",e,t);if("string"==typeof s&&utils.hasColor(s))return s;if(s){let t=this.styles,i=!0===e.enabled,r=i?t.success:t.dark,n=s[i?"on":"off"]||s;return utils.hasColor(n)?n:r(n)}return""}body(){return null}footer(){if("pending"===this.state.status)return this.element("footer")}header(){if("pending"===this.state.status)return this.element("header")}async hint(){if("pending"===this.state.status&&!this.isValue(this.state.input)){let e=await this.element("hint");return utils.hasColor(e)?e:this.styles.muted(e)}}error(e){return this.state.submitted?"":e||this.state.error}format(e){return e}result(e){return e}validate(e){return!0!==this.options.required||this.isValue(e)}isValue(e){return null!=e&&""!==e}resolve(e,...t){return utils.resolve(this,e,...t)}get base(){return Prompt.prototype}get style(){return this.styles[this.state.status]}get height(){return this.options.rows||utils.height(this.stdout,25)}get width(){return this.options.columns||utils.width(this.stdout,80)}get size(){return{width:this.width,height:this.height}}set cursor(e){this.state.cursor=e}get cursor(){return this.state.cursor}set input(e){this.state.input=e}get input(){return this.state.input}set value(e){this.state.value=e}get value(){let{input:e,value:t}=this.state,s=[t,e].find(this.isValue.bind(this));return this.isValue(s)?s:this.initial}static get prompt(){return e=>new this(e).run()}}function setOptions(e){let t=t=>void 0===e[t]||"function"==typeof e[t],s=["actions","choices","initial","margin","roles","styles","symbols","theme","timers","value"],i=["body","footer","error","header","hint","indicator","message","prefix","separator","skip"];for(let r of Object.keys(e.options)){if(s.includes(r))continue;if(/^on[A-Z]/.test(r))continue;let n=e.options[r];"function"==typeof n&&t(r)?i.includes(r)||(e[r]=n.bind(e)):"function"!=typeof e[r]&&(e[r]=n)}}function margin(e){"number"==typeof e&&(e=[e,e,e,e]);let t=[].concat(e||[]),s=e=>e%2==0?"\n":" ",i=[];for(let e=0;e<4;e++){let r=s(e);t[e]?i.push(r.repeat(t[e])):i.push("")}return i}var prompt=Prompt;const roles={default:(e,t)=>t,checkbox(e,t){throw new Error("checkbox role is not implemented yet")},editable(e,t){throw new Error("editable role is not implemented yet")},expandable(e,t){throw new Error("expandable role is not implemented yet")},heading:(e,t)=>(t.disabled="",t.indicator=[t.indicator," "].find(e=>null!=e),t.message=t.message||"",t),input(e,t){throw new Error("input role is not implemented yet")},option:(e,t)=>roles.default(e,t),radio(e,t){throw new Error("radio role is not implemented yet")},separator:(e,t)=>(t.disabled="",t.indicator=[t.indicator," "].find(e=>null!=e),t.message=t.message||e.symbols.line.repeat(5),t),spacer:(e,t)=>t};var roles_1=(e,t={})=>{let s=utils.merge({},roles,t.roles);return s[e]||s.default};const{reorder:reorder,scrollUp:scrollUp,scrollDown:scrollDown,isObject:isObject,swap:swap}=utils;class ArrayPrompt extends prompt{constructor(e){super(e),this.cursorHide(),this.maxSelected=e.maxSelected||1/0,this.multiple=e.multiple||!1,this.initial=e.initial||0,this.delay=e.delay||0,this.longest=0,this.num=""}async initialize(){"function"==typeof this.options.initial&&(this.initial=await this.options.initial.call(this)),await this.reset(!0),await super.initialize()}async reset(){let{choices:e,initial:t,autofocus:s,suggest:i}=this.options;if(this.state._choices=[],this.state.choices=[],this.choices=await Promise.all(await this.toChoices(e)),this.choices.forEach(e=>e.enabled=!1),"function"!=typeof i&&0===this.selectable.length)throw new Error("At least one choice must be selectable");isObject(t)&&(t=Object.keys(t)),Array.isArray(t)?(null!=s&&(this.index=this.findIndex(s)),t.forEach(e=>this.enable(this.find(e))),await this.render()):(null!=s&&(t=s),"string"==typeof t&&(t=this.findIndex(t)),"number"==typeof t&&t>-1&&(this.index=Math.max(0,Math.min(t,this.choices.length)),this.enable(this.find(this.index)))),this.isDisabled(this.focused)&&await this.down()}async toChoices(e,t){this.state.loadingChoices=!0;let s=[],i=0,r=async(e,t)=>{"function"==typeof e&&(e=await e.call(this)),e instanceof Promise&&(e=await e);for(let n=0;n<e.length;n++){let a=e[n]=await this.toChoice(e[n],i++,t);s.push(a),a.choices&&await r(a.choices,a)}return s};return r(e,t).then(e=>(this.state.loadingChoices=!1,e))}async toChoice(e,t,s){if("function"==typeof e&&(e=await e.call(this,this)),e instanceof Promise&&(e=await e),"string"==typeof e&&(e={name:e}),e.normalized)return e;e.normalized=!0;let i=e.value,r=roles_1(e.role,this.options);if("string"!=typeof(e=r(this,e)).disabled||e.hint||(e.hint=e.disabled,e.disabled=!0),!0===e.disabled&&null==e.hint&&(e.hint="(disabled)"),null!=e.index)return e;e.name=e.name||e.key||e.title||e.value||e.message,e.message=e.message||e.name||"",e.value=[e.value,e.name].find(this.isValue.bind(this)),e.input="",e.index=t,e.cursor=0,utils.define(e,"parent",s),e.level=s?s.level+1:1,null==e.indent&&(e.indent=s?s.indent+"  ":e.indent||""),e.path=s?s.path+"."+e.name:e.name,e.enabled=!(!this.multiple||this.isDisabled(e)||!e.enabled&&!this.isSelected(e)),this.isDisabled(e)||(this.longest=Math.max(this.longest,ansiColors.unstyle(e.message).length));let n={...e};return e.reset=(t=n.input,s=n.value)=>{for(let t of Object.keys(n))e[t]=n[t];e.input=t,e.value=s},null==i&&"function"==typeof e.initial&&(e.input=await e.initial.call(this,this.state,e,t)),e}async onChoice(e,t){this.emit("choice",e,t,this),"function"==typeof e.onChoice&&await e.onChoice.call(this,this.state,e,t)}async addChoice(e,t,s){let i=await this.toChoice(e,t,s);return this.choices.push(i),this.index=this.choices.length-1,this.limit=this.choices.length,i}async newItem(e,t,s){let i={name:"New choice name?",editable:!0,newChoice:!0,...e},r=await this.addChoice(i,t,s);return r.updateChoice=()=>{delete r.newChoice,r.name=r.message=r.input,r.input="",r.cursor=0},this.render()}indent(e){return null==e.indent?e.level>1?"  ".repeat(e.level-1):"":e.indent}dispatch(e,t){if(this.multiple&&this[t.name])return this[t.name]();this.alert()}focus(e,t){return"boolean"!=typeof t&&(t=e.enabled),t&&!e.enabled&&this.selected.length>=this.maxSelected?this.alert():(this.index=e.index,e.enabled=t&&!this.isDisabled(e),e)}space(){return this.multiple?(this.toggle(this.focused),this.render()):this.alert()}a(){if(this.maxSelected<this.choices.length)return this.alert();let e=this.selectable.every(e=>e.enabled);return this.choices.forEach(t=>t.enabled=!e),this.render()}i(){return this.choices.length-this.selected.length>this.maxSelected?this.alert():(this.choices.forEach(e=>e.enabled=!e.enabled),this.render())}g(e=this.focused){return this.choices.some(e=>!!e.parent)?(this.toggle(e.parent&&!e.choices?e.parent:e),this.render()):this.a()}toggle(e,t){if(!e.enabled&&this.selected.length>=this.maxSelected)return this.alert();"boolean"!=typeof t&&(t=!e.enabled),e.enabled=t,e.choices&&e.choices.forEach(e=>this.toggle(e,t));let s=e.parent;for(;s;){let e=s.choices.filter(e=>this.isDisabled(e));s.enabled=e.every(e=>!0===e.enabled),s=s.parent}return reset(this,this.choices),this.emit("toggle",e,this),e}enable(e){return this.selected.length>=this.maxSelected?this.alert():(e.enabled=!this.isDisabled(e),e.choices&&e.choices.forEach(this.enable.bind(this)),e)}disable(e){return e.enabled=!1,e.choices&&e.choices.forEach(this.disable.bind(this)),e}number(e){this.num+=e;let t=e=>{let t=Number(e);if(t>this.choices.length-1)return this.alert();let s=this.focused,i=this.choices.find(e=>t===e.index);if(!i.enabled&&this.selected.length>=this.maxSelected)return this.alert();if(-1===this.visible.indexOf(i)){let e=reorder(this.choices),t=e.indexOf(i);if(s.index>t){let s=e.slice(t,t+this.limit),i=e.filter(e=>!s.includes(e));this.choices=s.concat(i)}else{let s=t-this.limit+1;this.choices=e.slice(s).concat(e.slice(0,s))}}return this.index=this.choices.indexOf(i),this.toggle(this.focused),this.render()};return clearTimeout(this.numberTimeout),new Promise(e=>{let s=this.choices.length,i=this.num,r=(s=!1,r)=>{clearTimeout(this.numberTimeout),s&&t(i),this.num="",e(r)};return"0"===i||1===i.length&&Number(i+"0")>s?r(!0):Number(i)>s?r(!1,this.alert()):void(this.numberTimeout=setTimeout(()=>r(!0),this.delay))})}home(){return this.choices=reorder(this.choices),this.index=0,this.render()}end(){let e=this.choices.length-this.limit,t=reorder(this.choices);return this.choices=t.slice(e).concat(t.slice(0,e)),this.index=this.limit-1,this.render()}first(){return this.index=0,this.render()}last(){return this.index=this.visible.length-1,this.render()}prev(){return this.visible.length<=1?this.alert():this.up()}next(){return this.visible.length<=1?this.alert():this.down()}right(){return this.cursor>=this.input.length?this.alert():(this.cursor++,this.render())}left(){return this.cursor<=0?this.alert():(this.cursor--,this.render())}up(){let e=this.choices.length,t=this.visible.length,s=this.index;return!1===this.options.scroll&&0===s?this.alert():e>t&&0===s?this.scrollUp():(this.index=(s-1%e+e)%e,this.isDisabled()?this.up():this.render())}down(){let e=this.choices.length,t=this.visible.length,s=this.index;return!1===this.options.scroll&&s===t-1?this.alert():e>t&&s===t-1?this.scrollDown():(this.index=(s+1)%e,this.isDisabled()?this.down():this.render())}scrollUp(e=0){return this.choices=scrollUp(this.choices),this.index=e,this.isDisabled()?this.up():this.render()}scrollDown(e=this.visible.length-1){return this.choices=scrollDown(this.choices),this.index=e,this.isDisabled()?this.down():this.render()}async shiftUp(){return!0===this.options.sort?(this.sorting=!0,this.swap(this.index-1),await this.up(),void(this.sorting=!1)):this.scrollUp(this.index)}async shiftDown(){return!0===this.options.sort?(this.sorting=!0,this.swap(this.index+1),await this.down(),void(this.sorting=!1)):this.scrollDown(this.index)}pageUp(){return this.visible.length<=1?this.alert():(this.limit=Math.max(this.limit-1,0),this.index=Math.min(this.limit-1,this.index),this._limit=this.limit,this.isDisabled()?this.up():this.render())}pageDown(){return this.visible.length>=this.choices.length?this.alert():(this.index=Math.max(0,this.index),this.limit=Math.min(this.limit+1,this.choices.length),this._limit=this.limit,this.isDisabled()?this.down():this.render())}swap(e){swap(this.choices,this.index,e)}isDisabled(e=this.focused){return!(!e||!["disabled","collapsed","hidden","completing","readonly"].some(t=>!0===e[t]))||e&&"heading"===e.role}isEnabled(e=this.focused){if(Array.isArray(e))return e.every(e=>this.isEnabled(e));if(e.choices){let t=e.choices.filter(e=>!this.isDisabled(e));return e.enabled&&t.every(e=>this.isEnabled(e))}return e.enabled&&!this.isDisabled(e)}isChoice(e,t){return e.name===t||e.index===Number(t)}isSelected(e){return Array.isArray(this.initial)?this.initial.some(t=>this.isChoice(e,t)):this.isChoice(e,this.initial)}map(e=[],t="value"){return[].concat(e||[]).reduce((e,s)=>(e[s]=this.find(s,t),e),{})}filter(e,t){let s="function"==typeof e?e:(t,s)=>[t.name,s].includes(e),i=(this.options.multiple?this.state._choices:this.choices).filter(s);return t?i.map(e=>e[t]):i}find(e,t){if(isObject(e))return t?e[t]:e;let s="function"==typeof e?e:(t,s)=>[t.name,s].includes(e),i=this.choices.find(s);return i?t?i[t]:i:void 0}findIndex(e){return this.choices.indexOf(this.find(e))}async submit(){let e=this.focused;if(!e)return this.alert();if(e.newChoice)return e.input?(e.updateChoice(),this.render()):this.alert();if(this.choices.some(e=>e.newChoice))return this.alert();let{reorder:t,sort:s}=this.options,i=!0===this.multiple,r=this.selected;return void 0===r?this.alert():(Array.isArray(r)&&!1!==t&&!0!==s&&(r=utils.reorder(r)),this.value=i?r.map(e=>e.name):r.name,super.submit())}set choices(e=[]){this.state._choices=this.state._choices||[],this.state.choices=e;for(let t of e)this.state._choices.some(e=>e.name===t.name)||this.state._choices.push(t);if(!this._initial&&this.options.initial){this._initial=!0;let e=this.initial;if("string"==typeof e||"number"==typeof e){let t=this.find(e);t&&(this.initial=t.index,this.focus(t,!0))}}}get choices(){return reset(this,this.state.choices||[])}set visible(e){this.state.visible=e}get visible(){return(this.state.visible||this.choices).slice(0,this.limit)}set limit(e){this.state.limit=e}get limit(){let{state:e,options:t,choices:s}=this,i=e.limit||this._limit||t.limit||s.length;return Math.min(i,this.height)}set value(e){super.value=e}get value(){return"string"!=typeof super.value&&super.value===this.initial?this.input:super.value}set index(e){this.state.index=e}get index(){return Math.max(0,this.state?this.state.index:0)}get enabled(){return this.filter(this.isEnabled.bind(this))}get focused(){let e=this.choices[this.index];return e&&this.state.submitted&&!0!==this.multiple&&(e.enabled=!0),e}get selectable(){return this.choices.filter(e=>!this.isDisabled(e))}get selected(){return this.multiple?this.enabled:this.focused}}function reset(e,t){if(t instanceof Promise)return t;if("function"==typeof t){if(utils.isAsyncFn(t))return t;t=t.call(e,e)}for(let s of t){if(Array.isArray(s.choices)){let t=s.choices.filter(t=>!e.isDisabled(t));s.enabled=t.every(e=>!0===e.enabled)}!0===e.isDisabled(s)&&delete s.enabled}return t}var array=ArrayPrompt;class SelectPrompt extends array{constructor(e){super(e),this.emptyError=this.options.emptyError||"No items were selected"}async dispatch(e,t){if(this.multiple)return this[t.name]?await this[t.name](e,t):await super.dispatch(e,t);this.alert()}separator(){if(this.options.separator)return super.separator();let e=this.styles.muted(this.symbols.ellipsis);return this.state.submitted?super.separator():e}pointer(e,t){return!this.multiple||this.options.pointer?super.pointer(e,t):""}indicator(e,t){return this.multiple?super.indicator(e,t):""}choiceMessage(e,t){let s=this.resolve(e.message,this.state,e,t);return"heading"!==e.role||utils.hasColor(s)||(s=this.styles.strong(s)),this.resolve(s,this.state,e,t)}choiceSeparator(){return":"}async renderChoice(e,t){await this.onChoice(e,t);let s=this.index===t,i=await this.pointer(e,t),r=await this.indicator(e,t)+(e.pad||""),n=await this.resolve(e.hint,this.state,e,t);n&&!utils.hasColor(n)&&(n=this.styles.muted(n));let a=this.indent(e),o=await this.choiceMessage(e,t),l=()=>[this.margin[3],a+i+r,o,this.margin[1],n].filter(Boolean).join(" ");return"heading"===e.role?l():e.disabled?(utils.hasColor(o)||(o=this.styles.disabled(o)),l()):(s&&(o=this.styles.em(o)),l())}async renderChoices(){if("choices"===this.state.loading)return this.styles.warning("Loading choices");if(this.state.submitted)return"";let e=this.visible.map(async(e,t)=>await this.renderChoice(e,t)),t=await Promise.all(e);t.length||t.push(this.styles.danger("No matching choices"));let s,i=this.margin[0]+t.join("\n");return this.options.choicesHeader&&(s=await this.resolve(this.options.choicesHeader,this.state)),[s,i].filter(Boolean).join("\n")}format(){return this.state.submitted?Array.isArray(this.selected)?this.selected.map(e=>this.styles.primary(e.name)).join(", "):this.styles.primary(this.selected.name):""}async render(){let{submitted:e,size:t}=this.state,s="",i=await this.header(),r=await this.prefix(),n=await this.separator(),a=await this.message();!1!==this.options.promptLine&&(s=[r,a,n,""].join(" "),this.state.prompt=s);let o=await this.format(),l=await this.error()||await this.hint(),u=await this.renderChoices(),c=await this.footer();o&&(s+=o),l&&!s.includes(l)&&(s+=" "+l),e&&!o&&!u.trim()&&this.multiple&&null!=this.emptyError&&(s+=this.styles.danger(this.emptyError)),this.clear(t),this.write([i,s,u,c].filter(Boolean).join("\n")),this.write(this.margin[2]),this.restore()}}var select=SelectPrompt;const highlight=(e,t)=>{let s=e.toLowerCase();return e=>{let i=e.toLowerCase().indexOf(s),r=t(e.slice(i,i+s.length));return e.slice(0,i)+r+e.slice(i+s.length)}};class AutoComplete extends select{constructor(e){super(e),this.cursorShow()}moveCursor(e){this.state.cursor+=e}dispatch(e){return this.append(e)}space(e){return this.options.multiple?super.space(e):this.append(e)}append(e){let{cursor:t,input:s}=this.state;return this.input=s.slice(0,t)+e+s.slice(t),this.moveCursor(1),this.complete()}delete(){let{cursor:e,input:t}=this.state;return t?(this.input=t.slice(0,e-1)+t.slice(e),this.moveCursor(-1),this.complete()):this.alert()}deleteForward(){let{cursor:e,input:t}=this.state;return void 0===t[e]?this.alert():(this.input=`${t}`.slice(0,e)+`${t}`.slice(e+1),this.complete())}async complete(){this.completing=!0,this.choices=await this.suggest(this.input,this.state._choices),this.state.limit=void 0,this.index=Math.min(Math.max(this.visible.length-1,0),this.index),await this.render(),this.completing=!1}suggest(e=this.input,t=this.state._choices){if("function"==typeof this.options.suggest)return this.options.suggest.call(this,e,t);let s=e.toLowerCase();return t.filter(e=>e.message.toLowerCase().includes(s))}pointer(){return""}format(){if(!this.focused)return this.input;if(this.options.multiple&&this.state.submitted)return this.selected.map(e=>this.styles.primary(e.message)).join(", ");if(this.state.submitted){let e=this.value=this.input=this.focused.value;return this.styles.primary(e)}return this.input}async render(){if("pending"!==this.state.status)return super.render();let e=this.options.highlight?this.options.highlight.bind(this):this.styles.placeholder,t=highlight(this.input,e),s=this.choices;this.choices=s.map(e=>({...e,message:t(e.message)})),await super.render(),this.choices=s}submit(){return this.options.multiple&&(this.value=this.selected.map(e=>e.name)),super.submit()}}var autocomplete=AutoComplete;const{isPrimitive:isPrimitive,hasColor:hasColor}=utils;class BooleanPrompt extends prompt{constructor(e){super(e),this.cursorHide()}async initialize(){let e=await this.resolve(this.initial,this.state);this.input=await this.cast(e),await super.initialize()}dispatch(e){return this.isValue(e)?(this.input=e,this.submit()):this.alert()}format(e){let{styles:t,state:s}=this;return s.submitted?t.success(e):t.primary(e)}cast(e){return this.isTrue(e)}isTrue(e){return/^[ty1]/i.test(e)}isFalse(e){return/^[fn0]/i.test(e)}isValue(e){return isPrimitive(e)&&(this.isTrue(e)||this.isFalse(e))}async hint(){if("pending"===this.state.status){let e=await this.element("hint");return hasColor(e)?e:this.styles.muted(e)}}async render(){let{input:e,size:t}=this.state,s=await this.prefix(),i=await this.separator(),r=[s,await this.message(),this.styles.muted(this.default),i].filter(Boolean).join(" ");this.state.prompt=r;let n=await this.header(),a=this.value=this.cast(e),o=await this.format(a),l=await this.error()||await this.hint(),u=await this.footer();l&&!r.includes(l)&&(o+=" "+l),r+=" "+o,this.clear(t),this.write([n,r,u].filter(Boolean).join("\n")),this.restore()}set value(e){super.value=e}get value(){return this.cast(super.value)}}var boolean_1=BooleanPrompt;class ConfirmPrompt extends boolean_1{constructor(e){super(e),this.default=this.options.default||(this.initial?"(Y/n)":"(y/N)")}}var confirm=ConfirmPrompt,placeholder=(e,t={})=>{e.cursorHide();let{input:s="",initial:i="",pos:r,showCursor:n=!0,color:a}=t,o=a||e.styles.placeholder,l=utils.inverse(e.styles.primary),u=t=>l(e.styles.black(t)),c=s,h=u(" ");if(e.blink&&!0===e.blink.off&&(u=e=>e,h=""),n&&0===r&&""===i&&""===s)return u(" ");if(n&&0===r&&(s===i||""===s))return u(i[0])+o(i.slice(1));i=utils.isPrimitive(i)?`${i}`:"",s=utils.isPrimitive(s)?`${s}`:"";let p=i&&i.startsWith(s)&&i!==s,d=p?u(i[s.length]):h;if(r!==s.length&&!0===n&&(c=s.slice(0,r)+u(s[r])+s.slice(r+1),d=""),!1===n&&(d=""),p){let t=e.styles.unstyle(c+d);return c+d+o(i.slice(t.length))}return c+d};class FormPrompt extends select{constructor(e){super({...e,multiple:!0}),this.type="form",this.initial=this.options.initial,this.align=[this.options.align,"right"].find(e=>null!=e),this.emptyError="",this.values={}}async reset(e){return await super.reset(),!0===e&&(this._index=this.index),this.index=this._index,this.values={},this.choices.forEach(e=>e.reset&&e.reset()),this.render()}dispatch(e){return!!e&&this.append(e)}append(e){let t=this.focused;if(!t)return this.alert();let{cursor:s,input:i}=t;return t.value=t.input=i.slice(0,s)+e+i.slice(s),t.cursor++,this.render()}delete(){let e=this.focused;if(!e||e.cursor<=0)return this.alert();let{cursor:t,input:s}=e;return e.value=e.input=s.slice(0,t-1)+s.slice(t),e.cursor--,this.render()}deleteForward(){let e=this.focused;if(!e)return this.alert();let{cursor:t,input:s}=e;if(void 0===s[t])return this.alert();let i=`${s}`.slice(0,t)+`${s}`.slice(t+1);return e.value=e.input=i,this.render()}right(){let e=this.focused;return e?e.cursor>=e.input.length?this.alert():(e.cursor++,this.render()):this.alert()}left(){let e=this.focused;return e?e.cursor<=0?this.alert():(e.cursor--,this.render()):this.alert()}space(e,t){return this.dispatch(e,t)}number(e,t){return this.dispatch(e,t)}next(){let e=this.focused;if(!e)return this.alert();let{initial:t,input:s}=e;return t&&t.startsWith(s)&&s!==t?(e.value=e.input=t,e.cursor=e.value.length,this.render()):super.next()}prev(){let e=this.focused;return e?0===e.cursor?super.prev():(e.value=e.input="",e.cursor=0,this.render()):this.alert()}separator(){return""}format(e){return this.state.submitted?"":super.format(e)}pointer(){return""}indicator(e){return e.input?"⦿":"⊙"}async choiceSeparator(e,t){let s=await this.resolve(e.separator,this.state,e,t)||":";return s?" "+this.styles.disabled(s):""}async renderChoice(e,t){await this.onChoice(e,t);let{state:s,styles:i}=this,{cursor:r,initial:n="",name:a,hint:o,input:l=""}=e,{muted:u,submitted:c,primary:h,danger:p}=i,d=o,f=this.index===t,g=e.validate||(()=>!0),m=await this.choiceSeparator(e,t),y=e.message;"right"===this.align&&(y=y.padStart(this.longest+1," ")),"left"===this.align&&(y=y.padEnd(this.longest+1," "));let b=this.values[a]=l||n,w=l?"success":"dark";!0!==await g.call(e,b,this.state)&&(w="danger");let v=(0,i[w])(await this.indicator(e,t))+(e.pad||""),E=this.indent(e),S=()=>[E,v,y+m,l,d].filter(Boolean).join(" ");if(s.submitted)return y=ansiColors.unstyle(y),l=c(l),d="",S();if(e.format)l=await e.format.call(this,l,e,t);else{let e=this.styles.muted;l=placeholder(this,{input:l,initial:n,pos:r,showCursor:f,color:e})}return this.isValue(l)||(l=this.styles.muted(this.symbols.ellipsis)),e.result&&(this.values[a]=await e.result.call(this,b,e,t)),f&&(y=h(y)),e.error?l+=(l?" ":"")+p(e.error.trim()):e.hint&&(l+=(l?" ":"")+u(e.hint.trim())),S()}async submit(){return this.value=this.values,super.base.submit.call(this)}}var form=FormPrompt;const form$1=form.prototype;class Editable extends select{constructor(e){super({...e,multiple:!0}),this.align=[this.options.align,"left"].find(e=>null!=e),this.emptyError="",this.values={}}dispatch(e,t){let s=this.focused,i=s.parent||{};return s.editable||i.editable||"a"!==e&&"i"!==e?form$1.dispatch.call(this,e,t):super[e]()}append(e,t){return form$1.append.call(this,e,t)}delete(e,t){return form$1.delete.call(this,e,t)}space(e){return this.focused.editable?this.append(e):super.space()}number(e){return this.focused.editable?this.append(e):super.number(e)}next(){return this.focused.editable?form$1.next.call(this):super.next()}prev(){return this.focused.editable?form$1.prev.call(this):super.prev()}async indicator(e,t){let s=e.indicator||"",i=e.editable?s:super.indicator(e,t);return await this.resolve(i,this.state,e,t)||""}indent(e){return"heading"===e.role?"":e.editable?" ":"  "}async renderChoice(e,t){return e.indent="",e.editable?form$1.renderChoice.call(this,e,t):super.renderChoice(e,t)}submit(){if(!0===this.focused.newChoice)return super.submit();if(this.choices.some(e=>e.newChoice))return this.alert();this.value={};for(let e of this.choices){let t=e.parent?this.value[e.parent.name]:this.value;"heading"!==e.role?e.editable?t[e.name]=e.value===e.name?e.initial||"":e.value:this.isDisabled(e)||(t[e.name]=!0===e.enabled):this.value[e.name]={}}return this.base.submit.call(this)}}var editable=Editable;const{isPrimitive:isPrimitive$1}=utils;class StringPrompt extends prompt{constructor(e){super(e),this.initial=isPrimitive$1(this.initial)?String(this.initial):"",this.initial&&this.cursorHide(),this.state.prevCursor=0,this.state.clipboard=[]}async keypress(e,t={}){let s=this.state.prevKeypress;return this.state.prevKeypress=t,!0!==this.options.multiline||"return"!==t.name||s&&"return"===s.name?super.keypress(e,t):this.append("\n",t)}moveCursor(e){this.cursor+=e}reset(){return this.input=this.value="",this.cursor=0,this.render()}dispatch(e,t){if(!e||t.ctrl||t.code)return this.alert();this.append(e)}append(e){let{cursor:t,input:s}=this.state;this.input=`${s}`.slice(0,t)+e+`${s}`.slice(t),this.moveCursor(String(e).length),this.render()}insert(e){this.append(e)}delete(){let{cursor:e,input:t}=this.state;if(e<=0)return this.alert();this.input=`${t}`.slice(0,e-1)+`${t}`.slice(e),this.moveCursor(-1),this.render()}deleteForward(){let{cursor:e,input:t}=this.state;if(void 0===t[e])return this.alert();this.input=`${t}`.slice(0,e)+`${t}`.slice(e+1),this.render()}cutForward(){let e=this.cursor;if(this.input.length<=e)return this.alert();this.state.clipboard.push(this.input.slice(e)),this.input=this.input.slice(0,e),this.render()}cutLeft(){let e=this.cursor;if(0===e)return this.alert();let t=this.input.slice(0,e),s=this.input.slice(e),i=t.split(" ");this.state.clipboard.push(i.pop()),this.input=i.join(" "),this.cursor=this.input.length,this.input+=s,this.render()}paste(){if(!this.state.clipboard.length)return this.alert();this.insert(this.state.clipboard.pop()),this.render()}toggleCursor(){this.state.prevCursor?(this.cursor=this.state.prevCursor,this.state.prevCursor=0):(this.state.prevCursor=this.cursor,this.cursor=0),this.render()}first(){this.cursor=0,this.render()}last(){this.cursor=this.input.length-1,this.render()}next(){let e=null!=this.initial?String(this.initial):"";if(!e||!e.startsWith(this.input))return this.alert();this.input=this.initial,this.cursor=this.initial.length,this.render()}prev(){if(!this.input)return this.alert();this.reset()}backward(){return this.left()}forward(){return this.right()}right(){return this.cursor>=this.input.length?this.alert():(this.moveCursor(1),this.render())}left(){return this.cursor<=0?this.alert():(this.moveCursor(-1),this.render())}isValue(e){return!!e}async format(e=this.value){let t=await this.resolve(this.initial,this.state);return this.state.submitted?this.styles.submitted(e||t):placeholder(this,{input:e,initial:t,pos:this.cursor})}async render(){let e=this.state.size,t=await this.prefix(),s=await this.separator(),i=[t,await this.message(),s].filter(Boolean).join(" ");this.state.prompt=i;let r=await this.header(),n=await this.format(),a=await this.error()||await this.hint(),o=await this.footer();a&&!n.includes(a)&&(n+=" "+a),i+=" "+n,this.clear(e),this.write([r,i,o].filter(Boolean).join("\n")),this.restore()}}var string=StringPrompt;const unique=e=>e.filter((t,s)=>e.lastIndexOf(t)===s),compact=e=>unique(e).filter(Boolean);var completer=(e,t={},s="")=>{let i,r,{past:n=[],present:a=""}=t;switch(e){case"prev":case"undo":return i=n.slice(0,n.length-1),r=n[n.length-1]||"",{past:compact([s,...i]),present:r};case"next":case"redo":return i=n.slice(1),r=n[0]||"",{past:compact([...i,s]),present:r};case"save":return{past:compact([...n,s]),present:""};case"remove":return a="",(r=compact(n.filter(e=>e!==s))).length&&(a=r.pop()),{past:r,present:a};default:throw new Error(`Invalid action: "${e}"`)}};class Input extends string{constructor(e){super(e);let t=this.options.history;if(t&&t.store){let e=t.values||this.initial;this.autosave=!!t.autosave,this.store=t.store,this.data=this.store.get("values")||{past:[],present:e},this.initial=this.data.present||this.data.past[this.data.past.length-1]}}completion(e){return this.store?(this.data=completer(e,this.data,this.input),this.data.present?(this.input=this.data.present,this.cursor=this.input.length,this.render()):this.alert()):this.alert()}altUp(){return this.completion("prev")}altDown(){return this.completion("next")}prev(){return this.save(),super.prev()}save(){this.store&&(this.data=completer("save",this.data,this.input),this.store.set("values",this.data))}submit(){return this.store&&!0===this.autosave&&this.save(),super.submit()}}var input=Input;class InvisiblePrompt extends string{format(){return""}}var invisible=InvisiblePrompt;class ListPrompt extends string{constructor(e={}){super(e),this.sep=this.options.separator||/, */,this.initial=e.initial||""}split(e=this.value){return e?String(e).split(this.sep):[]}format(){let e=this.state.submitted?this.styles.primary:e=>e;return this.list.map(e).join(", ")}submit(e){return this.value=this.list,super.submit()}get list(){return this.split()}}var list=ListPrompt;class MultiSelect extends select{constructor(e){super({...e,multiple:!0})}}var multiselect=MultiSelect;class NumberPrompt extends string{constructor(e={}){super({style:"number",...e}),this.min=this.isValue(e.min)?this.toNumber(e.min):-1/0,this.max=this.isValue(e.max)?this.toNumber(e.max):1/0,this.delay=null!=e.delay?e.delay:1e3,this.float=!1!==e.float,this.round=!0===e.round||!1===e.float,this.major=e.major||10,this.minor=e.minor||1,this.initial=null!=e.initial?e.initial:"",this.input=String(this.initial),this.cursor=this.input.length,this.cursorShow()}append(e){return!/[-+.]/.test(e)||"."===e&&this.input.includes(".")?this.alert("invalid number"):super.append(e)}number(e){return super.append(e)}next(){return this.input&&this.input!==this.initial?this.alert():this.isValue(this.initial)?(this.input=this.initial,this.cursor=String(this.initial).length,this.render()):this.alert()}up(e){let t=e||this.minor,s=this.toNumber(this.input);return s>this.max+t?this.alert():(this.input=`${s+t}`,this.render())}down(e){let t=e||this.minor,s=this.toNumber(this.input);return s<this.min-t?this.alert():(this.input=`${s-t}`,this.render())}shiftDown(){return this.down(this.major)}shiftUp(){return this.up(this.major)}format(e=this.input){return"function"==typeof this.options.format?this.options.format.call(this,e):this.styles.info(e)}toNumber(e=""){return this.float?+e:Math.round(+e)}isValue(e){return/^[-+]?[0-9]+((\.)|(\.[0-9]+))?$/.test(e)}submit(){let e=[this.input,this.initial].find(e=>this.isValue(e));return this.value=this.toNumber(e||0),super.submit()}}var number=NumberPrompt,numeral=number;class PasswordPrompt extends string{constructor(e){super(e),this.cursorShow()}format(e=this.input){if(!this.keypressed)return"";return(this.state.submitted?this.styles.primary:this.styles.muted)(this.symbols.asterisk.repeat(e.length))}}var password=PasswordPrompt;class LikertScale extends array{constructor(e={}){super(e),this.widths=[].concat(e.messageWidth||50),this.align=[].concat(e.align||"left"),this.linebreak=e.linebreak||!1,this.edgeLength=e.edgeLength||3,this.newline=e.newline||"\n   ";let t=e.startNumber||1;"number"==typeof this.scale&&(this.scaleKey=!1,this.scale=Array(this.scale).fill(0).map((e,s)=>({name:s+t})))}async reset(){return this.tableized=!1,await super.reset(),this.render()}tableize(){if(!0===this.tableized)return;this.tableized=!0;let e=0;for(let t of this.choices){e=Math.max(e,t.message.length),t.scaleIndex=t.initial||2,t.scale=[];for(let e=0;e<this.scale.length;e++)t.scale.push({index:e})}this.widths[0]=Math.min(this.widths[0],e+3)}async dispatch(e,t){if(this.multiple)return this[t.name]?await this[t.name](e,t):await super.dispatch(e,t);this.alert()}heading(e,t,s){return this.styles.strong(e)}separator(){return this.styles.muted(this.symbols.ellipsis)}right(){let e=this.focused;return e.scaleIndex>=this.scale.length-1?this.alert():(e.scaleIndex++,this.render())}left(){let e=this.focused;return e.scaleIndex<=0?this.alert():(e.scaleIndex--,this.render())}indent(){return""}format(){if(this.state.submitted){return this.choices.map(e=>this.styles.info(e.index)).join(", ")}return""}pointer(){return""}renderScaleKey(){if(!1===this.scaleKey)return"";if(this.state.submitted)return"";return["",...this.scale.map(e=>`   ${e.name} - ${e.message}`)].map(e=>this.styles.muted(e)).join("\n")}renderScaleHeading(e){let t=this.scale.map(e=>e.name);"function"==typeof this.options.renderScaleHeading&&(t=this.options.renderScaleHeading.call(this,e));let s=this.scaleLength-t.join("").length,i=Math.round(s/(t.length-1)),r=t.map(e=>this.styles.strong(e)).join(" ".repeat(i)),n=" ".repeat(this.widths[0]);return this.margin[3]+n+this.margin[1]+r}scaleIndicator(e,t,s){if("function"==typeof this.options.scaleIndicator)return this.options.scaleIndicator.call(this,e,t,s);let i=e.scaleIndex===t.index;return t.disabled?this.styles.hint(this.symbols.radio.disabled):i?this.styles.success(this.symbols.radio.on):this.symbols.radio.off}renderScale(e,t){let s=e.scale.map(s=>this.scaleIndicator(e,s,t)),i="Hyper"===this.term?"":" ";return s.join(i+this.symbols.line.repeat(this.edgeLength))}async renderChoice(e,t){await this.onChoice(e,t);let s=this.index===t,i=await this.pointer(e,t),r=await e.hint;r&&!utils.hasColor(r)&&(r=this.styles.muted(r));let n=e=>this.margin[3]+e.replace(/\s+$/,"").padEnd(this.widths[0]," "),a=this.newline,o=this.indent(e),l=await this.resolve(e.message,this.state,e,t),u=await this.renderScale(e,t),c=this.margin[1]+this.margin[3];this.scaleLength=ansiColors.unstyle(u).length,this.widths[0]=Math.min(this.widths[0],this.width-this.scaleLength-c.length);let h=utils.wordWrap(l,{width:this.widths[0],newline:a}).split("\n").map(e=>n(e)+this.margin[1]);return s&&(u=this.styles.info(u),h=h.map(e=>this.styles.info(e))),h[0]+=u,this.linebreak&&h.push(""),[o+i,h.join("\n")].filter(Boolean)}async renderChoices(){if(this.state.submitted)return"";this.tableize();let e=this.visible.map(async(e,t)=>await this.renderChoice(e,t)),t=await Promise.all(e),s=await this.renderScaleHeading();return this.margin[0]+[s,...t.map(e=>e.join(" "))].join("\n")}async render(){let{submitted:e,size:t}=this.state,s=await this.prefix(),i=await this.separator(),r=await this.message(),n="";!1!==this.options.promptLine&&(n=[s,r,i,""].join(" "),this.state.prompt=n);let a=await this.header(),o=await this.format(),l=await this.renderScaleKey(),u=await this.error()||await this.hint(),c=await this.renderChoices(),h=await this.footer(),p=this.emptyError;o&&(n+=o),u&&!n.includes(u)&&(n+=" "+u),e&&!o&&!c.trim()&&this.multiple&&null!=p&&(n+=this.styles.danger(p)),this.clear(t),this.write([a,n,l,c,h].filter(Boolean).join("\n")),this.state.submitted||this.write(this.margin[2]),this.restore()}submit(){this.value={};for(let e of this.choices)this.value[e.name]=e.scaleIndex;return this.base.submit.call(this)}}var scale=LikertScale;const clean=(e="")=>"string"==typeof e?e.replace(/^['"]|['"]$/g,""):"";class Item{constructor(e){this.name=e.key,this.field=e.field||{},this.value=clean(e.initial||this.field.initial||""),this.message=e.message||this.name,this.cursor=0,this.input="",this.lines=[]}}const tokenize=async(e={},t={},s=(e=>e))=>{let i=new Set,r=e.fields||[],n=e.template,a=[],o=[],l=[],u=1;"function"==typeof n&&(n=await n());let c=-1,h=()=>n[++c],p=()=>n[c+1],d=e=>{e.line=u,a.push(e)};for(d({type:"bos",value:""});c<n.length-1;){let e=h();if(/^[^\S\n ]$/.test(e)){d({type:"text",value:e});continue}if("\n"===e){d({type:"newline",value:e}),u++;continue}if("\\"===e){d({type:"text",value:e+=h()});continue}if(("$"===e||"#"===e||"{"===e)&&"{"===p()){let n,a={type:"template",open:e+=h(),inner:"",close:"",value:e};for(;n=h();){if("}"===n){"}"===p()&&(n+=h()),a.value+=n,a.close=n;break}":"===n?(a.initial="",a.key=a.inner):void 0!==a.initial&&(a.initial+=n),a.value+=n,a.inner+=n}a.template=a.open+(a.initial||a.inner)+a.close,a.key=a.key||a.inner,t.hasOwnProperty(a.key)&&(a.initial=t[a.key]),d(a=s(a)),l.push(a.key),i.add(a.key);let u=o.find(e=>e.name===a.key);a.field=r.find(e=>e.name===a.key),u||(u=new Item(a),o.push(u)),u.lines.push(a.line-1);continue}let n=a[a.length-1];"text"===n.type&&n.line===u?n.value+=e:d({type:"text",value:e})}return d({type:"eos",value:""}),{input:n,tabstops:a,unique:i,keys:l,items:o}};var interpolate=async e=>{let t=e.options,s=new Set(!0===t.required?[]:t.required||[]),i={...t.values,...t.initial},{tabstops:r,items:n,keys:a}=await tokenize(t,i),o=createFn("result",e),l=createFn("format",e),u=createFn("validate",e,t,!0),c=e.isValue.bind(e);return async(i={},h=!1)=>{let p=0;i.required=s,i.items=n,i.keys=a,i.output="";let d=async(e,t,s,i)=>{let r=await u(e,t,s,i);return!1===r?"Invalid field "+s.name:r};for(let s of r){let r=s.value,a=s.key;if("template"===s.type){if("template"===s.type){let u=n.find(e=>e.name===a);!0===t.required&&i.required.add(u.name);let f=[u.input,i.values[u.value],u.value,r].find(c),g=(u.field||{}).message||s.inner;if(h){let e=await d(i.values[a],i,u,p);if(e&&"string"==typeof e||!1===e){i.invalid.set(a,e);continue}i.invalid.delete(a);let t=await o(i.values[a],i,u,p);i.output+=ansiColors.unstyle(t);continue}u.placeholder=!1;let m=r;f!==(r=await l(r,i,u,p))?(i.values[a]=f,r=e.styles.typing(f),i.missing.delete(g)):(i.values[a]=void 0,f=`<${g}>`,r=e.styles.primary(f),u.placeholder=!0,i.required.has(a)&&i.missing.add(g)),i.missing.has(g)&&i.validating&&(r=e.styles.warning(f)),i.invalid.has(a)&&i.validating&&(r=e.styles.danger(f)),p===i.index&&(r=m!==r?e.styles.underline(r):e.styles.heading(ansiColors.unstyle(r))),p++}r&&(i.output+=r)}else r&&(i.output+=r)}let f=i.output.split("\n").map(e=>" "+e),g=n.length,m=0;for(let t of n)i.invalid.has(t.name)&&t.lines.forEach(e=>{" "===f[e][0]&&(f[e]=i.styles.danger(i.symbols.bullet)+f[e].slice(1))}),e.isValue(i.values[t.name])&&m++;return i.completed=(m/g*100).toFixed(0),i.output=f.join("\n"),i.output}};function createFn(e,t,s,i){return(s,r,n,a)=>"function"==typeof n.field[e]?n.field[e].call(t,s,r,n,a):[i,s].find(e=>t.isValue(e))}class SnippetPrompt extends prompt{constructor(e){super(e),this.cursorHide(),this.reset(!0)}async initialize(){this.interpolate=await interpolate(this),await super.initialize()}async reset(e){this.state.keys=[],this.state.invalid=new Map,this.state.missing=new Set,this.state.completed=0,this.state.values={},!0!==e&&(await this.initialize(),await this.render())}moveCursor(e){let t=this.getItem();this.cursor+=e,t.cursor+=e}dispatch(e,t){t.code||t.ctrl||null==e||!this.getItem()?this.alert():this.append(e,t)}append(e,t){let s=this.getItem(),i=s.input.slice(0,this.cursor),r=s.input.slice(this.cursor);this.input=s.input=`${i}${e}${r}`,this.moveCursor(1),this.render()}delete(){let e=this.getItem();if(this.cursor<=0||!e.input)return this.alert();let t=e.input.slice(this.cursor),s=e.input.slice(0,this.cursor-1);this.input=e.input=`${s}${t}`,this.moveCursor(-1),this.render()}increment(e){return e>=this.state.keys.length-1?0:e+1}decrement(e){return e<=0?this.state.keys.length-1:e-1}first(){this.state.index=0,this.render()}last(){this.state.index=this.state.keys.length-1,this.render()}right(){if(this.cursor>=this.input.length)return this.alert();this.moveCursor(1),this.render()}left(){if(this.cursor<=0)return this.alert();this.moveCursor(-1),this.render()}prev(){this.state.index=this.decrement(this.state.index),this.getItem(),this.render()}next(){this.state.index=this.increment(this.state.index),this.getItem(),this.render()}up(){this.prev()}down(){this.next()}format(e){let t=this.state.completed<100?this.styles.warning:this.styles.success;return!0===this.state.submitted&&100!==this.state.completed&&(t=this.styles.danger),t(`${this.state.completed}% completed`)}async render(){let{index:e,keys:t=[],submitted:s,size:i}=this.state,r=[this.options.newline,"\n"].find(e=>null!=e),n=await this.prefix(),a=await this.separator(),o=[n,await this.message(),a].filter(Boolean).join(" ");this.state.prompt=o;let l=await this.header(),u=await this.error()||"",c=await this.hint()||"",h=s?"":await this.interpolate(this.state),p=this.state.key=t[e]||"",d=await this.format(p),f=await this.footer();d&&(o+=" "+d),c&&!d&&0===this.state.completed&&(o+=" "+c),this.clear(i);let g=[l,o,h,f,u.trim()];this.write(g.filter(Boolean).join(r)),this.restore()}getItem(e){let{items:t,keys:s,index:i}=this.state,r=t.find(e=>e.name===s[i]);return r&&null!=r.input&&(this.input=r.input,this.cursor=r.cursor),r}async submit(){"function"!=typeof this.interpolate&&await this.initialize(),await this.interpolate(this.state,!0);let{invalid:e,missing:t,output:s,values:i}=this.state;if(e.size){let t="";for(let[s,i]of e)t+=`Invalid ${s}: ${i}\n`;return this.state.error=t,super.submit()}if(t.size)return this.state.error="Required: "+[...t.keys()].join(", "),super.submit();let r=ansiColors.unstyle(s).split("\n").map(e=>e.slice(1)).join("\n");return this.value={values:i,result:r},super.submit()}}var snippet=SnippetPrompt;const hint="(Use <shift>+<up/down> to sort)";class Sort extends select{constructor(e){super({...e,reorder:!1,sort:!0,multiple:!0}),this.state.hint=[this.options.hint,hint].find(this.isValue.bind(this))}indicator(){return""}async renderChoice(e,t){let s=await super.renderChoice(e,t),i=this.symbols.identicalTo+" ",r=this.index===t&&this.sorting?this.styles.muted(i):"  ";return!1===this.options.drag&&(r=""),!0===this.options.numbered?r+`${t+1} - `+s:r+s}get selected(){return this.choices}submit(){return this.value=this.choices.map(e=>e.value),super.submit()}}var sort=Sort;class Survey extends array{constructor(e={}){if(super(e),this.emptyError=e.emptyError||"No items were selected",this.term=process.env.TERM_PROGRAM,!this.options.header){let e=["","4 - Strongly Agree","3 - Agree","2 - Neutral","1 - Disagree","0 - Strongly Disagree",""];e=e.map(e=>this.styles.muted(e)),this.state.header=e.join("\n   ")}}async toChoices(...e){if(this.createdScales)return!1;this.createdScales=!0;let t=await super.toChoices(...e);for(let e of t)e.scale=createScale(5,this.options),e.scaleIdx=2;return t}dispatch(){this.alert()}space(){let e=this.focused,t=e.scale[e.scaleIdx],s=t.selected;return e.scale.forEach(e=>e.selected=!1),t.selected=!s,this.render()}indicator(){return""}pointer(){return""}separator(){return this.styles.muted(this.symbols.ellipsis)}right(){let e=this.focused;return e.scaleIdx>=e.scale.length-1?this.alert():(e.scaleIdx++,this.render())}left(){let e=this.focused;return e.scaleIdx<=0?this.alert():(e.scaleIdx--,this.render())}indent(){return"   "}async renderChoice(e,t){await this.onChoice(e,t);let s=this.index===t,i="Hyper"===this.term,r=i?9:8,n=i?"":" ",a=this.symbols.line.repeat(r),o=" ".repeat(r+(i?0:1)),l=e=>(e?this.styles.success("◉"):"◯")+n,u=t+1+".",c=s?this.styles.heading:this.styles.noop,h=await this.resolve(e.message,this.state,e,t),p=this.indent(e),d=p+e.scale.map((t,s)=>l(s===e.scaleIdx)).join(a),f=p+e.scale.map((t,s)=>(t=>t===e.scaleIdx?c(t):t)(s)).join(o),g=()=>[u,h].filter(Boolean).join(" ");return s&&(d=this.styles.cyan(d),f=this.styles.cyan(f)),(()=>[g(),d,f," "].filter(Boolean).join("\n"))()}async renderChoices(){if(this.state.submitted)return"";let e=this.visible.map(async(e,t)=>await this.renderChoice(e,t)),t=await Promise.all(e);return t.length||t.push(this.styles.danger("No matching choices")),t.join("\n")}format(){if(this.state.submitted){return this.choices.map(e=>this.styles.info(e.scaleIdx)).join(", ")}return""}async render(){let{submitted:e,size:t}=this.state,s=await this.prefix(),i=await this.separator(),r=[s,await this.message(),i].filter(Boolean).join(" ");this.state.prompt=r;let n=await this.header(),a=await this.format(),o=await this.error()||await this.hint(),l=await this.renderChoices(),u=await this.footer();!a&&o||(r+=" "+a),o&&!r.includes(o)&&(r+=" "+o),e&&!a&&!l&&this.multiple&&"form"!==this.type&&(r+=this.styles.danger(this.emptyError)),this.clear(t),this.write([r,n,l,u].filter(Boolean).join("\n")),this.restore()}submit(){this.value={};for(let e of this.choices)this.value[e.name]=e.scaleIdx;return this.base.submit.call(this)}}function createScale(e,t={}){if(Array.isArray(t.scale))return t.scale.map(e=>({...e}));let s=[];for(let t=1;t<e+1;t++)s.push({i:t,selected:!1});return s}var survey=Survey,text=input;class TogglePrompt extends boolean_1{async initialize(){await super.initialize(),this.value=this.initial=!!this.options.initial,this.disabled=this.options.disabled||"no",this.enabled=this.options.enabled||"yes",await this.render()}reset(){this.value=this.initial,this.render()}delete(){this.alert()}toggle(){this.value=!this.value,this.render()}enable(){if(!0===this.value)return this.alert();this.value=!0,this.render()}disable(){if(!1===this.value)return this.alert();this.value=!1,this.render()}up(){this.toggle()}down(){this.toggle()}right(){this.toggle()}left(){this.toggle()}next(){this.toggle()}prev(){this.toggle()}dispatch(e="",t){switch(e.toLowerCase()){case" ":return this.toggle();case"1":case"y":case"t":return this.enable();case"0":case"n":case"f":return this.disable();default:return this.alert()}}format(){let e=e=>this.styles.primary.underline(e);return[this.value?this.disabled:e(this.disabled),this.value?e(this.enabled):this.enabled].join(this.styles.muted(" / "))}async render(){let{size:e}=this.state,t=await this.header(),s=await this.prefix(),i=await this.separator(),r=await this.message(),n=await this.format(),a=await this.error()||await this.hint(),o=await this.footer(),l=[s,r,i,n].join(" ");this.state.prompt=l,a&&!l.includes(a)&&(l+=" "+a),this.clear(e),this.write([t,l,o].filter(Boolean).join("\n")),this.write(this.margin[2]),this.restore()}}var toggle=TogglePrompt,prompts=createCommonjsModule(function(e,t){const s=(e,s)=>{utils.defineExport(t,e,s),utils.defineExport(t,e.toLowerCase(),s)};s("AutoComplete",()=>autocomplete),s("Confirm",()=>confirm),s("Editable",()=>editable),s("Form",()=>form),s("Input",()=>input),s("Invisible",()=>invisible),s("List",()=>list),s("MultiSelect",()=>multiselect),s("Numeral",()=>numeral),s("Password",()=>password),s("Scale",()=>scale),s("Select",()=>select),s("Snippet",()=>snippet),s("Sort",()=>sort),s("Survey",()=>survey),s("Text",()=>text),s("Toggle",()=>toggle)}),types={ArrayPrompt:array,BooleanPrompt:boolean_1,NumberPrompt:number,StringPrompt:string};class Enquirer extends events{constructor(e,t){super(),this.options=utils.merge({},e),this.answers={...t}}register(e,t){if(utils.isObject(e)){for(let t of Object.keys(e))this.register(t,e[t]);return this}assert.equal(typeof t,"function","expected a function");let s=e.toLowerCase();return t.prototype instanceof this.Prompt?this.prompts[s]=t:this.prompts[s]=t(this.Prompt,this),this}async prompt(e=[]){for(let t of[].concat(e))try{"function"==typeof t&&(t=await t.call(this)),await this.ask(utils.merge({},this.options,t))}catch(e){return Promise.reject(e)}return this.answers}async ask(e){"function"==typeof e&&(e=await e.call(this));let t=utils.merge({},this.options,e),{type:s,name:i}=e,{set:r,get:n}=utils;if("function"==typeof s&&(s=await s.call(this,e,this.answers)),!s)return this.answers[i];assert(this.prompts[s],`Prompt "${s}" is not registered`);let a=new this.prompts[s](t),o=n(this.answers,i);a.state.answers=this.answers,a.enquirer=this,i&&a.on("submit",e=>{this.emit("answer",i,e,a),r(this.answers,i,e)});let l=a.emit.bind(a);return a.emit=(...e)=>(this.emit.call(this,...e),l(...e)),this.emit("prompt",a,this),t.autofill&&null!=o?(a.value=a.input=o,"show"===t.autofill&&await a.submit()):o=a.value=await a.run(),o}use(e){return e.call(this,this),this}set Prompt(e){this._Prompt=e}get Prompt(){return this._Prompt||this.constructor.Prompt}get prompts(){return this.constructor.prompts}static set Prompt(e){this._Prompt=e}static get Prompt(){return this._Prompt||prompt}static get prompts(){return prompts}static get types(){return types}static get prompt(){const e=(t,...s)=>{let i=new this(...s),r=i.emit.bind(i);return i.emit=(...t)=>(e.emit(...t),r(...t)),i.prompt(t)};return utils.mixinEmitter(e,new events),e}}utils.mixinEmitter(Enquirer,new events);const prompts$1=Enquirer.prompts;for(let e of Object.keys(prompts$1)){let t=e.toLowerCase(),s=t=>new prompts$1[e](t).run();Enquirer.prompt[t]=s,Enquirer[t]=s,Enquirer[e]||Reflect.defineProperty(Enquirer,e,{get:()=>prompts$1[e]})}const exp=e=>{utils.defineExport(Enquirer,e,()=>Enquirer.types[e])};exp("ArrayPrompt"),exp("BooleanPrompt"),exp("NumberPrompt"),exp("StringPrompt");var enquirer=Enquirer;const chalk=require("chalk"),MOTIVATIONS=["I believe in you.","You are almost there.","I'm an otter...if you didn't know.","Have a hug. <3","Clam's are good.","It's okay. You'll make progress!","At least it's something.","A lot of progress, you'll make.","Don't worry. I got your back.","You are doing good. Keep it up!","You can do this.","Sometimes, I just want to eat clams.","Uh oh. That doesn't look good.","Are you okay?","Have you seen any clams around here?","Found any clams lately?","I like clams.","I got 3 words: Giant. Clams.","I hope this is helpful.","It's better to get an error than to get nothing.","I wonder if clams dream about me.","Clams?","I thought you were gone forever.","Take a break. You deserve it.","Come back in a few minutes. I know you can do it.","Come back in a couple. I'll be here.","That was unexpected.","That's weird.","Where did that come from?","We can share the clam.","I think...I am a clam-lover.","Who's jgs?","When life gives you lemons, you gotta eat another clam.","Is it Friday?","I wonder who writes these.","I hope that's not too bad.","Nothing to be done.","Together at last!","Yes, let's go . . .","We're gonna need a bigger terminal","I have a good feeling about this.","I wonder where clams go?","Thanks for keeping me company.","I never noticed...Am I green?","I got a tail, and I'm not afraid to use it.","In the beginning, we were all just dots and lines. Now, I'm otter.","Aren't you glad to see me? Cause I am.","Nice to see you again.","Haven't seen you around these parts before...Nah, I'm kidding.","Welcome back.","I wonder what's out there.","Am I floating?","Can I breathe?"];function getMotivation(e=-1){return(e<0||e>=MOTIVATIONS.length)&&(e=Math.floor(Math.random()*MOTIVATIONS.length)),MOTIVATIONS[e]}function say(e="..."){console.log(chalk.green(otter(e)))}function otter(e){return`\n     .-"""-.\n    /      o\\     ${e}\n   |    o   0).-.\n   |       .-;(_/     .-.\n    \\     /  /)).---._|  \`\\   ,\n     '.  '  /((       \`'-./ _/|\n       \\  .'  )        .-.;\`  /\n        '.             |  \`\\-'\n          '._        -'    /\n    jgs      \`\`""--\`------\`\n    `}var matchOperatorsRe=/[|\\{}()[\]^$+*?.]/g,escapeStringRegexp=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(matchOperatorsRe,"\\$&")},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},conversions=createCommonjsModule(function(e){var t={};for(var s in colorName)colorName.hasOwnProperty(s)&&(t[colorName[s]]=s);var i=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var r in i)if(i.hasOwnProperty(r)){if(!("channels"in i[r]))throw new Error("missing channels property: "+r);if(!("labels"in i[r]))throw new Error("missing channel labels property: "+r);if(i[r].labels.length!==i[r].channels)throw new Error("channel and label counts mismatch: "+r);var n=i[r].channels,a=i[r].labels;delete i[r].channels,delete i[r].labels,Object.defineProperty(i[r],"channels",{value:n}),Object.defineProperty(i[r],"labels",{value:a})}i.rgb.hsl=function(e){var t,s,i=e[0]/255,r=e[1]/255,n=e[2]/255,a=Math.min(i,r,n),o=Math.max(i,r,n),l=o-a;return o===a?t=0:i===o?t=(r-n)/l:r===o?t=2+(n-i)/l:n===o&&(t=4+(i-r)/l),(t=Math.min(60*t,360))<0&&(t+=360),s=(a+o)/2,[t,100*(o===a?0:s<=.5?l/(o+a):l/(2-o-a)),100*s]},i.rgb.hsv=function(e){var t,s,i,r,n,a=e[0]/255,o=e[1]/255,l=e[2]/255,u=Math.max(a,o,l),c=u-Math.min(a,o,l),h=function(e){return(u-e)/6/c+.5};return 0===c?r=n=0:(n=c/u,t=h(a),s=h(o),i=h(l),a===u?r=i-s:o===u?r=1/3+t-i:l===u&&(r=2/3+s-t),r<0?r+=1:r>1&&(r-=1)),[360*r,100*n,100*u]},i.rgb.hwb=function(e){var t=e[0],s=e[1],r=e[2];return[i.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(s,r))),100*(r=1-1/255*Math.max(t,Math.max(s,r)))]},i.rgb.cmyk=function(e){var t,s=e[0]/255,i=e[1]/255,r=e[2]/255;return[100*((1-s-(t=Math.min(1-s,1-i,1-r)))/(1-t)||0),100*((1-i-t)/(1-t)||0),100*((1-r-t)/(1-t)||0),100*t]},i.rgb.keyword=function(e){var s=t[e];if(s)return s;var i,r,n,a=1/0;for(var o in colorName)if(colorName.hasOwnProperty(o)){var l=colorName[o],u=(r=e,n=l,Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)+Math.pow(r[2]-n[2],2));u<a&&(a=u,i=o)}return i},i.keyword.rgb=function(e){return colorName[e]},i.rgb.xyz=function(e){var t=e[0]/255,s=e[1]/255,i=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*t+.7152*s+.0722*i),100*(.0193*t+.1192*s+.9505*i)]},i.rgb.lab=function(e){var t=i.rgb.xyz(e),s=t[0],r=t[1],n=t[2];return r/=100,n/=108.883,s=(s/=95.047)>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(s-r),200*(r-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},i.hsl.rgb=function(e){var t,s,i,r,n,a=e[0]/360,o=e[1]/100,l=e[2]/100;if(0===o)return[n=255*l,n,n];t=2*l-(s=l<.5?l*(1+o):l+o-l*o),r=[0,0,0];for(var u=0;u<3;u++)(i=a+1/3*-(u-1))<0&&i++,i>1&&i--,n=6*i<1?t+6*(s-t)*i:2*i<1?s:3*i<2?t+(s-t)*(2/3-i)*6:t,r[u]=255*n;return r},i.hsl.hsv=function(e){var t=e[0],s=e[1]/100,i=e[2]/100,r=s,n=Math.max(i,.01);return s*=(i*=2)<=1?i:2-i,r*=n<=1?n:2-n,[t,100*(0===i?2*r/(n+r):2*s/(i+s)),100*((i+s)/2)]},i.hsv.rgb=function(e){var t=e[0]/60,s=e[1]/100,i=e[2]/100,r=Math.floor(t)%6,n=t-Math.floor(t),a=255*i*(1-s),o=255*i*(1-s*n),l=255*i*(1-s*(1-n));switch(i*=255,r){case 0:return[i,l,a];case 1:return[o,i,a];case 2:return[a,i,l];case 3:return[a,o,i];case 4:return[l,a,i];case 5:return[i,a,o]}},i.hsv.hsl=function(e){var t,s,i,r=e[0],n=e[1]/100,a=e[2]/100,o=Math.max(a,.01);return i=(2-n)*a,s=n*o,[r,100*(s=(s/=(t=(2-n)*o)<=1?t:2-t)||0),100*(i/=2)]},i.hwb.rgb=function(e){var t,s,i,r,n,a,o,l=e[0]/360,u=e[1]/100,c=e[2]/100,h=u+c;switch(h>1&&(u/=h,c/=h),i=6*l-(t=Math.floor(6*l)),0!=(1&t)&&(i=1-i),r=u+i*((s=1-c)-u),t){default:case 6:case 0:n=s,a=r,o=u;break;case 1:n=r,a=s,o=u;break;case 2:n=u,a=s,o=r;break;case 3:n=u,a=r,o=s;break;case 4:n=r,a=u,o=s;break;case 5:n=s,a=u,o=r}return[255*n,255*a,255*o]},i.cmyk.rgb=function(e){var t=e[0]/100,s=e[1]/100,i=e[2]/100,r=e[3]/100;return[255*(1-Math.min(1,t*(1-r)+r)),255*(1-Math.min(1,s*(1-r)+r)),255*(1-Math.min(1,i*(1-r)+r))]},i.xyz.rgb=function(e){var t,s,i,r=e[0]/100,n=e[1]/100,a=e[2]/100;return s=-.9689*r+1.8758*n+.0415*a,i=.0557*r+-.204*n+1.057*a,t=(t=3.2406*r+-1.5372*n+-.4986*a)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(t=Math.min(Math.max(0,t),1)),255*(s=Math.min(Math.max(0,s),1)),255*(i=Math.min(Math.max(0,i),1))]},i.xyz.lab=function(e){var t=e[0],s=e[1],i=e[2];return s/=100,i/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(t-s),200*(s-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},i.lab.xyz=function(e){var t,s,i,r=e[0];t=e[1]/500+(s=(r+16)/116),i=s-e[2]/200;var n=Math.pow(s,3),a=Math.pow(t,3),o=Math.pow(i,3);return s=n>.008856?n:(s-16/116)/7.787,t=a>.008856?a:(t-16/116)/7.787,i=o>.008856?o:(i-16/116)/7.787,[t*=95.047,s*=100,i*=108.883]},i.lab.lch=function(e){var t,s=e[0],i=e[1],r=e[2];return(t=360*Math.atan2(r,i)/2/Math.PI)<0&&(t+=360),[s,Math.sqrt(i*i+r*r),t]},i.lch.lab=function(e){var t,s=e[0],i=e[1];return t=e[2]/360*2*Math.PI,[s,i*Math.cos(t),i*Math.sin(t)]},i.rgb.ansi16=function(e){var t=e[0],s=e[1],r=e[2],n=1 in arguments?arguments[1]:i.rgb.hsv(e)[2];if(0===(n=Math.round(n/50)))return 30;var a=30+(Math.round(r/255)<<2|Math.round(s/255)<<1|Math.round(t/255));return 2===n&&(a+=60),a},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){var t=e[0],s=e[1],i=e[2];return t===s&&s===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(s/255*5)+Math.round(i/255*5)},i.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var s=.5*(1+~~(e>50));return[(1&t)*s*255,(t>>1&1)*s*255,(t>>2&1)*s*255]},i.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var s;return e-=16,[Math.floor(e/36)/5*255,Math.floor((s=e%36)/6)/5*255,s%6/5*255]},i.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var s=t[0];3===t[0].length&&(s=s.split("").map(function(e){return e+e}).join(""));var i=parseInt(s,16);return[i>>16&255,i>>8&255,255&i]},i.rgb.hcg=function(e){var t,s=e[0]/255,i=e[1]/255,r=e[2]/255,n=Math.max(Math.max(s,i),r),a=Math.min(Math.min(s,i),r),o=n-a;return t=o<=0?0:n===s?(i-r)/o%6:n===i?2+(r-s)/o:4+(s-i)/o+4,t/=6,[360*(t%=1),100*o,100*(o<1?a/(1-o):0)]},i.hsl.hcg=function(e){var t=e[1]/100,s=e[2]/100,i=1,r=0;return(i=s<.5?2*t*s:2*t*(1-s))<1&&(r=(s-.5*i)/(1-i)),[e[0],100*i,100*r]},i.hsv.hcg=function(e){var t=e[1]/100,s=e[2]/100,i=t*s,r=0;return i<1&&(r=(s-i)/(1-i)),[e[0],100*i,100*r]},i.hcg.rgb=function(e){var t=e[0]/360,s=e[1]/100,i=e[2]/100;if(0===s)return[255*i,255*i,255*i];var r,n=[0,0,0],a=t%1*6,o=a%1,l=1-o;switch(Math.floor(a)){case 0:n[0]=1,n[1]=o,n[2]=0;break;case 1:n[0]=l,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=o;break;case 3:n[0]=0,n[1]=l,n[2]=1;break;case 4:n[0]=o,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=l}return r=(1-s)*i,[255*(s*n[0]+r),255*(s*n[1]+r),255*(s*n[2]+r)]},i.hcg.hsv=function(e){var t=e[1]/100,s=t+e[2]/100*(1-t),i=0;return s>0&&(i=t/s),[e[0],100*i,100*s]},i.hcg.hsl=function(e){var t=e[1]/100,s=e[2]/100*(1-t)+.5*t,i=0;return s>0&&s<.5?i=t/(2*s):s>=.5&&s<1&&(i=t/(2*(1-s))),[e[0],100*i,100*s]},i.hcg.hwb=function(e){var t=e[1]/100,s=t+e[2]/100*(1-t);return[e[0],100*(s-t),100*(1-s)]},i.hwb.hcg=function(e){var t=e[1]/100,s=1-e[2]/100,i=s-t,r=0;return i<1&&(r=(s-i)/(1-i)),[e[0],100*i,100*r]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=i.gray.hsv=function(e){return[0,0,e[0]]},i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),s=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(s.length)+s},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}}),conversions_1=conversions.rgb,conversions_2=conversions.hsl,conversions_3=conversions.hsv,conversions_4=conversions.hwb,conversions_5=conversions.cmyk,conversions_6=conversions.xyz,conversions_7=conversions.lab,conversions_8=conversions.lch,conversions_9=conversions.hex,conversions_10=conversions.keyword,conversions_11=conversions.ansi16,conversions_12=conversions.ansi256,conversions_13=conversions.hcg,conversions_14=conversions.apple,conversions_15=conversions.gray;function buildGraph(){for(var e={},t=Object.keys(conversions),s=t.length,i=0;i<s;i++)e[t[i]]={distance:-1,parent:null};return e}function deriveBFS(e){var t=buildGraph(),s=[e];for(t[e].distance=0;s.length;)for(var i=s.pop(),r=Object.keys(conversions[i]),n=r.length,a=0;a<n;a++){var o=r[a],l=t[o];-1===l.distance&&(l.distance=t[i].distance+1,l.parent=i,s.unshift(o))}return t}function link(e,t){return function(s){return t(e(s))}}function wrapConversion(e,t){for(var s=[t[e].parent,e],i=conversions[t[e].parent][e],r=t[e].parent;t[r].parent;)s.unshift(t[r].parent),i=link(conversions[t[r].parent][r],i),r=t[r].parent;return i.conversion=s,i}var route=function(e){for(var t=deriveBFS(e),s={},i=Object.keys(t),r=i.length,n=0;n<r;n++){var a=i[n];null!==t[a].parent&&(s[a]=wrapConversion(a,t))}return s},convert={},models=Object.keys(conversions);function wrapRaw(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}function wrapRounded(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var s=e(t);if("object"==typeof s)for(var i=s.length,r=0;r<i;r++)s[r]=Math.round(s[r]);return s};return"conversion"in e&&(t.conversion=e.conversion),t}models.forEach(function(e){convert[e]={},Object.defineProperty(convert[e],"channels",{value:conversions[e].channels}),Object.defineProperty(convert[e],"labels",{value:conversions[e].labels});var t=route(e);Object.keys(t).forEach(function(s){var i=t[s];convert[e][s]=wrapRounded(i),convert[e][s].raw=wrapRaw(i)})});var colorConvert=convert,ansiStyles=createCommonjsModule(function(e){const t=(e,t)=>(function(){const s=e.apply(colorConvert,arguments);return`[${s+t}m`}),s=(e,t)=>(function(){const s=e.apply(colorConvert,arguments);return`[${38+t};5;${s}m`}),i=(e,t)=>(function(){const s=e.apply(colorConvert,arguments);return`[${38+t};2;${s[0]};${s[1]};${s[2]}m`});Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,r={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};r.color.grey=r.color.gray;for(const t of Object.keys(r)){const s=r[t];for(const t of Object.keys(s)){const i=s[t];r[t]={open:`[${i[0]}m`,close:`[${i[1]}m`},s[t]=r[t],e.set(i[0],i[1])}Object.defineProperty(r,t,{value:s,enumerable:!1}),Object.defineProperty(r,"codes",{value:e,enumerable:!1})}const n=e=>e,a=(e,t,s)=>[e,t,s];r.color.close="[39m",r.bgColor.close="[49m",r.color.ansi={ansi:t(n,0)},r.color.ansi256={ansi256:s(n,0)},r.color.ansi16m={rgb:i(a,0)},r.bgColor.ansi={ansi:t(n,10)},r.bgColor.ansi256={ansi256:s(n,10)},r.bgColor.ansi16m={rgb:i(a,10)};for(let e of Object.keys(colorConvert)){if("object"!=typeof colorConvert[e])continue;const n=colorConvert[e];"ansi16"===e&&(e="ansi"),"ansi16"in n&&(r.color.ansi[e]=t(n.ansi16,0),r.bgColor.ansi[e]=t(n.ansi16,10)),"ansi256"in n&&(r.color.ansi256[e]=s(n.ansi256,0),r.bgColor.ansi256[e]=s(n.ansi256,10)),"rgb"in n&&(r.color.ansi16m[e]=i(n.rgb,0),r.bgColor.ansi16m[e]=i(n.rgb,10))}return r}})}),hasFlag=(e,t)=>{t=t||process.argv;const s=e.startsWith("-")?"":1===e.length?"-":"--",i=t.indexOf(s+e),r=t.indexOf("--");return-1!==i&&(-1===r||i<r)};const env=process.env;let forceColor;function translateLevel(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function supportsColor(e){if(!1===forceColor)return 0;if(hasFlag("color=16m")||hasFlag("color=full")||hasFlag("color=truecolor"))return 3;if(hasFlag("color=256"))return 2;if(e&&!e.isTTY&&!0!==forceColor)return 0;const t=forceColor?1:0;if("win32"===process.platform){const e=os.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in env)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(e=>e in env)||"codeship"===env.CI_NAME?1:t;if("TEAMCITY_VERSION"in env)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(env.TEAMCITY_VERSION)?1:0;if("truecolor"===env.COLORTERM)return 3;if("TERM_PROGRAM"in env){const e=parseInt((env.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(env.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(env.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)?1:"COLORTERM"in env?1:(env.TERM,t)}function getSupportLevel(e){return translateLevel(supportsColor(e))}hasFlag("no-color")||hasFlag("no-colors")||hasFlag("color=false")?forceColor=!1:(hasFlag("color")||hasFlag("colors")||hasFlag("color=true")||hasFlag("color=always"))&&(forceColor=!0),"FORCE_COLOR"in env&&(forceColor=0===env.FORCE_COLOR.length||0!==parseInt(env.FORCE_COLOR,10));var supportsColor_1={supportsColor:getSupportLevel,stdout:getSupportLevel(process.stdout),stderr:getSupportLevel(process.stderr)};const TEMPLATE_REGEX=/(?:\\(u[a-f\d]{4}|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,STYLE_REGEX=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,STRING_REGEX=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,ESCAPE_REGEX=/\\(u[a-f\d]{4}|x[a-f\d]{2}|.)|([^\\])/gi,ESCAPES=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a",""]]);function unescape(e){return"u"===e[0]&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):ESCAPES.get(e)||e}function parseArguments(e,t){const s=[],i=t.trim().split(/\s*,\s*/g);let r;for(const t of i)if(isNaN(t)){if(!(r=t.match(STRING_REGEX)))throw new Error(`Invalid Chalk template style argument: ${t} (in style '${e}')`);s.push(r[2].replace(ESCAPE_REGEX,(e,t,s)=>t?unescape(t):s))}else s.push(Number(t));return s}function parseStyle(e){STYLE_REGEX.lastIndex=0;const t=[];let s;for(;null!==(s=STYLE_REGEX.exec(e));){const e=s[1];if(s[2]){const i=parseArguments(e,s[2]);t.push([e].concat(i))}else t.push([e])}return t}function buildStyle(e,t){const s={};for(const e of t)for(const t of e.styles)s[t[0]]=e.inverse?null:t.slice(1);let i=e;for(const e of Object.keys(s))if(Array.isArray(s[e])){if(!(e in i))throw new Error(`Unknown Chalk style: ${e}`);i=s[e].length>0?i[e].apply(i,s[e]):i[e]}return i}var templates=(e,t)=>{const s=[],i=[];let r=[];if(t.replace(TEMPLATE_REGEX,(t,n,a,o,l,u)=>{if(n)r.push(unescape(n));else if(o){const t=r.join("");r=[],i.push(0===s.length?t:buildStyle(e,s)(t)),s.push({inverse:a,styles:parseStyle(o)})}else if(l){if(0===s.length)throw new Error("Found extraneous } in Chalk template literal");i.push(buildStyle(e,s)(r.join(""))),r=[],s.pop()}else r.push(u)}),i.push(r.join("")),s.length>0){const e=`Chalk template literal is missing ${s.length} closing bracket${1===s.length?"":"s"} (\`}\`)`;throw new Error(e)}return i.join("")},chalk$1=createCommonjsModule(function(e){const t=supportsColor_1.stdout,s="win32"===process.platform&&!(process.env.TERM||"").toLowerCase().startsWith("xterm"),i=["ansi","ansi","ansi256","ansi16m"],r=new Set(["gray"]),n=Object.create(null);function a(e,s){s=s||{};const i=t?t.level:0;e.level=void 0===s.level?i:s.level,e.enabled="enabled"in s?s.enabled:e.level>0}function o(e){if(!this||!(this instanceof o)||this.template){const t={};return a(t,e),t.template=function(){const e=[].slice.call(arguments);return h.apply(null,[t.template].concat(e))},Object.setPrototypeOf(t,o.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=o,t.template}a(this,e)}s&&(ansiStyles.blue.open="[94m");for(const e of Object.keys(ansiStyles))ansiStyles[e].closeRe=new RegExp(escapeStringRegexp(ansiStyles[e].close),"g"),n[e]={get(){const t=ansiStyles[e];return u.call(this,this._styles?this._styles.concat(t):[t],this._empty,e)}};n.visible={get(){return u.call(this,this._styles||[],!0,"visible")}},ansiStyles.color.closeRe=new RegExp(escapeStringRegexp(ansiStyles.color.close),"g");for(const e of Object.keys(ansiStyles.color.ansi))r.has(e)||(n[e]={get(){const t=this.level;return function(){const s=ansiStyles.color[i[t]][e].apply(null,arguments),r={open:s,close:ansiStyles.color.close,closeRe:ansiStyles.color.closeRe};return u.call(this,this._styles?this._styles.concat(r):[r],this._empty,e)}}});ansiStyles.bgColor.closeRe=new RegExp(escapeStringRegexp(ansiStyles.bgColor.close),"g");for(const e of Object.keys(ansiStyles.bgColor.ansi)){if(r.has(e))continue;n["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const t=this.level;return function(){const s=ansiStyles.bgColor[i[t]][e].apply(null,arguments),r={open:s,close:ansiStyles.bgColor.close,closeRe:ansiStyles.bgColor.closeRe};return u.call(this,this._styles?this._styles.concat(r):[r],this._empty,e)}}}}const l=Object.defineProperties(()=>{},n);function u(e,t,s){const i=function(){return c.apply(i,arguments)};i._styles=e,i._empty=t;const r=this;return Object.defineProperty(i,"level",{enumerable:!0,get:()=>r.level,set(e){r.level=e}}),Object.defineProperty(i,"enabled",{enumerable:!0,get:()=>r.enabled,set(e){r.enabled=e}}),i.hasGrey=this.hasGrey||"gray"===s||"grey"===s,i.__proto__=l,i}function c(){const e=arguments,t=e.length;let i=String(arguments[0]);if(0===t)return"";if(t>1)for(let s=1;s<t;s++)i+=" "+e[s];if(!this.enabled||this.level<=0||!i)return this._empty?"":i;const r=ansiStyles.dim.open;s&&this.hasGrey&&(ansiStyles.dim.open="");for(const e of this._styles.slice().reverse())i=(i=e.open+i.replace(e.closeRe,e.open)+e.close).replace(/\r?\n/g,`${e.close}$&${e.open}`);return ansiStyles.dim.open=r,i}function h(e,t){if(!Array.isArray(t))return[].slice.call(arguments,1).join(" ");const s=[].slice.call(arguments,2),i=[t.raw[0]];for(let e=1;e<t.length;e++)i.push(String(s[e-1]).replace(/[{}\\]/g,"\\$&")),i.push(String(t.raw[e]));return templates(e,i.join(""))}Object.defineProperties(o.prototype,n),e.exports=o(),e.exports.supportsColor=t,e.exports.default=e.exports}),chalk_1=chalk$1.supportsColor,figlet_1=createCommonjsModule(function(e){var t=t||function(){var e=0,t=1,s=2,i=3,r={},n={font:"Standard",fontPath:"./fonts"};function a(e,t,s){return e===t&&e!==s&&e}function o(e,t){if("_"===e){if(-1!=="|/\\[]{}()<>".indexOf(t))return t}else if("_"===t&&-1!=="|/\\[]{}()<>".indexOf(e))return e;return!1}function l(e,t){var s="| /\\ [] {} () <>".indexOf(e),i="| /\\ [] {} () <>".indexOf(t);return-1!==s&&-1!==i&&s!==i&&1!==Math.abs(s-i)&&"| /\\ [] {} () <>".substr(Math.max(s,i),1)}function u(e,t){var s="[] {} ()".indexOf(e),i="[] {} ()".indexOf(t);return-1!==s&&-1!==i&&Math.abs(s-i)<=1&&"|"}function c(e,t){var s="/\\ \\/ ><".indexOf(e),i="/\\ \\/ ><".indexOf(t);return-1!==s&&-1!==i&&i-s==1&&{0:"|",3:"Y",6:"X"}[s]}function h(e,t,s){return e===s&&t===s&&s}function p(e,t){return e===t&&e}function d(e,t){if("_"===e){if(-1!=="|/\\[]{}()<>".indexOf(t))return t}else if("_"===t&&-1!=="|/\\[]{}()<>".indexOf(e))return e;return!1}function f(e,t){var s="| /\\ [] {} () <>".indexOf(e),i="| /\\ [] {} () <>".indexOf(t);return-1!==s&&-1!==i&&s!==i&&1!==Math.abs(s-i)&&"| /\\ [] {} () <>".substr(Math.max(s,i),1)}function g(e,t){return("-"===e&&"_"===t||"_"===e&&"-"===t)&&"="}function m(e,t){return"|"===e&&"|"===t&&"|"}function y(e,t,s){return" "===t||""===t?e:t===s&&" "!==e?e:t}function b(i,r,n){if(n.fittingRules.vLayout===e)return"invalid";var a,o,l,u,c=Math.min(i.length,r.length),h=!1;if(0===c)return"invalid";for(a=0;a<c;a++)if(o=i.substr(a,1),l=r.substr(a,1)," "!==o&&" "!==l){if(n.fittingRules.vLayout===t)return"invalid";if(n.fittingRules.vLayout===s)return"end";if(m(o,l)){h=h||!1;continue}if(u=!1,h=!0,!(u=!(u=!(u=!(u=n.fittingRules.vRule1?p(o,l):u)&&n.fittingRules.vRule2?d(o,l):u)&&n.fittingRules.vRule3?f(o,l):u)&&n.fittingRules.vRule4?g(o,l):u))return"invalid"}return h?"end":"valid"}function w(e,i,r){var n,a,o,l,u=Math.min(e.length,i.length),c="";for(n=0;n<u;n++)a=e.substr(n,1),o=i.substr(n,1)," "!==a&&" "!==o?r.fittingRules.vLayout===t?c+=y(a,o):r.fittingRules.vLayout===s?c+=y(a,o):c+=l=!(l=!(l=!(l=!(l=r.fittingRules.vRule5?m(a,o):l)&&r.fittingRules.vRule1?p(a,o):l)&&r.fittingRules.vRule2?d(a,o):l)&&r.fittingRules.vRule3?f(a,o):l)&&r.fittingRules.vRule4?g(a,o):l:c+=y(a,o);return c}function v(e,t){var s,i=e.length,r="";for(s=0;s<t;s++)r+=" ";for(s=0;s<i;s++)e[s]+=r}function E(e,t,s){var i=e[0].length,r=t[0].length;return i>r?v(t,i-r):r>i&&v(e,r-i),function(e,t,s,i){var r,n,a,o,l=e.length,u=t.length,c=e.slice(0,Math.max(0,l-s)),h=e.slice(Math.max(0,l-s),l),p=t.slice(0,Math.min(s,u)),d=[];for(n=h.length,r=0;r<n;r++)a=r>=u?h[r]:w(h[r],p[r],i),d.push(a);return o=t.slice(Math.min(s,u),u),[].concat(c,d,o)}(e,t,function(e,t,s){for(var i,r,n,a,o,l,u=e.length,c=e.length,h=(t.length,1);h<=u;){for(i=e.slice(Math.max(0,c-h),c),n=(r=t.slice(0,Math.min(u,h))).length,l="",a=0;a<n;a++)if("end"===(o=b(i[a],r[a],s)))l=o;else{if("invalid"===o){l=o;break}""===l&&(l="valid")}if("invalid"===l){h--;break}if("end"===l)break;"valid"===l&&h++}return Math.min(u,h)}(e,t,s),s)}function S(i,r,n){if(n.fittingRules.hLayout===e)return 0;var p,d,f,g,m,y=i.length,b=r.length,w=y,v=1,E=!1,S=!1;if(0===y)return 0;e:for(;v<=w;){for(d=i.substr(y-v,v),f=r.substr(0,Math.min(v,b)),p=0;p<Math.min(v,b);p++)if(g=d.substr(p,1),m=f.substr(p,1)," "!==g&&" "!==m){if(n.fittingRules.hLayout===t){v-=1;break e}if(n.fittingRules.hLayout===s){g!==n.hardBlank&&m!==n.hardBlank||(v-=1);break e}if(E=!0,S=!1,!(S=!(S=!(S=!(S=!(S=!(S=n.fittingRules.hRule1?a(g,m,n.hardBlank):S)&&n.fittingRules.hRule2?o(g,m,n.hardBlank):S)&&n.fittingRules.hRule3?l(g,m,n.hardBlank):S)&&n.fittingRules.hRule4?u(g,m,n.hardBlank):S)&&n.fittingRules.hRule5?c(g,m,n.hardBlank):S)&&n.fittingRules.hRule6?h(g,m,n.hardBlank):S)){v-=1;break e}}if(E)break;v++}return Math.min(w,v)}function R(e,i,r,n){var p,d,f,g,m,b,w,v,E,S,R=[];for(p=0;p<n.height;p++){E=e[p],S=i[p],w=E.length,v=S.length,f=w-r,g=E.substr(0,Math.max(0,f)),m="";var I=E.substr(Math.max(0,w-r),r),D=S.substr(0,Math.min(r,v));for(d=0;d<r;d++){var $=d<w?I.substr(d,1):" ",T=d<v?D.substr(d,1):" ";if(" "!==$&&" "!==T)if(n.fittingRules.hLayout===t)m+=y($,T,n.hardBlank);else if(n.fittingRules.hLayout===s)m+=y($,T,n.hardBlank);else{var _="";m+=_=(_=!(_=!(_=!(_=!(_=!(_=!_&&n.fittingRules.hRule1?a($,T,n.hardBlank):_)&&n.fittingRules.hRule2?o($,T,n.hardBlank):_)&&n.fittingRules.hRule3?l($,T,n.hardBlank):_)&&n.fittingRules.hRule4?u($,T,n.hardBlank):_)&&n.fittingRules.hRule5?c($,T,n.hardBlank):_)&&n.fittingRules.hRule6?h($,T,n.hardBlank):_)||y($,T,n.hardBlank)}else m+=y($,T,n.hardBlank)}b=r>=v?"":S.substr(r,Math.max(0,v-r)),R[p]=g+m+b}return R}function I(t,s,i){var r,n,a,o=0,l=[],u=i.height;for(a=0;a<u;a++)l[a]="";for(1===i.printDirection&&(t=t.split("").reverse().join("")),u=t.length,r=0;r<u;r++)if(n=s[t.substr(r,1).charCodeAt(0)]){if(i.fittingRules.hLayout!==e){for(o=1e4,a=0;a<i.height;a++)o=Math.min(o,S(l[a],n[a],i));o=1e4===o?0:o}l=R(l,n,o,i)}if(!0!==i.showHardBlanks)for(u=l.length,a=0;a<u;a++)l[a]=l[a].replace(new RegExp("\\"+i.hardBlank,"g")," ");return l}var D=function(r,n){var a,o=["hLayout","hRule1","hRule2","hRule3","hRule4","hRule5","hRule6"],l={};if("default"===r)for(a=0;a<o.length;a++)l[o[a]]=n.fittingRules[o[a]];else if("full"===r)l={hLayout:e,hRule1:!1,hRule2:!1,hRule3:!1,hRule4:!1,hRule5:!1,hRule6:!1};else if("fitted"===r)l={hLayout:t,hRule1:!1,hRule2:!1,hRule3:!1,hRule4:!1,hRule5:!1,hRule6:!1};else if("controlled smushing"===r)l={hLayout:i,hRule1:!0,hRule2:!0,hRule3:!0,hRule4:!0,hRule5:!0,hRule6:!0};else{if("universal smushing"!==r)return;l={hLayout:s,hRule1:!1,hRule2:!1,hRule3:!1,hRule4:!1,hRule5:!1,hRule6:!1}}return l},$=function(r,n){var a,o=["vLayout","vRule1","vRule2","vRule3","vRule4","vRule5"],l={};if("default"===r)for(a=0;a<o.length;a++)l[o[a]]=n.fittingRules[o[a]];else if("full"===r)l={vLayout:e,vRule1:!1,vRule2:!1,vRule3:!1,vRule4:!1,vRule5:!1};else if("fitted"===r)l={vLayout:t,vRule1:!1,vRule2:!1,vRule3:!1,vRule4:!1,vRule5:!1};else if("controlled smushing"===r)l={vLayout:i,vRule1:!0,vRule2:!0,vRule3:!0,vRule4:!0,vRule5:!0};else{if("universal smushing"!==r)return;l={vLayout:s,vRule1:!1,vRule2:!1,vRule3:!1,vRule4:!1,vRule5:!1}}return l},T=function(e,t,s){var i,n,a,o=(s=s.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).split("\n"),l=[];for(n=o.length,i=0;i<n;i++)l.push(I(o[i],r[e],t));for(n=l.length,a=l[0],i=1;i<n;i++)a=E(a,l[i],t);return a.join("\n")},_=function(e,t,s){_.text(e,t,s)};function O(e,t){var s,i,r=JSON.parse(JSON.stringify(e));if(void 0!==t.horizontalLayout)for(i in s=D(t.horizontalLayout,e))r.fittingRules[i]=s[i];if(void 0!==t.verticalLayout)for(i in s=$(t.verticalLayout,e))r.fittingRules[i]=s[i];return r.printDirection=void 0!==t.printDirection?t.printDirection:e.printDirection,r.showHardBlanks=t.showHardBlanks||!1,r}return _.text=function(e,t,s){var i="";e+="","function"==typeof arguments[1]&&(s=t,(t={}).font=n.font),"string"==typeof t?(i=t,t={}):i=(t=t||{}).font||n.font,_.loadFont(i,function(r,n){if(r)return s(r);s(null,T(i,O(n,t),e))})},_.textSync=function(e,t){var s="";e+="","string"==typeof t?(s=t,t={}):s=(t=t||{}).font||n.font;var i=O(_.loadFontSync(s),t);return T(s,i,e)},_.metadata=function(e,t){e+="",_.loadFont(e,function(s,i){s?t(s):t(null,i,r[e].comment)})},_.defaults=function(e){if("object"==typeof e&&null!==e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return JSON.parse(JSON.stringify(n))},_.parseFont=function(n,a){a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),r[n]={};var o=a.split("\n"),l=o.splice(0,1)[0].split(" "),u=r[n],c={};if(c.hardBlank=l[0].substr(5,1),c.height=parseInt(l[1],10),c.baseline=parseInt(l[2],10),c.maxLength=parseInt(l[3],10),c.oldLayout=parseInt(l[4],10),c.numCommentLines=parseInt(l[5],10),c.printDirection=l.length>=6?parseInt(l[6],10):0,c.fullLayout=l.length>=7?parseInt(l[7],10):null,c.codeTagCount=l.length>=8?parseInt(l[8],10):null,c.fittingRules=function(r,n){var a,o,l,u,c={},h=[[16384,"vLayout",s],[8192,"vLayout",t],[4096,"vRule5",!0],[2048,"vRule4",!0],[1024,"vRule3",!0],[512,"vRule2",!0],[256,"vRule1",!0],[128,"hLayout",s],[64,"hLayout",t],[32,"hRule6",!0],[16,"hRule5",!0],[8,"hRule4",!0],[4,"hRule3",!0],[2,"hRule2",!0],[1,"hRule1",!0]];for(a=null!==n?n:r,o=0,l=h.length;o<l;)a>=(u=h[o])[0]?(a-=u[0],c[u[1]]=void 0===c[u[1]]?u[2]:c[u[1]]):"vLayout"!==u[1]&&"hLayout"!==u[1]&&(c[u[1]]=!1),o++;return void 0===c.hLayout?0===r?c.hLayout=t:-1===r?c.hLayout=e:c.hRule1||c.hRule2||c.hRule3||c.hRule4||c.hRule5||c.hRule6?c.hLayout=i:c.hLayout=s:c.hLayout===s&&(c.hRule1||c.hRule2||c.hRule3||c.hRule4||c.hRule5||c.hRule6)&&(c.hLayout=i),void 0===c.vLayout?c.vRule1||c.vRule2||c.vRule3||c.vRule4||c.vRule5?c.vLayout=i:c.vLayout=e:c.vLayout===s&&(c.vRule1||c.vRule2||c.vRule3||c.vRule4||c.vRule5)&&(c.vLayout=i),c}(c.oldLayout,c.fullLayout),u.options=c,1!==c.hardBlank.length||isNaN(c.height)||isNaN(c.baseline)||isNaN(c.maxLength)||isNaN(c.oldLayout)||isNaN(c.numCommentLines))throw new Error("FIGlet header contains invalid values.");var h,p=[];for(h=32;h<=126;h++)p.push(h);if(p=p.concat(196,214,220,228,246,252,223),o.length<c.numCommentLines+c.height*p.length)throw new Error("FIGlet file is missing data.");var d,f,g=!1;for(u.comment=o.splice(0,c.numCommentLines).join("\n"),u.numChars=0;o.length>0&&u.numChars<p.length;){for(u[d=p[u.numChars]]=o.splice(0,c.height),h=0;h<c.height;h++)void 0===u[d][h]?u[d][h]="":(f=new RegExp("\\"+u[d][h].substr(u[d][h].length-1,1)+"+$"),u[d][h]=u[d][h].replace(f,""));u.numChars++}for(;o.length>0;){if(d=o.splice(0,1)[0].split(" ")[0],/^0[xX][0-9a-fA-F]+$/.test(d))d=parseInt(d,16);else if(/^0[0-7]+$/.test(d))d=parseInt(d,8);else if(/^[0-9]+$/.test(d))d=parseInt(d,10);else{if(!/^-0[xX][0-9a-fA-F]+$/.test(d)){if(""===d)break;console.log("Invalid data:"+d),g=!0;break}d=parseInt(d,16)}for(u[d]=o.splice(0,c.height),h=0;h<c.height;h++)void 0===u[d][h]?u[d][h]="":(f=new RegExp("\\"+u[d][h].substr(u[d][h].length-1,1)+"+$"),u[d][h]=u[d][h].replace(f,""));u.numChars++}if(!0===g)throw new Error("Error parsing data.");return c},_.loadFont=function(e,t){if(r[e])t(null,r[e].options);else{if("function"!=typeof fetch)throw console.error("figlet.js requires the fetch API or a fetch polyfill such as https://cdnjs.com/libraries/fetch"),new Error("fetch is required for figlet.js to work.");fetch(n.fontPath+"/"+e+".flf").then(function(e){if(e.ok)return e.text();throw console.log("Unexpected response",e),new Error("Network response was not ok.")}).then(function(s){t(null,_.parseFont(e,s))}).catch(t)}},_.loadFontSync=function(e){if(r[e])return r[e].options;throw new Error("synchronous font loading is not implemented for the browser")},_.preloadFonts=function(e,t){if("undefined"==typeof jQuery)throw new Error("jQuery is required for ajax method to work.");jQuery.when.apply(this,e.map(function(e){return jQuery.get(n.fontPath+"/"+e+".flf")})).then(function(){var s=e.length>1?arguments:[arguments];for(var i in e)_.parseFont(e[i],s[i][0]);t&&t()})},_.figFonts=r,_}();e.exports=t}),fontDir=path$6.join(__dirname,"/../fonts/");figlet_1.loadFont=function(e,t){figlet_1.figFonts[e]?t(null,figlet_1.figFonts[e].options):fs$2.readFile(path$6.join(fontDir,e+".flf"),{encoding:"utf-8"},function(s,i){if(s)return t(s);i+="";try{t(null,figlet_1.parseFont(e,i))}catch(e){t(e)}})},figlet_1.loadFontSync=function(e){if(figlet_1.figFonts[e])return figlet_1.figFonts[e].options;var t=fs$2.readFileSync(path$6.join(fontDir,e+".flf"),{encoding:"utf-8"});return t+="",figlet_1.parseFont(e,t)},figlet_1.fonts=function(e){var t=[];fs$2.readdir(fontDir,function(s,i){if(s)return e(s);i.forEach(function(e){/\.flf$/.test(e)&&t.push(e.replace(/\.flf$/,""))}),e(null,t)})},figlet_1.fontsSync=function(){var e=[];return fs$2.readdirSync(fontDir).forEach(function(t){/\.flf$/.test(t)&&e.push(t.replace(/\.flf$/,""))}),e};var nodeFiglet=figlet_1;const DIVIDER_LENGTH=80,CHOICE_SEPARATOR={message:"\n=-=-= END "+"=-".repeat(35)+"\n",role:"separator"};function log(e){console.log(e)}function debug(e){console.log(chalk$1.gray(e))}function error(e){console.error(chalk$1.redBright(e))}function success(e){console.log(chalk$1.green(e))}function motivation(){say(getMotivation())}function formattedError(e,t=0){if(Array.isArray(e))for(const s of e)"=>"===s?t+=1:"<="===s?t-=1:formattedError(s,t);else error("  ".repeat(t))}const MAX_SKIPPED_ERRORS=100,SKIPPED_ERRORS=new Set,NO_SKIP_ERRORS=new Set,FORCE_SKIP_ERRORS=new Set;async function skippedError(e,t){const s=e+" - "+(t instanceof Error?t.message:t);error(s);const i=stringHash(s);if(FORCE_SKIP_ERRORS.has(i))debug("...Auto-skipping error...");else{if(!await ask("...Skip the error?",!0).catch(e=>!1))throw new Error("Failed error. Aborting...");if(SKIPPED_ERRORS.has(i))try{await ask("...Skip this error in the future?")?FORCE_SKIP_ERRORS.add(i):NO_SKIP_ERRORS.add(i)}catch(e){}else SKIPPED_ERRORS.size>MAX_SKIPPED_ERRORS&&SKIPPED_ERRORS.clear(),SKIPPED_ERRORS.add(i)}}function divider(e="nu"){log(chalk$1.gray(e.repeat(Math.floor(DIVIDER_LENGTH/e.length))+e.substring(0,DIVIDER_LENGTH%e.length)))}function doTheBigTitleThing(e="Progress Auditor",t="Version v?.?.?"){divider(),log(chalk$1.green(nodeFiglet.textSync(e,{font:"Big"}))),t&&log(t.padStart(DIVIDER_LENGTH," ")),divider()}async function askPrompt(e,t,s={}){const{answer:i}=await enquirer.prompt({type:t,message:e,name:"answer",...s});return i}async function ask(e,t=!1){const{answer:s}=await enquirer.prompt({type:"confirm",name:"answer",message:e,initial:Boolean(t)});return s}async function askChoose(e,t){const{answer:s}=await enquirer.prompt({type:"select",name:"answer",message:e,choices:t});return s}async function askPath(e,t,s=!0,i=!1,r){const n=require("fs"),a=require("path");return await askPrompt(e,"input",{result:e=>a.resolve(t,e),validate:e=>{const o=a.resolve(t,e);if(r&&r.call(null,o),!s)return!0;if(!n.existsSync(o))return"Path does not exist.";{const e=n.lstatSync(o);if(i&&!e.isDirectory())return"Path is not a directory.";if(!i&&!e.isFile())return"Path is not a file."}return!0}})}async function askFindFile(e,t=".",s){const i=require("fs"),r=require("path");t=r.resolve(t);let n=null;do{const a=i.readdirSync(t,{withFileTypes:!0}),o=[];o.push({message:"→ .",value:{directory:!0,name:"."}}),o.push({message:"→ ..",value:{directory:!0,name:".."}});for(const e of a)e.isDirectory()?o.push({message:`→ ${e.name}/`,value:{directory:!0,name:e.name}}):o.push({message:`  ${e.name}`,value:{directory:!1,name:e.name}});const l=new enquirer.AutoComplete({type:"autocomplete",name:"file",message:e,limit:10,choices:o,format:e=>"string"==typeof e?t+"/"+e:t+"/"+e.name,suggest:(e,t)=>{let s=e.toLowerCase();const i=t.filter(e=>e.message.toLowerCase().includes(s));return i.push({message:e}),i},validate:e=>"string"!=typeof e||(!!i.existsSync(r.resolve(t,e))||"File does not exist.")});let u,c=await l.run();if(!c)return null;if("string"==typeof c?(u=r.resolve(t,c),c={directory:i.lstatSync(u).isDirectory(),name:c}):u=r.resolve(t,c.name),c.directory)t=u;else{if(!s||s.call(null,u)){n=u;break}n=null}l.clear()}while(!n);return n}async function askDate(e,t){const s=await askPrompt(e,"input",{initial:t&&stringify(t,!1),hint:"YYYY-MM-DD-hh:mm:ss (You don't need the time)",validate:e=>{try{parse(e)}catch(e){return e.message}return!0}});return parse(s)}const fs=require("fs"),path=require("path"),readline=require("readline"),Papa=require("papaparse");function readJSONFile(e){const t=fs.readFileSync(e);return JSON.parse(t)}function readCSVFileByRow(e,t){return new Promise((s,i)=>{const r=fs.createReadStream(e);Papa.parse(r,{step:e=>t(e.data),complete:s,error:i})})}function readFileByLine(e,t){return new Promise((s,i)=>{const r=fs.createReadStream(e),n=readline.createInterface({input:r});r.on("error",e=>{console.error(e),i(e)}),n.on("line",t),n.on("close",()=>{s()})})}async function writeToFile(e,t){if(fs.mkdirSync(path.dirname(e),{recursive:!0}),!fs.existsSync(e)||await ask(`File '${path.basename(e)}' already exists. Are you sure you want to overwrite it?`))return new Promise((s,i)=>{fs.writeFile(e,t,t=>{t&&i(t),console.log("File saved:",e),s()})})}async function writeTableToCSV(e,t){await writeToFile(e,t.map(e=>e.join(",")).join("\n"))}var FileUtil=Object.freeze({readJSONFile:readJSONFile,readCSVFileByRow:readCSVFileByRow,readFileByLine:readFileByLine,writeToFile:writeToFile,writeTableToCSV:writeTableToCSV});function parseDate(e){const t=new Date(1e3),s=Number(e.substring(0,4)),i=Number(e.substring(5,7)),r=Number(e.substring(8,10)),n=Number(e.substring(11,13)),a=Number(e.substring(14,16)),o=Number(e.substring(17,19));if(NaN===s||NaN===i||NaN===r||NaN===n||NaN===a||NaN===o)throw new Error("Invalid date format - should be YYYY-MM-DD HH:MM:SS.");return t.setUTCFullYear(s),t.setUTCMonth(i-1),t.setUTCDate(r),t.setUTCHours(n),t.setUTCMinutes(a),t.setUTCSeconds(o),t}function parseAmericanDate$1(e){const t=new Date(-1),s=e.split("/"),i=Number(s[2]),r=Number(s[0]),n=Number(s[1]);if(NaN===i||NaN===r||NaN===n)throw new Error("Invalid date format - should be MM/DD/YYYY.");return t.setUTCFullYear(i),t.setUTCMonth(r-1),t.setUTCDate(n),t}var ParseUtil=Object.freeze({parseDate:parseDate,parseAmericanDate:parseAmericanDate$1});const IDENTITY=function(e){return e};class TableBuilder{constructor(){this.entries=[],this.columns=[]}addEntry(...e){this.entries.push(e)}addColumn(e,t=IDENTITY){this.columns.push({header:e,data:t})}build(){const e=[];for(const t of this.columns)e.push(t.header);const t=[];t.push(e);for(const e of this.entries){const s=[];for(const t of this.columns){const i=t.data.apply(null,e);s.push(i)}t.push(s)}return t}}const DEFAULT_VALIDATOR=e=>e;function createDateRange(e,t){return[copyDate(e),copyDate(t)]}function sortDateRanges(e){e.sort((e,t)=>e[0].getTime()-t[0].getTime())}function mergeDateRangesWithOverlap(e,t=!0){let s=null;for(let i=0;i<e.length;++i){let r=e[i];s?compareDates(s[1],r[0])>=(t?-1:0)&&(s[1].setTime(r[1].getTime()),e.splice(i,1),--i):s=r}}function createOffsetDelayValidator(e=[]){return function(t){let s=copyDate(t);for(const t of e){if(s.getTime()<t[0].getTime())break;if(isWithinDates(s,t[0],t[1])){const e=getDaysUntil(t[0],s)+1;s=offsetDate(t[1],e)}}return s}}function generateWeeklySunday(e,t,s=DEFAULT_VALIDATOR){const i=[];let r=s(offsetDate(getNearestSunday(e,!0),DAYS_IN_WEEK));for(;compareDates(r,t)<=0;)i.push(r),r=s(getNextSunday(r));return i}const MAX_GENERATED_ASSIGNMENTS=100;function assign(e,t,s,i,r={}){return addAssignment(e,t,s,offsetDateByVacations(e,getOwnerKeysForUserID(e,t),i),r)}function assignWeekly(e,t,s,i,r,n={}){const a=getVacationsByOwnerKeys(e,getOwnerKeysForUserID(e,t)),o=[];for(const t of a){const s=getVacationByID(e,t);o.push(createDateRange(s.userStartDate,s.userEndDate))}sortDateRanges(o),mergeDateRangesWithOverlap(o);const l=generateWeeklySunday(i,r,createOffsetDelayValidator(o)),u=[];let c=0;for(const i of l){const r=addAssignment(e,t,`${s}[${c+1}]`,i,Object.assign({},n));if(u.push(r),++c>MAX_GENERATED_ASSIGNMENTS)throw new Error("Reached maximum amount of assignments generated.")}return u}var AssignmentGenerator=Object.freeze({assign:assign,assignWeekly:assignWeekly});const DATABASE_EXPORTS={Assignment:Assignment,AssignmentDatabase:AssignmentDatabase$1,Database:Database,Review:Review,ReviewDatabase:ReviewDatabase,Schedule:Schedule,Submission:Submission,SubmissionDatabase:SubmissionDatabase,User:User,UserDatabase:UserDatabase$1,Vacation:Vacation,VacationDatabase:VacationDatabase},UTIL_EXPORTS={DateUtil:DateUtil,FieldParser:FieldParser,FileUtil:FileUtil,MathHelper:MathHelper,ParseUtil:ParseUtil,TableBuilder:TableBuilder},LIB_EXPORTS={AssignmentGenerator:AssignmentGenerator},ProgressAuditor={...DATABASE_EXPORTS,...UTIL_EXPORTS,...LIB_EXPORTS};global.ProgressAuditor=ProgressAuditor;const path$1=require("path"),fs$1=require("fs"),DEFAULT_CONFIG_FILE_NAME="config.json";async function loadConfig(e){let t,s;try{e=findValidConfigFilePath(e),s=path$1.dirname(e)}catch(t){return console.error(`...Cannot find config at '${e}'...`),Promise.reject(t)}try{const s=fs$1.readFileSync(e);t=JSON.parse(s)}catch(e){return Promise.reject(["Failed to parse config file:","=>",e,"<="])}if("include"in(t=resolveConfigPaths(s,t))){const e=[],s=[];for(const i of t.include)try{const t=await loadConfig(i);s.push(t)}catch(t){e.push(t)}if(e.length>0)return Promise.reject(["Failed to resolve config includes:","=>",e,"<="]);const i=s.reduce((e,t)=>mergeConfigs(t,e),{});t=mergeConfigs(t,i)}return t}function findValidConfigFilePath(e){if(!fs$1.existsSync(e))throw new Error(`Cannot find non-existant path '${e}'.`);if(fs$1.lstatSync(e).isDirectory()){const t=e;if(e=path$1.resolve(t,DEFAULT_CONFIG_FILE_NAME),!fs$1.existsSync(e))throw new Error(`Cannot find config file in directory '${t}'.`)}return e}function resolveConfigEntry(e,t,s){if(t.toLowerCase().endsWith("path"))return resolveConfigPathEntry(e,s);if(Array.isArray(s)){let t=[];for(const i in s)t.push(resolveConfigEntry(e,i,s[i]));return t}if("object"==typeof s){let t={};for(const[i,r]of Object.entries(s))t[i]=resolveConfigEntry(e,i,r);return t}return s}function resolveConfigPathEntry(e,t){if(Array.isArray(t)){let s=[];for(const i of t)s.push(resolveConfigPathEntry(e,i));return s}return"object"==typeof t?resolveConfigPaths(e,t):"string"==typeof t?t.startsWith("/")||t.startsWith("~/")?path$1.resolve(t):path$1.resolve(e,t):t}function resolveConfigPaths(e,t){const s=resolveConfigEntry(e,"",t);return"include"in t&&Array.isArray(t.include)&&(s.include=t.include.map(t=>resolveConfigPathEntry(e,t))),s}function mergeConfigs(e,t){for(const[s,i]of Object.entries(e))s in t?Array.isArray(t[s])&&(Array.isArray(i)?t[s]=t[s].concat(i):t[s].push(i)):t[s]=e[s];return t}function ifFailAndAgain(e,t=!0){return async s=>!s&&Boolean(await ask(e))===t}function createResolver(){return{_init:()=>!0,_run:()=>null,_error:null,_validate:e=>e,_again:()=>!1,async resolve(){try{let e=!1;if("string"==typeof this._init?e=await ask(this._init):"function"==typeof this._init&&(e=this._init.call(null)),e){let e=null,t=!1;do{t=!1;try{e=await this._run.call(null)}catch(t){e="function"==typeof this._error?this._error.call(null,t):this._error}"function"==typeof this._again?await this._again.call(null,e)&&(t=!0):"string"==typeof this._again&&await ask(this._again)&&(t=!0)}while(t);return e}return}catch(e){return"function"==typeof this._error?this._error.call(null,e):this._error}},init(e){return this._init=e,this},run(e){return this._run=e,this},error(e){return this._error=e,this},again(e){return this._again=e,this}}}const PARSER_OPTIONS={maxEndDates:{type:"Array<{ pattern, endDate }>",description:"An array of max end date entries that, if the specified pattern matched, will limit the user's end date to the specified date."}};async function parse$1(e,t,s,i={maxEndDates:[]}){setupDatabase$3(e);const r=processMaxEndDateEntries(i.maxEndDates);let n=!0;return await readCSVFileByRow(s,t=>{if(n)n=!1;else try{const s=parseEmail(t[6]),n=parseEmail(t[6],t[1]),a=parseName(`${t[3]} ${t[2]}`),o=t[5].trim().toUpperCase(),l=parseAmericanDate(t[11]),u=parseAmericanDate(t[12]),c=t[9];for(const e of r)e.pattern.test(c)&&compareDates(u,e.endDate)>0&&u.setTime(e.endDate.getTime());addUser(e,s,n,a,l,u,i,{pid:o})}catch(t){e.throwError("PARSE","Unable to parse users - "+t)}}),e}function processMaxEndDateEntries(e){if(!Array.isArray(e))return[];if(e.length<=0)return[];const t=[];for(const s of e)t.push({pattern:new RegExp(s.pattern),endDate:parse(s.endDate)});return t}var CohortParser=Object.freeze({PARSER_OPTIONS:PARSER_OPTIONS,parse:parse$1});function evaluatePostAssignment(e,t){if(/intro/i.test(e))return"intro";{const t=/week ?([0-9]+)/i.exec(e);if(t&&t.length>0)return"0"==t[1]?"intro":"week["+Number.parseInt(t[1])+"]"}return/last/i.test(e)||/final/i.test(e)?"last":"null"}async function parse$2(e,t,s,i={}){setupDatabase$2(e);let r=!0;return await readCSVFileByRow(s,t=>{if(r)r=!1;else try{const s=t[7];if("followup"===s||"reply_to_followup"===s||"started_off_i_answer"===s||"updated_i_answer"===s||"started_off_s_answer"===s||"updated_s_answer"===s)return;const i=parseEmail(t[9]),r=parseDate(t[3]),n=t[1],a=(Array.isArray(i)?i[0]:i)+"#"+n+"_"+stringHash(t[3]),o=evaluatePostAssignment(t[6],t[5]),l={content:{head:t[6],body:t[5],id:n}};addSubmission(e,a,i,o,r,l)}catch(t){e.throwError("PARSE","Unable to parse submissions - "+t)}}),e}var ContributionsParser=Object.freeze({parse:parse$2});async function parse$3(e,t,s,i={}){setupDatabase$1(e);let r=!0;return await readCSVFileByRow(s,t=>{if(r)r=!1;else try{const s=t[0];let i;try{i=parse(t[1])}catch(e){i=new Date(Date.now())}const r=t[2],n=t[3],a=[];for(let e=4;e<t.length;++e){const s=t[e].trim();if(s.length<=0)break;a.push(s)}addReview(e,s,i,r,n,a)}catch(t){e.throwError("PARSE","Unable to parse reviews - "+t)}}),e}var ReviewsParser=Object.freeze({parse:parse$3});function getParserTypes(){return["cohort","contributions","reviews"]}function loadParserByType(e){switch(e){case"cohort":return CohortParser;case"contributions":return ContributionsParser;case"reviews":return ReviewsParser;default:throw new Error(["Invalid input entry:","=>",`Cannot find valid parser of type '${e}'.`,"<="])}}function loadCustomParser(e){try{if("function"!=typeof require(e).parse)throw new Error(["Invalid custom parser file:","=>","Missing export for named function 'parse'.","<="])}catch(t){throw new Error(["Unable to import custom parser file:","=>",`File: '${e}'`,t,"<="])}}async function assign$1(e,t,s,i,r={}){assignWeekly(e,s,t,i.startDate,i.endDate)}var SundayAssignment=Object.freeze({assign:assign$1});async function assign$2(e,t,s,i,r={}){assign(e,s,t,new Date(i.lastSunday.getTime()))}var LastAssignment=Object.freeze({assign:assign$2});async function assign$3(e,t,s,i,r={}){assign(e,s,t,offsetDate(i.startDate,7))}var IntroAssignment=Object.freeze({assign:assign$3});function getAssignmentTypes(){return["sunday","intro","last"]}function loadAssignmentByType(e){switch(e){case"sunday":return SundayAssignment;case"intro":return IntroAssignment;case"last":return LastAssignment;default:throw new Error(["Invalid assignment entry:","=>",`Cannot find valid assignment of type '${e}'.`,"<="])}}function loadCustomAssignment(e){try{if("function"!=typeof require(e).assign)throw new Error(["Invalid custom assignment file:","=>","Missing export for named function 'assign'.","<="])}catch(t){throw new Error(["Unable to import custom assignment file:","=>",`File: '${e}'`,t,"<="])}}function getOutputTypes(){return["instructor","student","debug"]}async function resolveInputs(e){const t=[];return await createResolver().init("Want to add inputs?").run(async()=>{const s=await askFindFile("Choose an input file:",e,t=>!!t.startsWith(e)||"Must be under specified input path directory."),i=await askChoose("Which parser should we use?",[...getParserTypes(),"(custom)"]),r={};if("(custom)"===i){const t=await askFindFile("Where is the custom script file?",e,t=>t.endsWith(".js")?!!t.startsWith(e)||"Must be under specified input path directory.":"Must be a valid JavaScript file.");r.customPath=t}const n={inputName:s.substring(e.length+1),parser:i,opts:r};return t.push(n),n}).again(async e=>e?await ask("Do you want to add another input?"):await ask("Do you want to try again?")).resolve(),t}async function resolveOutputs(e){return(await askPrompt("Which outputs do you want to generate?","select",{multiple:!0,choices:getOutputTypes()})).map(e=>({outputName:e,format:e,opts:{}}))}async function resolveAssignments(e){const t=[];return await ask("Want to use the default assignments? (intro, week, last)")?t.push({assignmentName:"intro",pattern:"intro",opts:{}},{assignmentName:"week",pattern:"sunday",opts:{}},{assignmentName:"last",pattern:"last",opts:{}}):await createResolver().init("Want to add assignments?").run(async()=>{log('What are the names of the assignments? These are used to uniquely identify each assignment "class".');const e=await askPrompt("Assignments (comma-separated)","list"),s=[];for(const t of e){const e=await askChoose(`What is the assignment schedule pattern for '${t}'?`,[...getAssignmentTypes(),"(custom)"]);let i={};if("(custom)"===e){const e=await askFindFile("Where is the custom script file?",absInputPath,e=>e.endsWith(".js")?!!e.startsWith(absInputPath)||"Must be under specified input path directory.":"Must be a valid JavaScript file.");i.customPath=e}s.push({assignmentName:t,pattern:e,opts:i})}return t.push(...s),s}).again(ifFailAndAgain("Do you want to try again?")).resolve(),t}async function resolveInputPath(e){const t=require("path"),s=await askPath("Specify a new input path",e,!0,!0);return t.resolve(e,s)}async function resolveDate(){return await askDate("What is the date for the current run?",new Date(Date.now()))}async function loadConfigFile(e){return console.log("...Load config..."),await loadConfig(e)}async function requestConfigFile(e){return console.log("...Request config..."),null}async function loadDefaultConfig(e){return console.log("...Load default config..."),{scheme:"piazza",outputAutoDate:!0,debug:!1,assignments:[{assignmentName:"intro",pattern:"intro",opts:{}},{assignmentName:"week",pattern:"sunday",opts:{}},{assignmentName:"last",pattern:"last",opts:{}}]}}async function createNewConfig(e){return null}async function validateConfig(e,t){const s=require("fs"),i=require("path"),r=require("chalk");if(e.inputPath&&s.existsSync(e.inputPath)||(log(r.yellow("Missing valid input path...")),e.inputPath=await resolveInputPath(t)),e.outputPath&&s.existsSync(e.outputPath)||(debug("Missing valid output path...using working directory instead."),e.outputPath=t),!e.assignments){log(r.yellow("Missing assignment entries..."));i.resolve(t,e.inputPath);e.assignments=await resolveAssignments()}if(!e.inputs){log(r.yellow("Missing input entries..."));const s=i.resolve(t,e.inputPath);e.inputs=await resolveInputs(s)}if(!e.outputs){log(r.yellow("Missing output entries..."));i.resolve(t,e.outputPath);e.outputs=await resolveOutputs()}if(!e.currentDate){log(r.yellow("Missing current date..."));const t=await resolveDate();e.currentDate=stringify(t)}}const chalk$2=require("chalk");async function askWhetherDatabaseIsValidToUse(e,t){return log(""),log("== Current Status =="),log(` - Current Date: ${t.currentDate}`),log(` - Input Path: ${t.inputPath}`),log(` - Output Path: ${t.outputPath}`),log(` - Scheme: ${t.scheme}`),log(` - User(s): ${getUserCount(e)}`),log(` - Submission(s): ${getSubmissionCount(e)}`),log(` - Review(s): ${getReviewCount(e)}`),log(""),await ask("Is this correct?")}async function askWhetherToIgnoreErrors(e,t,s){return await ask(`Do you want to continue despite ${s.length} error(s)?`)}async function askWhetherToSaveNewReviews(e,t,s){return await ask(`Do you want to save the new ${s.length} review(s)?`)}async function askWhetherToReviewErrors(e,t,s){formattedError(`Found ${s.length} errors. :(`),motivation();const i=await ask("Do you want to review them now?",!0);return i||log(`Skipping errors...${Math.random()>.6?chalk$2.gray("(I trust you)..."):""}`),i}async function askWhetherToSaveDebugInfo(){return await ask("Do you want to save debug info? It will contain user information.")}async function showSkippingDebugLog(){log("...Skipping debug logs...")}async function celebrateNoErrors(){success("== No errors! Hooray! ==")}const PARSERS=new Set;function registerParser(e,t,s,i){PARSERS.add([e,t,s,i])}function getParsers(){return PARSERS.values()}async function findInputEntries(e){if(console.log("...Finding input entries..."),Array.isArray(e.inputs)){const t=e.inputs,s=[];for(const i of t)try{validateInputEntry(e,i)}catch(e){s.push(e)}if(s.length>0)throw new Error(["Failed to resolve input entries from config:","=>",s,"<="]);return t}return[]}async function loadInputEntry(e,t,s){console.log(`...Process input entry '${s.inputName}'...`);const i=t.inputPath||".",r=s.inputName,n=path$6.resolve(i,r),a=s.parser,o=s.customPath,l=s.opts||{};let u;try{u=o?loadCustomParser(o):loadParserByType(a)}catch(e){throw new Error(["Failed to resolve input entry from config:","=>",e,"<="])}registerParser(u,n,o||a,l)}function validateInputEntry(e,t){const s=[],i=e.inputPath||".",r=t.inputName,n=path$6.resolve(i,r),a=t.parser,o=t.customPath;if(r||s.push(["Invalid input entry:","=>","Missing required property 'inputName'.","<="]),fs$2.existsSync(n),a||o||s.push(["Invalid input entry:","=>","Missing one of property 'parser' or 'customPath'.","<="]),o&&!fs$2.existsSync(o)&&s.push([`Cannot find custom parser file '${path$6.basename(o)}':`,"=>",`File does not exist: '${o}'.`,"<="]),s.length>0)throw new Error(["Failed to validate input entry:","=>",s,"<="])}async function loadInputsFromConfig(e,t){const s=await findInputEntries(t);for(const i of s)try{await loadInputEntry(e,t,i)}catch(e){await skippedError(`Failed to load input entry '${i.inputName}'`,e)}}async function applyParsersToDatabase(e,t){for(const s of getParsers()){const[i,r,n,a]=s;fs$2.existsSync(r)?(console.log(`...Parsing '${path$6.basename(r)}' with '${path$6.basename(n)}'...`),await i.parse(e,t,r,a)):await skippedError(`Failed to find file '${path$6.basename(r)}' for parser`,new Error("File does not exist."))}}const ASSIGNERS=new Map;function registerAssigner(e,t,s,i){ASSIGNERS.set(e,[t,s,e,i])}function getAssigners(){return ASSIGNERS.values()}async function findAssignmentEntries(e){if(console.log("...Finding assignment entries..."),Array.isArray(e.assignments)){const t=e.assignments,s=[];for(const i of t)try{validateAssignmentEntry(e,i)}catch(e){s.push(e)}if(s.length>0)throw new Error(["Failed to resolve assignment entries from config:","=>",s,"<="]);return t}return[]}async function loadAssignmentEntry(e,t,s){console.log(`...Process assignment entry '${s.assignmentName}'...`);const i=s.assignmentName,r=s.pattern,n=s.customPath,a=s.opts||{};let o;try{o=n?loadCustomAssignment(n):loadAssignmentByType(r)}catch(e){throw new Error(["Failed to resolve assignment entry from config:","=>",e,"<="])}registerAssigner(i,o,n||r,a)}function validateAssignmentEntry(e,t){const s=[],i=t.assignmentName,r=t.pattern,n=t.customPath;if(i||s.push(["Invalid assignment entry:","=>","Missing required property 'assignmentName'.","<="]),r||n||s.push(["Invalid assignment entry:","=>","Missing one of property 'pattern' or 'customPath'.","<="]),n&&!fs$2.existsSync(n)&&s.push([`Cannot find custom assignment file '${path$6.basename(n)}':`,"=>",`File does not exist: '${n}'.`,"<="]),s.length>0)throw new Error(["Failed to validate assignment entry:","=>",s,"<="])}async function loadAssignmentsFromConfig(e,t){const s=await findAssignmentEntries(t);for(const i of s)try{await loadAssignmentEntry(e,t,i)}catch(e){console.error("Failed to load assignment entry.",e)}}async function applyAssignersToDatabase(e,t){for(const t of getAssigners()){const[s,i,r,n]=t;console.log(`...Assigning '${r}' as '${i}'...`);for(const t of getUsers(e)){const i=getUserByID(e,t).schedule;await s.assign(e,r,t,i,n)}}}async function setupDatabase$5(e){const t=createDatabase();let s;return s="currentDate"in e?parse(e.currentDate):new Date(Date.now()),t.currentDate=s,setupDatabase$3(t),setupDatabase$2(t),setupDatabase(t),setupDatabase$1(t),setupDatabase$4(t),t}async function clearDatabase$5(e,t){return clearDatabase$3(e),clearDatabase$2(e),clearDatabase(e),clearDatabase$1(e),clearDatabase$4(e),e.clearErrors(),e}function createReviewer(){return{_type:null,_paramLength:-1,_callback:null,_async:!1,async review(e,t){const s=[],i=[];if(forEach(e,(e,t)=>{if(this._type&&e.type===this._type)if(e.params.length<this._paramLength)s.push(`Missing required params - expected at least ${this._paramLength} but was ${e.params.length} for '${e.type}': ${t}.`);else if(this._async)i.push(this._callback.call(null,e,t).catch(e=>s.push(`Failed to review - ${e.message}`)));else try{i.push(Promise.resolve(this._callback.call(null,e,t)))}catch(e){s.push(`Failed to review - ${e.message}`)}}),await Promise.all(i),s.length>0)throw s},type(e){return this._type=e,this},paramLength(e){return this._paramLength=e,this},forEach(e){return this._callback=e,this._async=!1,this},forEachAsync(e){return this._callback=e,this._async=!0,this}}}function createBuilder(){return{_type:null,_params:[],_paramLength:0,type(e){return this._type=e,this},param(e,t,s,i=""){for(;e>=this._params.length;)this._params.push(void 0);if(void 0!==this._params[e])throw new Error(`Parameter with index ${e} already added for builder.`);return this._params[e]={type:t,description:s,defaultValue:i},this},async build(e=uuid(),t=new Date(Date.now())){const s=await askPrompt(this._type,"form",{choices:this._params.map((e,t)=>({name:e.type,message:e.type,value:e.type,hint:e.description,initial:String(e.defaultValue)}))}),i=[];for(const e of this._params)i.push(s[e.type]);return createReview(e,t,"Generated by Progress Auditor",this._type,i)}}}const ERROR_TAG="REVIEW",TYPE="ignore_review",DESCRIPTION="Ignore another review (cannot ignore another ignore_review).";async function review(e,t){try{await createReviewer().type(TYPE).paramLength(1).forEach(t=>{const{id:s,type:i,params:r}=t,n=r[0];if(getReviewByID(e,n).type===TYPE)throw new Error(`Invalid review target '${n}' - cannot ignore another ignore_review type.`);removeReviewByID(e,n)}).review(e,t)}catch(t){e.throwError(ERROR_TAG,t)}}async function build(e=[]){const t=[];for(const s of e)t.push(await buildStep());return t}async function buildStep(e){return await createBuilder().type(TYPE).param(0,"Review ID","The target review to ignore.").build()}var IgnoreReview=Object.freeze({TYPE:TYPE,DESCRIPTION:DESCRIPTION,review:review,build:build});const ERROR_TAG$1="REVIEW",TYPE$1="add_vacation",DESCRIPTION$1="Add a vacation to the user's schedule";async function review$1(e,t){try{await createReviewer().type(TYPE$1).paramLength(3).forEach(t=>{const{id:s,params:i}=t;let r=!1;for(const t of getReviews(e)){const i=getReviewByID(e,t);if(i.type===TYPE&&i.params.length>=1&&i.params[0]==s){r=!0;break}}if(r)return;const n=parseEmail(i[0]),a=parse(i[1]),o=parse(i[2]);let l;l=i.length>3?i[3]:stringHash(i.join("|")),addVacation(e,l,n,a,o,"week")}).review(e,t)}catch(t){e.throwError(ERROR_TAG$1,t)}}async function build$1(e=[]){const t=[];for(const s of e)t.push(await buildStep$1());return t}async function buildStep$1(e){return await createBuilder().type(TYPE$1).param(0,"Owner Key","The target owner to have the vacation.").param(1,"Start Date","The start date of the vacation.").param(2,"End Date","The end date of the vacation.").param(3,"[Vacation ID]","The globally-unique id for the vacation. By default, this will be auto-generated.").build()}var VacationReview=Object.freeze({TYPE:TYPE$1,DESCRIPTION:DESCRIPTION$1,review:review$1,build:build$1});async function loadVacationsFromReviews(e,t){await review$1(e,t,e[REVIEW_KEY])}async function createDatabase$1(e){return console.log("...Creating database..."),await setupDatabase$5(e)}async function prepareDatabaseForInputs(e,t){console.log("...Load database from inputs..."),await loadInputsFromConfig(e,t),console.log("...Load database from assignments..."),await loadAssignmentsFromConfig(e,t)}async function populateDatabaseWithInputs(e,t){await applyParsersToDatabase(e,t),await loadVacationsFromReviews(e,t),await applyAssignersToDatabase(e)}async function verifyDatabaseWithClient(e,t){return console.log("...Verifying database with client..."),await askWhetherDatabaseIsValidToUse(e,t)}const path$2=require("path");async function output(e,t,s,i){const r=new TableBuilder;r.addColumn("User ID"),r.addColumn("Name",t=>getUserByID(e,t).name),r.addColumn("Used Slips",t=>getUserByID(e,t).attributes.slips.used),r.addColumn("Remaining Slips",t=>getUserByID(e,t).attributes.slips.remaining),r.addColumn("Average Slips (Median)",t=>getUserByID(e,t).attributes.slips.median),r.addColumn("Max Slips",t=>getUserByID(e,t).attributes.slips.max),r.addColumn("Missing Assignments",t=>getUserByID(e,t).attributes.progress.missing),r.addColumn("Auto-report",t=>{let s=!1;const i=getUserByID(e,t).attributes;return i.slips.mean*(i.progress.missing+i.progress.unassigned)>i.slips.max&&(s=!0),s?"NOTICE!":"N/A"});const n=new Set;for(const t of getUsers(e)){const s=getAssignmentsByUser(e,t);for(const i of s)if(!n.has(i)){"_"!==getAssignmentByID(e,t,i).attributes.status&&n.add(i)}}const a=Array.from(n).reverse();for(const t of a)r.addColumn(t+" Status",s=>{const i=getAssignmentByID(e,s,t);return i?i.attributes.status:"!ERROR"}),r.addColumn(t+" Slips",s=>{const i=getAssignmentByID(e,s,t);return i?i.attributes.slipDays:"!ERROR"});for(const t of getUsers(e))r.addEntry(t);const o=r.build();await writeTableToCSV(s,o)}var InstructorReportOutput=Object.freeze({output:output});function stringifyStatus(e,t=0){let s,i,r;switch(s="N"===e&&t>0?"+?":"",i=t>0?` (${t}${s} slip day(s) used)`:"",e){case"Y":r="Completed";break;case"N":r="Missing";break;case"_":r="Not yet assigned";break;default:r="Unknown"}return r+i}function generateProgressReport(e,t,s){const i=getUserByID(e,s),r=[];r.push("Name: "+i.name),r.push("PID: "+i.attributes.pid),r.push("Date: "+e.currentDate.toDateString()),r.push(""),t.customIntro&&(r.push(t.customIntro),r.push("")),r.push("Your weekly student report:");const n=getAssignmentsByUser(e,s),a=[],o=[];let l=0,u=0;for(const t of n){const i=getAssignmentByID(e,s,t);"N"===i.attributes.status?(o.push(i),u+=1):"?"===i.attributes.status&&a.push(i),l+=i.attributes.slipDays,r.push(i.id+" - "+stringifyStatus(i.attributes.status,i.attributes.slipDays))}r.push("");const c=calculateNumberOfSlipDays(i.schedule);return r.push("Daily accruing slip days: "+u),r.push("Remaining slip days available: "+(c-l)),r.push(""),o.length>0&&(r.push("IMPORTANT:"),r.push(""),r.push("Missing assignment for "+o.map(e=>e.id).join(", ")+"."),r.push(""),r.push("You must turn in all assignments, even if late. These will continue to accrue slip-days until it is turned in."),r.push("")),t.customOutro&&(r.push(t.customOutro),r.push("")),a.length>0&&r.push("*In-Review: Significant difference has been found for the submission for the week past the deadline. A review is being conducted to evaluate number slip days used. Until resolved, it will assume the latest submission time is accurate."),r.push(""),'"'+r.join("\n")+'"'}function generateNoticeReport(e,t){return"N/A"}async function output$1(e,t,s,i){const r=new TableBuilder;r.addColumn("User ID"),r.addColumn("User Name",t=>getUserByID(e,t).name),r.addColumn("Progress Report",s=>generateProgressReport(e,t,s)),r.addColumn("Notice Report",e=>generateNoticeReport());for(const t of getUsers(e))r.addEntry(t);const n=r.build();if(await writeTableToCSV(s,n),i.exportPDF){const e=require("fs"),t=require("path"),r=new(require("pdfkit")),a=t.resolve(t.dirname(s),"string"==typeof i.exportPDF?i.exportPDF:"reports.pdf");r.pipe(e.createWriteStream(a));let o=!0;for(const e of n){if(o){o=!1;continue}const t=e[2];r.addPage().fontSize(16).text(t.substring(1,t.length-1))}r.end(),console.log("File saved: "+a)}}var StudentReportOutput=Object.freeze({output:output$1});const path$3=require("path");async function output$2(e,t,s,i){const r=writeToFile;try{await outputLog$3(e,r,s)}catch(e){console.error("Failed to output log.")}try{await outputLog$2(e,r,s)}catch(e){console.error("Failed to output log.")}try{await outputLog(e,r,s)}catch(e){console.error("Failed to output log.")}try{await outputLog$1(e,r,s)}catch(e){console.error("Failed to output log.")}try{await outputLog$4(e,r,s)}catch(e){console.error("Failed to output log.")}try{await writeToFile(path$3.resolve(s,"config.log"),JSON.stringify(t,null,4))}catch(e){console.error("Failed to output config log.")}try{let t;if(e.getErrors().length<=0)t="HOORAY! No errors!";else{let s=[];for(const t of e.getErrors())s.push(`${t.id}: [${t.tag}] ${t.message}\n=== SOLUTIONS: ===\n => ${t.options.join("\n => ")}\n=== MOREINFO: ===\n${t.more.join("\n")}\n`);t="It's okay. We'll get through this.\n\n"+s.join("\n")}await writeToFile(path$3.resolve(s,"errors.txt"),t)}catch(e){console.error("Failed to output error log.")}try{const t=JSON.stringify(e.getCache(),null,4);await writeToFile(path$3.resolve(s,"cache.txt"),t)}catch(e){console.error("Failed to output cache log.")}}var DebugReportOutput=Object.freeze({output:output$2});const path$4=require("path");function findOutputEntries(e){return console.log("...Finding output entries..."),Array.isArray(e.outputs)?e.outputs:[]}async function processOutputEntry(e,t,s){console.log("...Process output entry...");const i=t.outputPath,r=s.outputName,n=t.outputAutoDate||!1,a=path$4.resolve(i+(n?"/"+stringify(e.currentDate,!1):""),r),o=s.format,l=s.customFormatPath,u=s.opts;let c;if(l)try{if("function"!=typeof(c=require(l)).output)throw new Error(`Invalid custom format '${l}' - must export named function 'output'.`)}catch(e){throw new Error(`Cannot load custom format from '${l}'.`,e)}else switch(o){case"instructor":c=InstructorReportOutput;break;case"student":c=StudentReportOutput;break;case"debug":c=DebugReportOutput;break;default:throw new Error(`Cannot find valid output of type '${o}'.`)}await c.output(e,t,a,u)}async function outputDebugLog(e,t){if(await askWhetherToSaveDebugInfo()){let s;if(t){s=t.outputPath+(t.outputAutoDate||!1?"/"+stringify(e.currentDate,!1):"")}else s=".";await output$2(e,t,s)}else showSkippingDebugLog()}class ReviewRegistry{constructor(){this.reviewMap=new Map,this.priorityList=[]}register(e,t=!1){if(!e)throw new Error("Cannot register null reviews.");if(!("TYPE"in e&&e.TYPE))throw new Error(`Not a valid review type - missing type. ${e}`);return this.reviewMap.set(e.TYPE,e),t||this.priorityList.push(e.TYPE),this}async applyReviews(e,t){for(const s of this.priorityList){const i=this.reviewMap.get(s);try{await i.review(e,t)}catch(e){await skippedError(`Failed to apply review '${s}'.`,e)}}}getReviewByType(e){return this.reviewMap.get(e)}getReviewTypes(){return this.reviewMap.keys()}}const INSTANCE=new ReviewRegistry;async function askChooseError(e,t,s){const i=[];for(const e of t){if(!s.has(e.id))throw new Error("Error map does not match error list.");i.push({name:e.id,message:formatErrorAsChoice(e),value:e.id})}return i.push(CHOICE_SEPARATOR),await askPrompt(e,"autocomplete",{multiple:!0,limit:4,choices:i,validate:e=>{if(e.length<=0)return"Must select at least one error (use 'space' to select).";const t=s.get(e[0]).type;for(const i of e){const e=s.get(i);if(e.type!==t)return`Cannot batch process errors of different type (${t} != ${e.type})`}return!0}})}function formatErrorAsChoice(e){let t;return["",`${chalk$1.gray(e.id+": ")} ${e.message}`,t=e.info&&e.info.length>70?chalk$1.italic.gray(e.info.substring(0,70)):chalk$1.italic.gray(e.info)||""].join("\n")}async function run(e,t={}){t.errors=e,t.reviews=[];const s=new Map;for(const t of e)s.set(t.id,t);try{const i=await askChooseError("What error do you want to review?",e,s);if(!i)throw null;const r=[];for(const e of i){const t=s.get(e);r.push(t)}if(await askClientToReviewErrors(r)){const e=await doReviewSession(INSTANCE,r);t.reviews.push(...e)}}catch(e){if(e&&e.message&&e.message.length>0)throw e;error("Review interrupted. Restarting review session...")}}async function askClientToReviewErrors(e){const t=new Set;for(const s of e)for(const e of s.options)t.add(e);if(log(`${chalk$1.green(`${chalk$1.bold(`= Solutions: ${"=".repeat(67)}`)}\n => ${Array.from(t).join("\n => ")}\n${chalk$1.bold("=".repeat(80))}`)}`),await ask("Show more info?"))for(const t of e)await showErrorInfo(t);return await ask("Continue to review?")}async function showErrorInfo(e){e(`${chalk$1.gray(e.id+":")} ${e.message}`),log(`${chalk$1.green(`${chalk$1.bold(`= Solutions: ${"=".repeat(67)}`)}\n => ${e.options.join("\n => ")}\n${chalk$1.bold("=".repeat(80))}`)}`),log(`${chalk$1.yellow(`${chalk$1.bold(`= More Info: ${"=".repeat(67)}`)}\n | ${e.more.join("\n")}\n${"=".repeat(80)}`)}`)}async function doReviewSession(e,t){if(t.length<=0)throw new Error("Cannot review empty error list.");const s=await chooseReviewType(e),i=e.getReviewByType(s);if(!i||"function"!=typeof i.build)throw new Error("Cannot build review with review-only review type.");return await i.build(t)}async function chooseReviewType(e){const t=[];for(const s of e.getReviewTypes()){const i=e.getReviewByType(s);"build"in i&&"function"==typeof i.build&&t.push(s)}return await askPrompt("What type of review do you want to make?","autocomplete",{limit:10,choices:t})}async function findDatabaseErrors(e,t){console.log("...Finding database errors...");const s=e.getErrors();return!s||s.length<=0?(await celebrateNoErrors(),null):s}async function shouldContinueResolvingErrorsWithClient(e,t,s){return askWhetherToReviewErrors(e,t,s)}async function resolveDatabaseErrors(e,t,s){console.log("...Resolving database errors...");const i=e.getCache().reviewSession={};return await run(s,i),i.reviews&&i.reviews.length>0?i.reviews:null}async function clearDatabase$6(e,t){console.log("...Clearing database..."),clearDatabase$5(e)}async function verifyErrorsWithClient(e,t,s){return!s||s.length<=0||await askWhetherToIgnoreErrors(e,t,s)}async function outputErrorLog(e,t,s){console.log("...Outputting database errors..."),await outputDebugLog(e,t)}const ERROR_TAG$2="REVIEW",TYPE$2="skip_error",DESCRIPTION$2="Skip a specific error.";async function review$2(e,t){try{await createReviewer().type(TYPE$2).paramLength(1).forEach(t=>{const{params:s}=t,i=Number(s[0]);console.log(`...Skipping error ${i} by review...`),e.removeErrorByID(i)}).review(e,t)}catch(t){e.throwError(ERROR_TAG$2,t)}}async function build$2(e=[]){const t=[];for(const s of e)t.push(await buildStep$2(s));return t}async function buildStep$2(e){return await createBuilder().type(TYPE$2).param(0,"Error ID","The id of the error to skip.",e.id).build()}var SkipErrorReview=Object.freeze({TYPE:TYPE$2,DESCRIPTION:DESCRIPTION$2,review:review$2,build:build$2});const ERROR_TAG$3="REVIEW",SUBMISSION_TYPE_UNKNOWN="unknown",SUBMISSION_TYPE_SOURCE="source",SUBMISSION_TYPE_MINOR_EDIT="minor",SUBMISSION_TYPE_MAJOR_EDIT="major",TYPE$3="assignment_by_header",DESCRIPTION$3="Assigns submission by matching post headers.";async function review$3(e,t){try{for(const t of getOwners(e)){const s=getUserByOwnerKey(e,t);if(s){const i=getAssignedSubmissionsByOwnerKey(e,t);for(const t of Object.keys(i)){const r=i[t],n=getAssignmentByID(e,s,t);if(n){const i=getNearestSubmission(r,n.dueDate);evaluatePostType(r[r.length-1],i);setGradedSubmissionForAssignment(e,s,t,i)}else for(const i of r)e.throwError(ERROR_TAG$3,`Found unassigned assignment '${t}' with submission '${i.id}' from user '${s}'.`,{type:"unassigned_submission",id:[s,t],info:i.attributes.content.head,options:["The submission header could be ill-formatted. We could not deduce its appropriate assignment automatically. Please verify the submitted content and header formats. Try submitting a 'change_assignment' review once you figure out its proper assignment.","It could be a non-assignment submission. Try submitting a 'ignore_submission' review."],more:[JSON.stringify(i,null,4)],context:{submissionID:i.id}})}}else{const s=getAssignedSubmissionsByOwnerKey(e,t);let i=0;for(const e of Object.keys(s))i+=s[e].length;e.throwError(ERROR_TAG$3,`Found ${i} unowned submissions - cannot find user for owner key '${t}'.`,{type:"unowned_submission",id:[t],options:["There are submissions without a valid user associated with it. Perhaps someone is using a different owner key? Try submitting a 'add_owner' review once you've found who these submissions belong to.","The owner key may be ill-formatted. Instead of fixing the mispelling, try submitting a 'add_owner' review to associate it back to the user."],more:[JSON.stringify(s,null,4)],context:{ownerKey:t}})}}}catch(t){e.throwError(ERROR_TAG$3,t)}}const build$3=void 0;function evaluatePostType(e,t){return e===t?SUBMISSION_TYPE_SOURCE:e.attributes.content.body==t.attributes.content.body?SUBMISSION_TYPE_MINOR_EDIT:e.attributes.content.body!=t.attributes.content.body?SUBMISSION_TYPE_MAJOR_EDIT:e.attributes.content.head!=t.attributes.content.head?SUBMISSION_TYPE_MINOR_EDIT:SUBMISSION_TYPE_UNKNOWN}function setGradedSubmissionForAssignment(e,t,s,i){getAssignmentByID(e,t,s).attributes.submission=i}function getNearestSubmission(e,t){let s=null,i=1/0;for(const r of e){const e=compareDates(r.date,t);if(s&&e>0)return s;Math.abs(e)<i&&(s=r,i=Math.abs(e))}return s}var SubmissionAssignmentByHeaderReview=Object.freeze({TYPE:TYPE$3,DESCRIPTION:DESCRIPTION$3,review:review$3,build:void 0});const ERROR_TAG$4="REVIEW",TYPE$4="assignment_by_intro",DESCRIPTION$4="Assigns submission by matching intro headers.";async function review$4(e,t){try{for(const t of getOwners(e)){const s=getUserByOwnerKey(e,t);if(s){const i=getUserByID(e,s).name,r=getAssignedSubmissionsByOwnerKey(e,t);if("null"in r){const t=r.null.slice();for(const s of t)s.attributes.content.head.trim()===i&&changeSubmissionAssignment(e,s,"intro")}}}}catch(t){e.throwError(ERROR_TAG$4,t)}}const build$4=void 0;var SubmissionAssignmentByIntroReview=Object.freeze({TYPE:TYPE$4,DESCRIPTION:DESCRIPTION$4,review:review$4,build:void 0});const ERROR_TAG$5="REVIEW",TYPE$5="assignment_by_intro",DESCRIPTION$5="Assigns submission by matching intro headers.",WEEK_PATTERN=/week ?([0-9]+)/i;async function review$5(e,t){try{for(const t of getOwners(e)){const s=getUserByOwnerKey(e,t);if(s){getUserByID(e,s).name;const i=getAssignmentsByUser(e,s);let r=0;for(const e of i){const t=WEEK_PATTERN.exec(e);if(t&&t.length>=2)try{const e=Number.parseInt(t[1]);e>r&&(r=e)}catch(e){}}const n=r+1,a=getAssignedSubmissionsByOwnerKey(e,t);if("null"in a){const t=a.null.slice();for(const s of t){const t=s.attributes.content.head,i=WEEK_PATTERN.exec(t);i&&i.length>=2&&i[1]==n&&changeSubmissionAssignment(e,s,"last")}}}}}catch(t){e.throwError(ERROR_TAG$5,t)}}const build$5=void 0;var SubmissionAssignmentByLastReview=Object.freeze({TYPE:TYPE$5,DESCRIPTION:DESCRIPTION$5,review:review$5,build:void 0});const ERROR_TAG$6="REVIEW",TYPE$6="assignment_by_post",DESCRIPTION$6="Assigns submission by matching post id.";async function review$6(e,t){try{for(const t of getSubmissions(e)){const s=getSubmissionByID(e,t);if("null"===s.assignment){const t=s;let i=!1;const r=getAssignedSubmissionsByOwnerKey(e,t.owner);for(const[s,n]of Object.entries(r))if("null"!==s){for(const s of n)if(t.attributes.content.id===s.attributes.content.id&&(changeSubmissionAssignment(e,t,s.assignment),i=!0),i)break;if(i)break}}}}catch(t){e.throwError(ERROR_TAG$6,t)}}const build$6=void 0;var SubmissionAssignmentByPostNumberReview=Object.freeze({TYPE:TYPE$6,DESCRIPTION:DESCRIPTION$6,review:review$6,build:void 0});const ERROR_TAG$7="REVIEW",LATEST_TIMEZONE_OFFSET=432e5,TYPE$7="submission_slip_days",DESCRIPTION$7="Calculates the number of slip days for assigned submissions.";async function review$7(e,t){try{const t=e.currentDate;for(const s of getUsers(e)){let i=0,r=0,n=0;const a=[];let o=0,l=0;const u=getUserByID(e,s),c=3*u.schedule.weeks,h=getAssignmentsByUser(e,s);for(const u of h){const c=getAssignmentByID(e,s,u);if(!("status"in c.attributes&&"slip"in c.attributes)){const e=c.dueDate;if(compareDates(t,e)<0)c.attributes.status="_",c.attributes.slipDays=0;else{let s;c.attributes.submission?(c.attributes.status="Y",s=c.attributes.submission.date):(c.attributes.status="N",s=t);const i=calculateSlipDays(s,e);c.attributes.slipDays=i}}const h=c.attributes.slipDays;switch(h>0&&(a.push(h),o+=h,++l),c.attributes.status){case"Y":++n;break;case"N":++i;break;case"_":++r;break;default:++r}}let p=0,d=0;if(l>0)if(p=o/l,a.length%2==0){const e=Math.floor(a.length/2);d=e+(e+1)/2}else d=Math.floor(a.length/2);u.attributes.slips={used:o,remaining:c-o,max:c,mean:p,median:d},u.attributes.progress={submitted:n,missing:i,unassigned:r}}}catch(t){e.throwError(ERROR_TAG$7,t)}}const build$7=void 0;function calculateSlipDays(e,t){const s=Math.floor((t.getTime()+LATEST_TIMEZONE_OFFSET)/ONE_DAYTIME)-Math.floor(e.getTime()/ONE_DAYTIME);return s<0?-s:0}var SubmissionSlipDaysReview=Object.freeze({TYPE:TYPE$7,DESCRIPTION:DESCRIPTION$7,review:review$7,build:void 0});const ERROR_TAG$8="REVIEW",TYPE$8="change_assignment_status",DESCRIPTION$8="Changes the assignment status and slips for an owner.";async function review$8(e,t){try{await createReviewer().type(TYPE$8).paramLength(3).forEach(t=>{const{id:s,type:i,params:r}=t,n=r[0],a=UserDatabase.getUserByOwnerKey(e,n);a||e.throwError(ERROR_TAG$8,`Cannot find user for owner key ${n}`,{id:[s,i],options:[`Add missing owner key '${n}' to a user.`]});const o=r[1],l=r[2],u=r.length>3?Number(r[3]):0,c=AssignmentDatabase.getAssignmentByID(e,a,o);c||e.throwError(ERROR_TAG$8,`Cannot find assignment for id ${o}`,{id:[s,i],options:["User may not be assigned this assignment.","Assignment id may not exist."]}),c.attributes.status=l,c.attributes.slipDays=u}).review(e,t)}catch(t){e.throwError(ERROR_TAG$8,t)}}async function build$8(e=[]){const t=[];for(const s of e)t.push(await buildStep$3());return t}async function buildStep$3(e){return await createBuilder().type(TYPE$8).param(0,"Owner Key","The target owner with the target assignment").param(1,"Assignment ID","The target assignment ID").param(2,"Status","The new status for the assignment").param(3,"[Slip Days]","An optional parameter for the number of new slips days.").build()}var AssignmentChangeStatusReview=Object.freeze({TYPE:TYPE$8,DESCRIPTION:DESCRIPTION$8,review:review$8,build:build$8});const ERROR_TAG$9="REVIEW",TYPE$9="add_submission",DESCRIPTION$9="Add submission (with assignment) for owner.";async function review$9(e,t){try{await createReviewer().type(TYPE$9).paramLength(2).forEach(t=>{const{id:s,type:i,params:r}=t,n=r[0],a=getUserByOwnerKey(e,n);if(!a)return;const o=r[1],l=n+"#proxy_"+stringHash(`${s}:${n}.${o}`),u=r.length>=2?parse(r[2]):new Date(getAssignmentByID(e,a,o).dueDate.getTime()-1),c=r.length>=3?JSON.parse(r[3]):{};getSubmissionByID(e,l)?console.log("...Ignoring dupliate reviewed submission..."):addSubmission(e,l,n,o,u,c)}).review(e,t)}catch(t){e.throwError(ERROR_TAG$9,t)}}async function build$9(e=[]){const t=[];for(const s of e)t.push(await buildStep$4());return t}async function buildStep$4(e){return await createBuilder().type(TYPE$9).param(0,"Owner Key","The target owner to add the submission for.").param(1,"Assignment ID","The submission's assignment ID.").param(2,"[Submission Date]","An optional parameter for the date of the new submission.").param(3,"[Submission Attributes]","An optional parameter object for additional attributes.").build()}var SubmissionAddReview=Object.freeze({TYPE:TYPE$9,DESCRIPTION:DESCRIPTION$9,review:review$9,build:build$9});const ERROR_TAG$a="REVIEW",TYPE$a="change_assignment",DESCRIPTION$a="Change assignment for submission.";async function review$a(e,t){try{await createReviewer().type(TYPE$a).paramLength(2).forEach(t=>{const{id:s,type:i,params:r}=t,n=getSubmissionByID(e,r[1]);n?changeSubmissionAssignment(e,n,r[0]):e.throwError(ERROR_TAG$a,`Invalid review param - unable to find submission for id '${r[1]}'.`,{id:[s,i],options:["The submission for that id is missing from the database.","Or it's the wrong id."]})}).review(e,t)}catch(t){e.throwError(ERROR_TAG$a,t)}}async function build$a(e=[]){const t=[];for(const s of e)t.push(await buildStep$5(s));return t}async function buildStep$5(e){return await createBuilder().type(TYPE$a).param(0,"Assignment ID","The new assignment id to change to.").param(1,"Submission ID","The id for the target submission.",e.context.submissionID||"").build()}var SubmissionChangeAssignmentReview=Object.freeze({TYPE:TYPE$a,DESCRIPTION:DESCRIPTION$a,review:review$a,build:build$a});const ERROR_TAG$b="REVIEW",TYPE$b="change_submission_date",DESCRIPTION$b="Change date for submission.";async function review$b(e,t){try{await createReviewer().type(TYPE$b).paramLength(2).forEach(t=>{const{id:s,type:i,params:r}=t,n=getSubmissionByID(e,r[0]);n?n.date=parseDate(r[1]):e.throwError(ERROR_TAG$b,`Invalid review param - unable to find submission for id '${r[0]}'.`,{id:[s,i],options:["The submission for that id is missing from the database.","Or it's the wrong id."]})}).review(e,t)}catch(t){e.throwError(ERROR_TAG$b,t)}}async function build$b(e=[]){const t=[];for(const s of e)t.push(await buildStep$6());return t}async function buildStep$6(e){return await createBuilder().type(TYPE$b).param(0,"Submission ID","The target submission to change.").param(1,"Submission Date","The target date to change to.").build()}var SubmissionChangeDateReview=Object.freeze({TYPE:TYPE$b,DESCRIPTION:DESCRIPTION$b,review:review$b,build:build$b});const ERROR_TAG$c="REVIEW",TYPE$c="ignore_owner",DESCRIPTION$c="Ignore all submissions for owner.";async function review$c(e,t){try{await createReviewer().type(TYPE$c).paramLength(1).forEach(t=>{const{params:s}=t;clearSubmissionsByOwner(e,s[0])}).review(e,t)}catch(t){e.throwError(ERROR_TAG$c,t)}}async function build$c(e=[]){const t=[];for(const s of e)t.push(await buildStep$7());return t}async function buildStep$7(e){return await createBuilder().type(TYPE$c).param(0,"Owner Key","The target owner to ignore.").build()}var SubmissionIgnoreOwnerReview=Object.freeze({TYPE:TYPE$c,DESCRIPTION:DESCRIPTION$c,review:review$c,build:build$c});const ERROR_TAG$d="REVIEW",TYPE$d="ignore_submission",DESCRIPTION$d="Ignore specific submission by id.";async function review$d(e,t){try{await createReviewer().type(TYPE$d).paramLength(1).forEach(t=>{const{id:s,type:i,params:r}=t,n=getSubmissionByID(e,r[0]);if(!n)return void console.log("...Ignoring redundant reviewed submission...");const a=[];for(const t of getSubmissions(e)){const s=getSubmissionByID(e,t);s.owner==n.owner&&s.attributes.content.id==n.attributes.content.id&&a.push(t)}for(const t of a)removeSubmissionByID(e,t)}).review(e,t)}catch(t){e.throwError(ERROR_TAG$d,t)}}async function build$d(e=[]){const t=[];for(const s of e)t.push(await buildStep$8(s));return t}async function buildStep$8(e){return await createBuilder().type(TYPE$d).param(0,"Submission ID","The target submission id.",e.context.submissionID||"").build()}var SubmissionIgnoreReview=Object.freeze({TYPE:TYPE$d,DESCRIPTION:DESCRIPTION$d,review:review$d,build:build$d});const ERROR_TAG$e="REVIEW",TYPE$e="add_owner_key",DESCRIPTION$e="Add additional owner key for user.";async function review$e(e,t){try{await createReviewer().type(TYPE$e).paramLength(2).forEach(t=>{const{id:s,type:i,params:r}=t,n=getUserByID(e,r[0]);if(!n)return void e.throwError(ERROR_TAG$e,`Invalid review param - Cannot find user for id '${r[0]}'.`,{id:[s,i],options:["User with this id has probably already been removed.","Or the id is wrong."]});const a=r[1];n.ownerKey.includes(a)?e.throwError(ERROR_TAG$e,`Invalid review param - Duplicate owner key '${a}' for user.`,{id:[s,i],options:["The user already has this owner key."]}):Array.isArray(n.ownerKey)?n.ownerKey.push(a):n.ownerKey=[n.ownerKey,a]}).review(e,t)}catch(t){e.throwError(ERROR_TAG$e,t)}}async function build$e(e=[]){const t=[];for(const s of e)t.push(await buildStep$9(s));return t}async function buildStep$9(e){return await createBuilder().type(TYPE$e).param(0,"User ID","The target user id to add the owner for.").param(1,"Owner Key","The new owner key to add for the user.",e.context.ownerKey||"").build()}var UserAddOwnerReview=Object.freeze({TYPE:TYPE$e,DESCRIPTION:DESCRIPTION$e,review:review$e,build:build$e});const ERROR_TAG$f="REVIEW",TYPE$f="null",DESCRIPTION$f="Unknown review type.";async function review$f(e,t){try{await createReviewer().type(TYPE$f).forEach(t=>{const{id:s,type:i}=t;e.throwError(ERROR_TAG$f,`Unhandled review type ${i} for review '${s}'.`,{id:[s,i],options:["You probably misspelled the review type.",`Ask the developer to handle a new '${i}' review type.`]})}).review(e,t)}catch(t){e.throwError(ERROR_TAG$f,t)}}const build$f=void 0;var NullReview=Object.freeze({TYPE:TYPE$f,DESCRIPTION:DESCRIPTION$f,review:review$f,build:void 0});const TYPE$g="empty",DESCRIPTION$g="A placeholder review if you need one.";async function review$g(e,t){}async function build$g(e=[]){const t=[];for(const s of e)t.push(await buildStep$a());return t}async function buildStep$a(e){return await createBuilder().type(TYPE$g).param(0,"Comment","Anything you want to say about this placeholder.").build()}var EmptyReview=Object.freeze({TYPE:TYPE$g,DESCRIPTION:DESCRIPTION$g,review:review$g,build:build$g});async function setup(e,t,s){s.register(IgnoreReview).register(VacationReview,!0).register(SkipErrorReview,!0).register(NullReview).register(EmptyReview).register(UserAddOwnerReview).register(SubmissionChangeAssignmentReview).register(SubmissionChangeDateReview).register(SubmissionIgnoreOwnerReview).register(SubmissionIgnoreReview).register(SubmissionAddReview).register(AssignmentChangeStatusReview)}const SCHEME_NAME="piazza";async function setup$1(e,t,s){await setup(e,t,s),s.register(SubmissionAssignmentByIntroReview).register(SubmissionAssignmentByLastReview).register(SubmissionAssignmentByHeaderReview).register(SubmissionAssignmentByPostNumberReview).register(SubmissionSlipDaysReview)}async function prepareDatabaseForScheme(e,t,s=t.scheme){if(!s)throw new Error("Missing 'scheme' from config.");switch(s){case SCHEME_NAME:await setup$1(e,t,INSTANCE);break;default:throw new Error(`Unknown scheme by name '${s}'.`)}}async function populateDatabaseWithAdditionalReviews(e,t,s){for(const t of s){const{id:s,date:i,comment:r,type:n,params:a}=t;addReview(e,s,i,r,n,a)}}async function fixDatabaseWithReviews(e,t){console.log("...Reviewing our work..."),await INSTANCE.applyReviews(e,t,e[REVIEW_KEY]),await review$2(e,t,e[REVIEW_KEY])}async function shouldSaveNewReviewsForClient(e,t,s){if(!s||s.length<=0)return!1;const i=await askWhetherToSaveNewReviews(e,t,s);return i||console.log("...Dumping reviews..."),i}async function outputNewReviewsToFile(e,t,s=null){const i=require("path"),r=[["Review ID","Date","Comment","Type","Param[0]","Param[1]","Param[2]","Param[3]","..."]];if(s)for(const e of s){const t=[];t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3]),t.push(...e[4]),r.push(t)}else for(const t of getReviews(e)){const s=getReviewByID(e,t),i=[];s.type!==TYPE$2&&(i.push(t),i.push(stringify(s.date)),i.push(s.comment),i.push(s.type),i.push(...s.params),r.push(i))}let n;n=t.outputAutoDate&&e?i.resolve(t.outputPath+"/"+stringify(e.currentDate,!1),"reviews.csv"):i.resolve(t.outputPath,`reviews-${stringify(new Date(Date.now()),!0)}.csv`),await writeTableToCSV(n,r)}async function resolveConfig(e){let t;console.log("Resolving config...");try{t=await loadConfigFile(e)}catch(e){let s;for(;s=await requestConfigFile();)try{if(t=await loadConfigFile(s))break}catch(e){}t||(t=await createNewConfig()),t||(t=await loadDefaultConfig())}if(!t)throw new Error("Could not resolve a config file for program. Stopping program...");return await validateConfig(t,e),t}async function resolveDatabase(e){console.log("Resolving database...");const t=await createDatabase$1(e);if(await prepareDatabaseForScheme(t,e,e.scheme),await prepareDatabaseForInputs(t,e),await populateDatabaseWithInputs(t,e),await fixDatabaseWithReviews(t,e),!await verifyDatabaseWithClient(t,e))throw new Error("Could not resolve database for program. Please update the config to match your specifications, then try again. Stopping program...");return t}async function validateDatabase(e,t){console.log("Validating database...");let s,i=[];for(;(s=await findDatabaseErrors(e))&&await shouldContinueResolvingErrorsWithClient(e,t,s);){const r=await resolveDatabaseErrors(e,t,s);r&&r.length>0&&(i.push(...r),await clearDatabase$6(e),await populateDatabaseWithInputs(e,t),await populateDatabaseWithAdditionalReviews(e,t,i),await fixDatabaseWithReviews(e,t))}if(await shouldSaveNewReviewsForClient(e,t,i)&&await outputNewReviewsToFile(e,t,null),!await verifyErrorsWithClient(e,t,s))throw new Error("Cannot resolve errors. Stopping program...")}async function generateOutput(e,t){console.log("Generating output...");const s=findOutputEntries(t);for(const i of s)try{await processOutputEntry(e,t,i)}catch(e){console.error("Failed to process output entry.",e)}}async function onStart(e,t){doTheBigTitleThing(),log(""),log("Running from directory: "+e),log("")}async function onSetup(e,t){}async function onPreProcess(e,t){}async function onPostProcess(e,t){}async function onOutput(e,t){}async function onError(e,t,s){formattedError(s,t&&t.debug||!1);try{outputErrorLog(e,t,[s])}catch(e){}}async function onStop(e,t){}const path$5=require("path");async function main(e){const t=e.length>2?path$5.resolve(e[2]):path$5.resolve(process.execPath,"..");let s,i;await onStart(t);try{s=await resolveConfig(t),i=await resolveDatabase(s),await onSetup(i,s),await onPreProcess(i,s),await validateDatabase(i,s),await onPostProcess(i,s),await generateOutput(i,s),await onOutput(i,s)}catch(e){return await onError(i,s,e),!1}return await onStop(),!0}main(process.argv).then(e=>{e?console.log("Success!"):console.log("Failure!")});
